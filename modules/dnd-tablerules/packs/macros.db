{"name":"ActorToConsole","type":"script","scope":"global","author":"g325YPUxaNNgCApI","img":"icons/svg/dice-target.svg","command":"const tokens = canvas.tokens.controlled;\nfor (let i = 0; i < tokens.length; i++) {\n    console.log(game.actors.get(tokens[i].document.actorId));\n}","ownership":{"default":0,"g325YPUxaNNgCApI":3},"flags":{"core":{"sourceId":"Macro.9CCDEv3NKAqG3QOu"}},"_stats":{"systemId":"dnd5e","systemVersion":"2.0.3","coreVersion":"10.288","createdTime":1665594319558,"modifiedTime":1667187834762,"lastModifiedBy":"g325YPUxaNNgCApI"},"folder":null,"sort":0,"_id":"71qjrOSoGFzpxkz4"}
{"name":"-10hp","type":"script","scope":"global","author":"npmYF618vZgxA5SD","img":"modules/Tablerules/icons/magic/healing/r10.webp","command":"const damage = 10;\n\nactor = canvas.tokens.hover?.actor;\n\nif (canvas.tokens.hover === null) {\n    ui.notifications.warn(`${macroLabel}, Actor hovered ${actor?.name} invalid target.`);\n    return;\n}\n\nactor.applyDamage(damage);","ownership":{"default":0,"npmYF618vZgxA5SD":3},"flags":{"core":{"sourceId":"Macro.7Zq6jeF6XTfU4P6s"}},"_stats":{"systemId":"dnd5e","systemVersion":"2.0.3","coreVersion":"10.290","createdTime":1668446799383,"modifiedTime":1668454525583,"lastModifiedBy":"npmYF618vZgxA5SD"},"folder":null,"sort":0,"_id":"Dj8u2n86kWN4Lrvl"}
{"name":"Lights Out","type":"script","scope":"global","author":"npmYF618vZgxA5SD","img":"icons/sundries/lights/lantern-steel.webp","command":"// icon suggestion: icons/sundries/lights/lantern-steel.webp\nconst tokensToBeModified = canvas.tokens.controlled;\nfor (let i = 0; i < tokensToBeModified.length; i++) {\n    if (tokensToBeModified[i].data.light.dim !== 0) {\n        await tokensToBeModified[i].document.update({\n            light: {\n                alpha: 0.5,\n                angle: 0,\n                bright: 0,\n                color: \"#000000\",\n                coloration: 1,\n                dim: 0,\n                gradual: true,\n                luminosity: 0.5,\n                saturation: 0,\n                contrast: 0,\n                shadows: 0,\n                animation: {\n                    speed: 5,\n                    intensity: 5,\n                    reverse: false,\n                },\n                darkness: {\n                    min: 0,\n                    max: 1,\n                },\n            },\n        });\n    }\n}","ownership":{"default":0,"npmYF618vZgxA5SD":3},"flags":{"core":{"sourceId":"Macro.RwgvgVqRscTRwvXw"}},"_stats":{"systemId":"dnd5e","systemVersion":"2.0.3","coreVersion":"10.290","createdTime":1668318820559,"modifiedTime":1668318859555,"lastModifiedBy":"npmYF618vZgxA5SD"},"folder":null,"sort":0,"_id":"EapfJgLDvZ3XYHwL"}
{"name":"+10hp","type":"script","scope":"global","author":"npmYF618vZgxA5SD","img":"modules/Tablerules/icons/magic/healing/g10.webp","command":"const damage = -10;\n\nactor = canvas.tokens.hover?.actor;\n\nif (canvas.tokens.hover === null) {\n    ui.notifications.warn(`${macroLabel}, Actor hovered ${actor?.name} invalid target.`);\n    return;\n}\n\nactor.applyDamage(damage);","ownership":{"default":0,"npmYF618vZgxA5SD":3},"flags":{"core":{"sourceId":"Macro.S1C7ytpywSYgMhrL"}},"_stats":{"systemId":"dnd5e","systemVersion":"2.0.3","coreVersion":"10.290","createdTime":1668446963152,"modifiedTime":1668454531441,"lastModifiedBy":"npmYF618vZgxA5SD"},"folder":null,"sort":0,"_id":"HLaeO6aEfvFXofQb"}
{"name":"listActiveModules","type":"script","scope":"global","author":"npmYF618vZgxA5SD","img":"icons/svg/dice-target.svg","command":"// the console report can be copied directly into the Markdown documentation (right-click copy String contents)\n\nconst modulesActive = game.modules.filter(m => m.active);\nconst moduleReport = modulesActive.map(\n    m => ({ id: m.id, title: m.title, version: m.version })\n);\nconsole.log(modulesActive);\nconsole.log(moduleReport);\n\nlet reportString = \"\";\n\nfor (i = 0; i < modulesActive.length; i++) {\n    m = modulesActive[i];\n    reportString = `${reportString}\\n1. ${m.title} (version: ${m.version}) : [Project-URL](${m.url})`;\n}\n\nconsole.log({ reportString: reportString });","ownership":{"default":0,"npmYF618vZgxA5SD":3},"flags":{"core":{"sourceId":"Macro.JjoRX5KwFPNQdSlr"}},"_stats":{"systemId":"dnd5e","systemVersion":"2.0.3","coreVersion":"10.290","createdTime":1668016102525,"modifiedTime":1668184530058,"lastModifiedBy":"npmYF618vZgxA5SD"},"folder":null,"sort":0,"_id":"KnJ4shfO7vbi8eqg"}
{"name":"Torch (Selected)","type":"script","scope":"global","author":"npmYF618vZgxA5SD","img":"icons/sundries/lights/torch-brown-lit.webp","command":"// icon suggestion: icons/sundries/lights/torch-brown-lit.webp\nconst dim_range = 40;\nconst bright_range = 20;\nconst tokensToBeModified = canvas.tokens.controlled;\nfor (let i = 0; i < tokensToBeModified.length; i++) {\n\tif (tokensToBeModified[i].data.light.dim === 0) {\n\t\tawait tokensToBeModified[i].document.update({\n\t\t\tlight: {\n\t\t\t\talpha: 0.2,\n\t\t\t\tangle: 0,\n\t\t\t\tbright: bright_range,\n\t\t\t\tcoloration: 1,\n\t\t\t\tdim: dim_range,\n\t\t\t\tgradual: true,\n\t\t\t\tluminosity: 0.5,\n\t\t\t\tsaturation: 0,\n\t\t\t\tcontrast: 0.25,\n\t\t\t\tshadows: 0,\n\t\t\t\tanimation: {\n\t\t\t\t\tspeed: 1,\n\t\t\t\t\tintensity: 2,\n\t\t\t\t\treverse: false,\n\t\t\t\t\ttype: \"torch\",\n\t\t\t\t},\n\t\t\t\tdarkness: {\n\t\t\t\t\tmin: 0,\n\t\t\t\t\tmax: 1,\n\t\t\t\t},\n\t\t\t\tcolor: \"#f3e09b\",\n\t\t\t},\n\t\t});\n\t} else {\n\t\tawait tokensToBeModified[i].document.update({\n\t\t\tlight: {\n\t\t\t\talpha: 0.5,\n\t\t\t\tangle: 0,\n\t\t\t\tbright: 0,\n\t\t\t\tcolor: \"#000000\",\n\t\t\t\tcoloration: 1,\n\t\t\t\tdim: 0,\n\t\t\t\tgradual: true,\n\t\t\t\tluminosity: 0.5,\n\t\t\t\tsaturation: 0,\n\t\t\t\tcontrast: 0,\n\t\t\t\tshadows: 0,\n\t\t\t\tanimation: {\n\t\t\t\t\tspeed: 5,\n\t\t\t\t\tintensity: 5,\n\t\t\t\t\treverse: false,\n\t\t\t\t},\n\t\t\t\tdarkness: {\n\t\t\t\t\tmin: 0,\n\t\t\t\t\tmax: 1,\n\t\t\t\t},\n\t\t\t},\n\t\t});\n\t}\n}","ownership":{"default":0,"npmYF618vZgxA5SD":3},"flags":{"core":{"sourceId":"Macro.ZcpMEBvmrtf4fC4y"}},"_stats":{"systemId":"dnd5e","systemVersion":"2.0.3","coreVersion":"10.290","createdTime":1668692035955,"modifiedTime":1669742083890,"lastModifiedBy":"npmYF618vZgxA5SD"},"folder":null,"sort":0,"_id":"Q1AruMQQJk0HoSgR"}
{"name":"ScaleUp","type":"script","scope":"global","author":"npmYF618vZgxA5SD","img":"modules/Tablerules/icons/gui/ScaleUp.png","command":"const scalingPercent = 5/100;\ntoken = canvas.tokens.controlled[0];\nawait token.document.update({\"texture.scaleX\":token.document.texture.scaleX * (1+scalingPercent),\"texture.scaleY\":token.document.texture.scaleY * (1+scalingPercent)});","ownership":{"default":0,"npmYF618vZgxA5SD":3},"flags":{"core":{"sourceId":"Macro.1xrW2YrC5jConchC"}},"_stats":{"systemId":"dnd5e","systemVersion":"2.0.3","coreVersion":"10.291","createdTime":1670444236834,"modifiedTime":1670514663196,"lastModifiedBy":"npmYF618vZgxA5SD"},"folder":null,"sort":0,"_id":"WhNLy8hgiUrVrV49"}
{"name":"ScaleDown","type":"script","scope":"global","author":"npmYF618vZgxA5SD","img":"modules/Tablerules/icons/gui/ScaleDown.png","command":"const scalingPercent = -(5/100);\ntoken = canvas.tokens.controlled[0];\nawait token.document.update({\"texture.scaleX\":token.document.texture.scaleX * (1+scalingPercent),\"texture.scaleY\":token.document.texture.scaleY * (1+scalingPercent)});","ownership":{"default":0,"npmYF618vZgxA5SD":3},"flags":{"core":{"sourceId":"Macro.6mAbWFLRhOU8xQfj"}},"_stats":{"systemId":"dnd5e","systemVersion":"2.0.3","coreVersion":"10.291","createdTime":1670444547714,"modifiedTime":1670514660205,"lastModifiedBy":"npmYF618vZgxA5SD"},"folder":null,"sort":0,"_id":"Y72nBr6LhJLgco8D"}
{"name":"Cycle Wildcard Token","type":"script","scope":"global","author":"npmYF618vZgxA5SD","img":"icons/svg/dice-target.svg","command":"// https://github.com/krbz999/zhell-macros/blob/main/tools/token/cycle_token_wildcards.js\nconst currentImg = token.document.texture.src;\nconst actorId = token.actor.id;\nconst wildcardImages = await game.actors.get(actorId).getTokenImages();\nconst currentIndex = wildcardImages.indexOf(currentImg);\nconst next = (currentIndex + 1) === wildcardImages.length ? 0 : currentIndex + 1;\nawait token.document.update({ \"texture.src\": wildcardImages[next] });","ownership":{"default":0,"npmYF618vZgxA5SD":3},"flags":{"core":{"sourceId":"Macro.hjsPei1SwSYahJ6m"}},"_stats":{"systemId":"dnd5e","systemVersion":"2.0.3","coreVersion":"10.290","createdTime":1668177770431,"modifiedTime":1668184498110,"lastModifiedBy":"npmYF618vZgxA5SD"},"folder":null,"sort":0,"_id":"bPbwE5JCZkByg9w5"}
{"name":"Stress","type":"script","scope":"global","author":"g325YPUxaNNgCApI","img":"icons/magic/death/undead-ghosts-trio-blue.webp","command":"//const actorIds = [\"tBmsCEZ4otbmmPcO\",\"anotherID\",\"...\"]; // for corner cases and whatever\nconst actorIds = canvas.tokens.controlled.map(t => t.actor.id);\nconst icon = \"icons/magic/death/undead-ghosts-trio-blue.webp\";\nconst label = \"Stress\";\n\nconst keys = [\n  \"system.bonuses.abilities.save\",\n  \"system.bonuses.abilities.check\",\n  \"system.bonuses.mwak.attack\",\n  \"system.bonuses.rwak.attack\",\n  \"system.bonuses.msak.attack\",\n  \"system.bonuses.rsak.attack\"\n];\nconst actorOptions = actorIds.reduce((acc, id) => {\n  const name = game.actors.get(id).name;\n  return acc + `<option value=\"${id}\">${name}</option>`;\n}, \"\");\nconst dirOptions = `\n<option value=\"-1\">Reduce Stress</option>\n<option value=\"1\">Increase Stress</option>`;\nconst content = `\n<form>\n  <div class=\"form-group\">\n    <label>Affected Actor:</laberl>\n    <div class=\"form-fields\">\n      <select id=\"target-stress-actor\">${actorOptions}</select>\n      <select id=\"stress-direction\">${dirOptions}</select>\n    </div>\n  </div>\n</form>`;\nawait Dialog.prompt({\n  title: \"Stress Config\", content, callback: (html) => {\n    const actorId = html[0].querySelector(\"#target-stress-actor\").value;\n    const dir = html[0].querySelector(\"#stress-direction\").value;\n    return updateValue(actorId, dir);\n  }\n});\n\nfunction updateValue(actorId, dir) {\n  const actor = game.actors.get(actorId);\n  const effect = actor.effects.find(e => foundry.utils.hasProperty(e, \"flags.world.stress\"));\n  const current = effect?.getFlag(\"world\", \"stress\") ?? 0;\n  //    const stress = Number(Math.max(current, 0)) + Number(dir);\n  const stress = Number(Math.max(current + Number(dir), 0));\n  const changes = keys.map(key => {\n    return { key, mode: CONST.ACTIVE_EFFECT_MODES.ADD, value: `-${stress}` };\n  });\n  const effectData = { changes, icon, label };\n  foundry.utils.setProperty(effectData, \"flags.world.stress\", stress);\n  if (effect) return effect.update(effectData);\n  return actor.createEmbeddedDocuments(\"ActiveEffect\", [effectData]);\n}","ownership":{"default":0,"g325YPUxaNNgCApI":3},"flags":{"core":{"sourceId":"Macro.dkK4qMJG7zQLkfT0"}},"_stats":{"systemId":"dnd5e","systemVersion":"2.0.3","coreVersion":"10.288","createdTime":1667051893165,"modifiedTime":1667187932266,"lastModifiedBy":"g325YPUxaNNgCApI"},"folder":null,"sort":0,"_id":"bUIwtAnVoqFQgdKV"}
{"name":"Twilight Sanctuary tHP","type":"script","scope":"global","author":"npmYF618vZgxA5SD","img":"icons/magic/light/light-lantern-lit-white.webp","command":"/* \n    icon suggestion: icons/magic/light/light-lantern-lit-white.webp\n    source: https://github.com/itteerde/fvttconfig/blob/main/tools/macros/gm/TwilightSanctuaryTakeTempHP.js\n    discussion: https://github.com/itteerde/fvttconfig/issues/29\n\n    I think I like the version where the Cleric player gets the `Effect` (that can create the `Aura` [either already or once we adopt `Effect Macro` which we'll test]) for having the `Twilight Sanctuary` active, maybe being applied by hitting the `Feature` (think we have that possibility already). All players get another `Macro` `Take Twilight Sanctuary HP` that looks for the active `Twilight Sanctuary` (everyone can read everything through code, just not save changes non-locally, so everyone can find the source in order to read their Cleric-Level), `Roll` and upgrade their own `Actor.system.attributes.hp.temp`.\n\n    We do not let the Cleric player give the temp hp as that would require socket registering and programming or warpgate in order to modify an `Actor` the `User` does have the prvileges to modify.\n*/\n\nconst macroLabel = \"Channel Divinity: Twilight Sanctuary tempHP\";\nconst sourceLabel = \"Channel Divinity: Twilight Sanctuary\";\nconst useDistance3D = true;\n\n//get the source Twilight Cleric\nconst twilightClericPCs = canvas.tokens.placeables.filter(t => {\n    if (t.actor.type !== \"character\")\n        return;\n    if (!t.actor.items.find(i => i.name === \"Twilight Domain\"))\n        return;\n    return t.actor.effects.find(e => e.label === \"Channel Divinity: Twilight Sanctuary\");\n});\nconsole.log(twilightClericPCs);\n\nif (twilightClericPCs.length === 0) {\n    ui.notifications.error(\n        `${macroLabel}, ${twilightClericPCs.length} Twilight Clerics found.`,\n        { permanent: true }\n    );\n    return;\n}\n\n// check validity of source, maybe enforce hover if it is not?\nif (twilightClericPCs.length !== 1) {\n    ui.notifications.warn(\n        `${macroLabel}, ${twilightClericPCs.length} Twilight Clerics found. Expected 1 and only 1.`,\n        { permanent: true }\n    );\n}\n\n\n// target?\nif (canvas.tokens.controlled.length !== 1) {\n    ui.notifications.error(`${macroLabel}, ${canvas.tokens.controlled.length} Actors selected. Select 1 and only 1.`, { permanent: true });\n    return;\n}\n\nif (actor.type !== \"character\") {\n    ui.notifications.error(`${macroLabel}, Actor selected is type:${actor.type}. Select a character.`);\n    return;\n}\n\nconsole.log({ target: actor, name: actor.name, id: actor._id });\n\n\n// check distance\nconst tokenSource = twilightClericPCs[0]; // this is not sound, there should be logid to chose if there are more than one.\n\nconst tokenTarget = canvas.tokens.placeables.find(t => t.actor._id === actor._id); // also not sound technically. There might be more than one Token for the same correct Actor, and not all might be in range.\nif (!tokenTarget) {\n    ui.notifications.error(`${macroLabel}, Actor context ${actor} does not match ${tokenTarget} found.`);\n    return;\n}\n\nconst cleric = tokenSource.actor;\nconst clericLevel = cleric.items.filter(i => i.type === \"class\").find(c => c.name === \"Cleric\").system.levels;\n\nconst distance = Math.round(canvas.grid.measureDistance(tokenSource, tokenTarget, { gridSpaces: true }));\nconst distance3D = Math.round(Math.sqrt(distance * distance + (tokenSource.document.elevation - tokenTarget.document.elevation) * (tokenSource.document.elevation - tokenTarget.document.elevation)));\nconsole.log({ message: \"distance\", distance: distance, distance3D: distance3D });\n\nif ((useDistance3D ? distance3D : distance) > 30) {\n    ui.notifications.warn(\n        `Distance between ${cleric.name} and ${actor.name} is ${(useDistance3D ? distance3D : distance)}. Expected distance<=30.`,\n        { permanent: true }\n    );\n\n    return;\n}\n\n// create the Roll\nconst roll = await new Roll(`1d6+${clericLevel}`, actor.getRollData()).evaluate({ async: true })\n\n// create the ChatMessage\nawait roll.toMessage({ speaker: ChatMessage.getSpeaker({ actor: cleric.name }), flavor: `getting temporary hit points by ${macroLabel} from ${cleric.name}.` });\n\nconst currentTempHP = tokenTarget.actor.system.attributes.hp.temp !== null ? tokenTarget.actor.system.attributes.hp.temp : 0;\nconst newTempHP = Math.max(roll.total, currentTempHP);\nconsole.log({ message: \"newTempHP\", temp: newTempHP });\n\nawait actor.update({ \"system.attributes.hp.temp\": newTempHP });","ownership":{"default":0,"npmYF618vZgxA5SD":3},"flags":{"core":{"sourceId":"Macro.Wi8tj7jT2lkYEcBD"}},"_stats":{"systemId":"dnd5e","systemVersion":"2.0.3","coreVersion":"10.290","createdTime":1668184550598,"modifiedTime":1668184611234,"lastModifiedBy":"npmYF618vZgxA5SD"},"folder":null,"sort":0,"_id":"ctugKIda2tJRhtdm"}
{"name":"Stress -1","type":"script","scope":"global","author":"npmYF618vZgxA5SD","img":"icons/magic/death/undead-ghosts-trio-blue.webp","command":"// icon suggestion: icons/magic/death/undead-ghosts-trio-blue.webp\n\nconst icon = \"icons/magic/death/undead-ghosts-trio-blue.webp\";\nconst macroLabel = \"Stress Plus One\";\nconst label = \"Stress\";\nconst changeBy = -1;\n\nconst keys = [\n    \"system.bonuses.abilities.save\",\n    \"system.bonuses.abilities.check\",\n    \"system.bonuses.mwak.attack\",\n    \"system.bonuses.rwak.attack\",\n    \"system.bonuses.msak.attack\",\n    \"system.bonuses.rsak.attack\"\n];\n\nactor = canvas.tokens.hover?.actor;\n\nif (canvas.tokens.hover === null) {\n    ui.notifications.warn(`${macroLabel}, Actor hovered ${actor?.name} invalid target.`);\n    return;\n}\n\n// works, but maybe save the state, delete the old one, create new one, in order to get out of the box stuff from ActiveEffect and Effect-Macro.\n\nconst effect = actor.effects.find(e => foundry.utils.hasProperty(e, \"flags.world.stress\"));\nconst current = effect?.getFlag(\"world\", \"stress\") ?? 0;\nconst stress = Number(Math.max(current + changeBy, 0));\nconst changes = keys.map(key => {\n    return { key, mode: CONST.ACTIVE_EFFECT_MODES.ADD, value: `-${stress}` };\n});\nconst effectData = { changes, icon };\nfoundry.utils.setProperty(effectData, \"label\", `${label}: ${stress}`);\nfoundry.utils.setProperty(effectData, \"flags.world.stress\", stress);\nif (effect) {\n    await effect.delete();\n}\n\nif (stress > 0) {\n    await actor.createEmbeddedDocuments(\"ActiveEffect\", [effectData]);\n}","ownership":{"default":0,"npmYF618vZgxA5SD":3},"flags":{"core":{"sourceId":"Macro.cZ5utQzgiD2ToC8H"}},"_stats":{"systemId":"dnd5e","systemVersion":"2.0.3","coreVersion":"10.290","createdTime":1669142733878,"modifiedTime":1669150684242,"lastModifiedBy":"npmYF618vZgxA5SD"},"folder":null,"sort":0,"_id":"eALkW8fIV3lL0nQ3"}
{"name":"Cycle Wildcard Token -1","type":"script","scope":"global","author":"npmYF618vZgxA5SD","img":"icons/svg/dice-target.svg","command":"// https://github.com/krbz999/zhell-macros/blob/main/tools/token/cycle_token_wildcards.js\nconst currentImg = token.document.texture.src;\nconst actorId = token.actor.id;\nconst wildcardImages = await game.actors.get(actorId).getTokenImages();\nconst currentIndex = wildcardImages.indexOf(currentImg);\nconst next = (currentIndex -1)>=0?(currentIndex -1):wildcardImages.length-1;\n\nawait token.document.update({ \"texture.src\": wildcardImages[next] });","ownership":{"default":0,"npmYF618vZgxA5SD":3},"flags":{"core":{"sourceId":"Macro.hjsPei1SwSYahJ6m"}},"_stats":{"systemId":"dnd5e","systemVersion":"2.0.3","coreVersion":"10.290","createdTime":1668177770431,"modifiedTime":1669580087121,"lastModifiedBy":"npmYF618vZgxA5SD"},"folder":null,"sort":0,"_id":"fT8o95kMcQlQrS30"}
{"name":"Torch (This Token)","type":"script","scope":"global","author":"npmYF618vZgxA5SD","img":"icons/sundries/lights/torch-brown-lit.webp","command":"// icon suggestion: icons/sundries/lights/torch-brown-lit.webp\nconst dim_range = 20;\nconst bright_range = 10;\nif (token.data.light.dim === 0) {\n    await token.document.update({\n        light: {\n            alpha: 0.2,\n            angle: 0,\n            bright: bright_range,\n            coloration: 1,\n            dim: dim_range,\n            gradual: true,\n            luminosity: 0.5,\n            saturation: 0,\n            contrast: 0.25,\n            shadows: 0,\n            animation: {\n                speed: 1,\n                intensity: 2,\n                reverse: false,\n                type: \"torch\",\n            },\n            darkness: {\n                min: 0,\n                max: 1,\n            },\n            color: \"#f3e09b\",\n        },\n    });\n} else {\n    await token.document.update({\n        light: {\n            alpha: 0.5,\n            angle: 0,\n            bright: 0,\n            color: \"#000000\",\n            coloration: 1,\n            dim: 0,\n            gradual: true,\n            luminosity: 0.5,\n            saturation: 0,\n            contrast: 0,\n            shadows: 0,\n            animation: {\n                speed: 5,\n                intensity: 5,\n                reverse: false,\n            },\n            darkness: {\n                min: 0,\n                max: 1,\n            },\n        },\n    });\n}","ownership":{"default":0,"npmYF618vZgxA5SD":3},"flags":{"core":{"sourceId":"Macro.ZcpMEBvmrtf4fC4y"}},"_stats":{"systemId":"dnd5e","systemVersion":"2.0.3","coreVersion":"10.290","createdTime":1668692035955,"modifiedTime":1669742053548,"lastModifiedBy":"npmYF618vZgxA5SD"},"folder":null,"sort":0,"_id":"oDuG1LjVmcvgqXKJ"}
{"name":"-1hp","type":"script","scope":"global","author":"npmYF618vZgxA5SD","img":"modules/Tablerules/icons/magic/healing/r1.webp","command":"const damage = 1;\n\nactor = canvas.tokens.hover?.actor;\n\nif (canvas.tokens.hover === null) {\n    ui.notifications.warn(`${macroLabel}, Actor hovered ${actor?.name} invalid target.`);\n    return;\n}\n\nactor.applyDamage(damage);","ownership":{"default":0,"npmYF618vZgxA5SD":3},"flags":{"core":{"sourceId":"Macro.ikCJ4nwpX2AlMh4k"}},"_stats":{"systemId":"dnd5e","systemVersion":"2.0.3","coreVersion":"10.290","createdTime":1668446891617,"modifiedTime":1668454527621,"lastModifiedBy":"npmYF618vZgxA5SD"},"folder":null,"sort":0,"_id":"rM5BrXDFAwx7v3vn"}
{"name":"+1hp","type":"script","scope":"global","author":"npmYF618vZgxA5SD","img":"modules/Tablerules/icons/magic/healing/g1.webp","command":"const damage = -1;\n\nactor = canvas.tokens.hover?.actor;\n\nif (canvas.tokens.hover === null) {\n    ui.notifications.warn(`${macroLabel}, Actor hovered ${actor?.name} invalid target.`);\n    return;\n}\n\nactor.applyDamage(damage);","ownership":{"default":0,"npmYF618vZgxA5SD":3},"flags":{"core":{"sourceId":"Macro.3jdQqgSiRuUiTv8H"}},"_stats":{"systemId":"dnd5e","systemVersion":"2.0.3","coreVersion":"10.290","createdTime":1668446925879,"modifiedTime":1668454529389,"lastModifiedBy":"npmYF618vZgxA5SD"},"folder":null,"sort":0,"_id":"tLMcmnae7qXte1Hi"}
{"name":"Guidance (One D&D)","type":"script","scope":"global","author":"npmYF618vZgxA5SD","img":"icons/magic/control/buff-flight-wings-blue.webp","command":"// icon suggestion: icons/magic/control/buff-flight-wings-blue.webp\nconst icon = \"icons/magic/control/buff-flight-wings-blue.webp\";\nconst label = \"Guidance\";\nconst macroLabel = \"Guidance One D&D\";\n\nif (canvas.tokens.controlled.length !== 1) {\n    ui.notifications.warn(`${macroLabel}, ${canvas.tokens.controlled.length} Actors selected. Select 1 and only 1.`, { permanent: true });\n    return;\n}\n\nif (actor.type !== \"character\") {\n    ui.notifications.warn(`${macroLabel}, Actor selected is type:${actor.type}. Select a character.`);\n    return;\n}\n\nconst effect = actor.effects.find(e => e.getFlag(\"world\", \"guidance\"));\nconst current = effect?.getFlag(\"world\", \"guidance.timesSinceLongRest\") ?? 0;\n\nconst max = CONFIG.Tablerules?.guidance?.maxTimesPerLongRest ?? 1;\n\nif (current >= max) {\n    ui.notifications.warn(`${macroLabel}, maximum numbers per Long Rest: ${max}, current: ${current}. ${actor.name} at cooldown.`);\n    ChatMessage.create({ content: `${macroLabel}, maximum numbers per Long Rest: ${max}, current: ${current}. ${actor.name} cooldown.`, flavor: macroLabel });\n    return;\n}\n\nconst effectData = { icon, label };\nfoundry.utils.setProperty(effectData, \"flags.world.guidance.timesSinceLongRest\", current + 1);\nfoundry.utils.setProperty(effectData, \"flags.dae.specialDuration\", [\"longRest\"]);\n\nif (effect) return effect.update(effectData);\nawait actor.createEmbeddedDocuments(\"ActiveEffect\", [effectData]);\n\nnew Roll(\"1d4\", actor.getRollData()).toMessage({ speaker: ChatMessage.getSpeaker({ actor: actor.name }), flavor: macroLabel });","ownership":{"default":0,"npmYF618vZgxA5SD":3},"flags":{"core":{"sourceId":"Macro.mLrFgRshpnS1zcpd"}},"_stats":{"systemId":"dnd5e","systemVersion":"2.0.3","coreVersion":"10.290","createdTime":1667591528551,"modifiedTime":1669055637170,"lastModifiedBy":"npmYF618vZgxA5SD"},"folder":null,"sort":0,"_id":"xYkcltGffRr4oSty"}
{"name":"Stress +1","type":"script","scope":"global","author":"npmYF618vZgxA5SD","img":"icons/magic/death/undead-ghosts-trio-blue.webp","command":"// icon suggestion: icons/magic/death/undead-ghosts-trio-blue.webp\n\nconst icon = \"icons/magic/death/undead-ghosts-trio-blue.webp\";\nconst macroLabel = \"Stress Plus One\";\nconst label = \"Stress\";\nconst changeBy = 1;\n\nconst keys = [\n    \"system.bonuses.abilities.save\",\n    \"system.bonuses.abilities.check\",\n    \"system.bonuses.mwak.attack\",\n    \"system.bonuses.rwak.attack\",\n    \"system.bonuses.msak.attack\",\n    \"system.bonuses.rsak.attack\"\n];\n\nactor = canvas.tokens.hover?.actor;\n\nif (canvas.tokens.hover === null) {\n    ui.notifications.warn(`${macroLabel}, Actor hovered ${actor?.name} invalid target.`);\n    return;\n}\n\n// works, but maybe save the state, delete the old one, create new one, in order to get out of the box stuff from ActiveEffect and Effect-Macro.\n\nconst effect = actor.effects.find(e => foundry.utils.hasProperty(e, \"flags.world.stress\"));\nconst current = effect?.getFlag(\"world\", \"stress\") ?? 0;\nconst stress = Number(Math.max(current + changeBy, 0));\nconst changes = keys.map(key => {\n    return { key, mode: CONST.ACTIVE_EFFECT_MODES.ADD, value: `-${stress}` };\n});\nconst effectData = { changes, icon };\nfoundry.utils.setProperty(effectData, \"label\", `${label}: ${stress}`);\nfoundry.utils.setProperty(effectData, \"flags.world.stress\", stress);\nif (effect) {\n    await effect.delete();\n}\n\nif (stress > 0) {\n    await actor.createEmbeddedDocuments(\"ActiveEffect\", [effectData]);\n}","ownership":{"default":0,"npmYF618vZgxA5SD":3},"flags":{"core":{"sourceId":"Macro.h9VFjFVm6w7kxY90"}},"_stats":{"systemId":"dnd5e","systemVersion":"2.0.3","coreVersion":"10.290","createdTime":1667650864581,"modifiedTime":1669150690649,"lastModifiedBy":"npmYF618vZgxA5SD"},"folder":null,"sort":0,"_id":"yRjCSiufpDFftlIK"}
{"name":"Regeneration Suppress","type":"script","scope":"global","author":"npmYF618vZgxA5SD","img":"icons/magic/life/heart-broken-red.webp","command":"/**\n * Control Bar Macro for suppressing regeneraion.\n * \n * https://github.com/itteerde/fvttconfig/issues/74\n */\n\nconst macroLabel = \"Regeneration Suppress\";\nconst flagKey = \"flags.world.regenerationSuppress\";\nconst icon = \"icons/magic/life/heart-broken-red.webp\";\n\nconst tokensToBeModified = canvas.tokens.controlled;\nconst actors = canvas.tokens.controlled.map(t => t.actor);\n\nconsole.log({ message: `${macroLabel}`, arguments: arguments, tokensToBeModified: tokensToBeModified, actors: actors });\n\nfor (let i = 0; i < actors.length; i++) {\n\n    const actor = actors[i];\n\n    const effect = actor.effects.find(e => foundry.utils.hasProperty(e, flagKey));\n    console.log({ message: `${macroLabel}`, effect: effect });\n\n    if (effect) {\n        ui.notifications.warn(`${macroLabel}, found effect on Actor: ${actor.name}. Only one instance per Actor allowed.`, { permanent: false });\n    }\n\n    const effectData = { icon, label: macroLabel, duration: { seconds: 6 } };\n    foundry.utils.setProperty(effectData, flagKey, true);\n    if (effect) {\n        console.log({ message: `${macroLabel}, updating effect.`, effect: effect, effectData: effectData });\n        await effect.update(effectData);\n    } else {\n        console.log({ message: `${macroLabel}, creating effect.`, effectData: effectData });\n        await actor.createEmbeddedDocuments(\"ActiveEffect\", [effectData]);\n    }\n}","ownership":{"default":0,"npmYF618vZgxA5SD":3},"flags":{"core":{"sourceId":"Macro.nChjMEh92A73wwQq"}},"_stats":{"systemId":"dnd5e","systemVersion":"2.0.3","coreVersion":"10.291","createdTime":1670537999877,"modifiedTime":1670616273555,"lastModifiedBy":"npmYF618vZgxA5SD"},"folder":null,"sort":0,"_id":"VFANpN0kedCzsy3v"}
