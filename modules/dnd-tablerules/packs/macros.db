{"name":"tHP +10","type":"script","scope":"global","author":"npmYF618vZgxA5SD","img":"icons/magic/life/heart-cross-strong-green.webp","command":"/**\n * Macro for GM Control Bar. Modifies hp.temp for the Token hovered's Actor with feedback by ChatMessage to self.\n */\n\nconst macroLabel = \"ModifyTempHP\";\nconst damage = -10;\n\nactor = canvas.tokens.hover?.actor;\n\nif (canvas.tokens.hover === null) {\n    ui.notifications.warn(`${macroLabel}, Actor hovered ${actor?.name} invalid target.`);\n    return;\n}\n\nconst oldTempHP = actor.system.attributes.hp.temp;\n\nawait actor.update({ \"system.attributes.hp.temp\": actor.system.attributes.hp.temp - damage });\n\n// https://pixijs.io/pixi-text-style/\ncanvas.interface.createScrollingText(token.center, oldTempHP - damage, { anchor: CONST.TEXT_ANCHOR_POINTS.CENTER, fill: \"#45c7f2\" });\n\n/*\nChatMessage.create({\n    content: `${macroLabel}: modifying hp.temp on ${actor.name} (${actor._id}), from ${oldTempHP} to ${actor.system.attributes.hp.temp}.`,\n    whisper: [game.users.getName(\"GM\")]\n});\n*/","ownership":{"default":0,"npmYF618vZgxA5SD":3},"flags":{"core":{"sourceId":"Macro.wU4J90a6ILMpD9e7"}},"_stats":{"systemId":"dnd5e","systemVersion":"2.0.3","coreVersion":"10.291","createdTime":1671342646115,"modifiedTime":1671342825087,"lastModifiedBy":"npmYF618vZgxA5SD"},"folder":null,"sort":0,"_id":"0nmRG3KeZiOFyPrv"}
{"name":"tHP +1","type":"script","scope":"global","author":"npmYF618vZgxA5SD","img":"icons/magic/life/heart-cross-strong-green.webp","command":"/**\n * Macro for GM Control Bar. Modifies hp.temp for the Token hovered's Actor with feedback by ChatMessage to self.\n */\n\nconst macroLabel = \"ModifyTempHP\";\nconst damage = -1;\n\nactor = canvas.tokens.hover?.actor;\n\nif (canvas.tokens.hover === null) {\n    ui.notifications.warn(`${macroLabel}, Actor hovered ${actor?.name} invalid target.`);\n    return;\n}\n\nconst oldTempHP = actor.system.attributes.hp.temp;\n\nawait actor.update({ \"system.attributes.hp.temp\": actor.system.attributes.hp.temp - damage });\n\n// https://pixijs.io/pixi-text-style/\ncanvas.interface.createScrollingText(token.center, oldTempHP - damage, { anchor: CONST.TEXT_ANCHOR_POINTS.CENTER, fill: \"#45c7f2\" });\n\n/*\nChatMessage.create({\n    content: `${macroLabel}: modifying hp.temp on ${actor.name} (${actor._id}), from ${oldTempHP} to ${actor.system.attributes.hp.temp}.`,\n    whisper: [game.users.getName(\"GM\")]\n});\n*/","ownership":{"default":0,"npmYF618vZgxA5SD":3},"flags":{"core":{"sourceId":"Macro.TuD4uG4rkGZaDcI6"}},"_stats":{"systemId":"dnd5e","systemVersion":"2.0.3","coreVersion":"10.291","createdTime":1671146797695,"modifiedTime":1671342823678,"lastModifiedBy":"npmYF618vZgxA5SD"},"folder":null,"sort":0,"_id":"70HbcsUNd7ti3Ixa"}
{"name":"ActorToConsole","type":"script","scope":"global","author":"g325YPUxaNNgCApI","img":"icons/svg/dice-target.svg","command":"const tokens = canvas.tokens.controlled;\nfor (let i = 0; i < tokens.length; i++) {\n    console.log(game.actors.get(tokens[i].document.actorId));\n}","ownership":{"default":0,"g325YPUxaNNgCApI":3},"flags":{"core":{"sourceId":"Macro.9CCDEv3NKAqG3QOu"}},"_stats":{"systemId":"dnd5e","systemVersion":"2.0.3","coreVersion":"10.288","createdTime":1665594319558,"modifiedTime":1667187834762,"lastModifiedBy":"g325YPUxaNNgCApI"},"folder":null,"sort":0,"_id":"71qjrOSoGFzpxkz4"}
{"name":"dim Up","type":"script","scope":"global","author":"YCF2Heb7DMHDaF2f","img":"modules/Tablerules/icons/gui/ScaleUp.png","command":"await token.document.update({height:token.document.height*2,width:token.document.width*2})","ownership":{"default":0,"ygKdWY9DRiutAWqh":3,"YCF2Heb7DMHDaF2f":3},"flags":{"core":{"sourceId":"Macro.gfnKUt1TrIDb6C9v"}},"_stats":{"systemId":"dnd5e","systemVersion":"2.1.5","coreVersion":"10.291","createdTime":1677796651056,"modifiedTime":1678644548847,"lastModifiedBy":"YCF2Heb7DMHDaF2f"},"folder":null,"sort":0,"_id":"7VNVkmxuI8GoRM9R"}
{"name":"Rotate CCW -1","type":"script","scope":"global","author":"YCF2Heb7DMHDaF2f","img":"modules/Tablerules/icons/gui/rotateCCW_white.png","command":"token.document.update({rotation:token.document.rotation-1});","ownership":{"default":0,"ygKdWY9DRiutAWqh":3,"YCF2Heb7DMHDaF2f":3},"flags":{"core":{"sourceId":"Macro.IQo3GajqRw4SE0P6"}},"_stats":{"systemId":"dnd5e","systemVersion":"2.1.4","coreVersion":"10.291","createdTime":1676490983132,"modifiedTime":1676491153315,"lastModifiedBy":"YCF2Heb7DMHDaF2f"},"folder":null,"sort":0,"_id":"7tOUV6uHwYAKnQL5"}
{"name":"Rotate CW +1","type":"script","scope":"global","author":"YCF2Heb7DMHDaF2f","img":"modules/Tablerules/icons/gui/rotateCW_white.png","command":"token.document.update({rotation:token.document.rotation+1});","ownership":{"default":0,"ygKdWY9DRiutAWqh":3,"YCF2Heb7DMHDaF2f":3},"flags":{"core":{"sourceId":"Macro.gHbCqKBGSwSkInfD"}},"_stats":{"systemId":"dnd5e","systemVersion":"2.1.4","coreVersion":"10.291","createdTime":1676490505197,"modifiedTime":1676491152039,"lastModifiedBy":"YCF2Heb7DMHDaF2f"},"folder":null,"sort":0,"_id":"7wM7ssXWMceCtR1A"}
{"name":"Report Dialog","type":"script","scope":"global","author":"npmYF618vZgxA5SD","img":"icons/svg/blind.svg","command":"/**\n * Report stuff for quick overview of the state of game\n * \n * https://github.com/itteerde/fvttconfig/issues/52\n*/\n\nconst macroLabel = \"Party State Report\";\nconst passivesIncluded = [\"insight\", \"perception\", \"investigation\"];\n\nconst partyIds = [\n    \"8ugKnRSqQzxSxrZO\", //Πως της αυγής (Copy)\n    \"FC2ZItcPqgCuvkhW\", //Enona Jadrcej 10\n    \"oNbN0RJqlNH2pfSQ\",\n    \"ui8iYXUbXVqLyiFX\",\n    \"SjsjOTHTLfnugGtm\",\n    \"xsI2KBbkRJlauxB7\",\n\"ZBwtXgGs6dzzilkY\"\n];\n\nconst party = partyIds.map(i => game.actors.get(i));\n\nlet dialogContent = `\n    <div class=\"dnd5e chat-card\">\n        <h1>Summary</h1>\n            <h2>HP and Spellslots</h2>\n            ${summary(party)}\n            <h2>Passives</h2>\n            ${passives(party, passivesIncluded)}\n    </div>`;\n\n//console.log({ message: macroLabel, summary: summary(party), dialogContent: dialogContent });\n\nlet d = new Dialog({\n    title: macroLabel,\n    content: dialogContent,\n    buttons: {\n        one: {\n            icon: '<i class=\"fas fa-check\"></i>',\n            label: \"\",\n        },\n    },\n    default: \"one\",\n    render: html => console.log(\"Register interactivity in the rendered dialog\"),\n    close: html => console.log(\"This always is logged no matter which option is chosen\")\n});\nd.render(true, { width: 750 });\n\nfunction summary(party) {\n    let html = \"<table><tr><th align=\\\"left\\\">Name</th><th align=\\\"left\\\">HP/max</th><th align=\\\"left\\\">Spell Slots</th></tr>\";\n    const rows = party.map(a => `<tr><td>${a.name}</td><td>${renderMeter(a)} ${a.system.attributes.hp.value}/${a.system.attributes.hp.max} ${a.system.attributes.hp.value < a.system.attributes.hp.max ? \" (\" + (a.system.attributes.hp.value - a.system.attributes.hp.max) + \")\" : \"\"}</td><td>${spellSlots(a)}</td></tr>`);\n    for (let i = 0; i < rows.length; i++) {\n        html += rows[i];\n    }\n    html += \"</table>\";\n    return html;\n}\n\nfunction renderMeter(actor) {\n    const fraction = actor.system.attributes.hp.value / actor.system.attributes.hp.max;\n\n    return `<meter value=\"${fraction}\" min=\"0\" max=\"1\" low=\"0.33\" high=\"0.66\" optimum=\"0.99\" style=\"width: 160px; height:25px;\"></meter>`;\n}\n\nfunction spellSlots(actor) {\n    let spellSlots = \"\";\n    if (actor.system.spells.spell1.max > 0) {\n        spellSlots += actor.system.spells.spell1.value;\n    }\n    if (actor.system.spells.spell2.max > 0) {\n        spellSlots += `,${actor.system.spells.spell2.value}`;\n    }\n    if (actor.system.spells.spell3.max > 0) {\n        spellSlots += `,${actor.system.spells.spell3.value}`;\n    }\n    if (actor.system.spells.spell4.max > 0) {\n        spellSlots += `,${actor.system.spells.spell4.value}`;\n    }\n    if (actor.system.spells.spell5.max > 0) {\n        spellSlots += `,${actor.system.spells.spell5.value}`;\n    }\n    if (actor.system.spells.spell6.max > 0) {\n        spellSlots += `,${actor.system.spells.spell6.value}`;\n    }\n    if (actor.system.spells.spell7.max > 0) {\n        spellSlots += `,${actor.system.spells.spell7.value}`;\n    }\n    if (actor.system.spells.spell8.max > 0) {\n        spellSlots += `,${actor.system.spells.spell8.value}`;\n    }\n    if (actor.system.spells.spell9.max > 0) {\n        spellSlots += `,${actor.system.spells.spell9.value}`;\n    }\n\n    if (actor.system.spells.pact.max > 0) {\n        spellSlots += `,${actor.system.spells.pact.value}p`;\n    }\n\n    const numberPrepared = actor.items.filter(i => i.system?.preparation?.prepared && i.system?.preparation?.mode === \"prepared\" && i.system?.level > 0).length;\n    if (numberPrepared > 0) {\n        spellSlots += `, (${numberPrepared} prepared)`;\n    }\n\n    return spellSlots;\n}\n\nfunction passives(party, passivesIncluded) {\n    let acrobatics = { names: [], max: 0 };\n    let animalHandling = { names: [], max: 0 };\n    let arcana = { names: [], max: 0 };\n    let athletics = { names: [], max: 0 };\n    let deception = { names: [], max: 0 };\n    let history = { names: [], max: 0 };\n    let insight = { names: [], max: 0 };\n    let investigation = { names: [], max: 0 };\n    let intimidation = { names: [], max: 0 };\n    let medicine = { names: [], max: 0 };\n    let nature = { names: [], max: 0 };\n    let persuasion = { names: [], max: 0 };\n    let perception = { names: [], max: 0 };\n    let performance = { names: [], max: 0 };\n    let religion = { names: [], max: 0 };\n    let sleightOfHand = { names: [], max: 0 };\n    let stealth = { names: [], max: 0 };\n    let survival = { names: [], max: 0 };\n\n\n    let passives = `\n    <table>\n        <tr>\n            <th align=\\\"left\\\">Skill</th><th align=\\\"left\\\">Max</th><th align=\\\"left\\\">Characters</th>\n        </tr>`;\n\n    if (passivesIncluded.includes(\"acrobatics\")) {\n        for (let i = 0; i < party.length; i++) {\n            if (party[i].system.skills.acr.passive === acrobatics.max) {\n                acrobatics.names.push(party[i].name);\n            }\n            if (party[i].system.skills.acr.passive > acrobatics.max) {\n                acrobatics.names = [party[i].name];\n                acrobatics.max = party[i].system.skills.acr.passive;\n            }\n        }\n\n        passives += `<tr><td>Acrobatics</td><td>${acrobatics.max}</td><td>${acrobatics.names}</td></tr>`;\n    }\n\n    if (passivesIncluded.includes(\"animalHandling\")) {\n        for (let i = 0; i < party.length; i++) {\n            if (party[i].system.skills.ani.passive === animalHandling.max) {\n                animalHandling.names.push(party[i].name);\n            }\n            if (party[i].system.skills.ani.passive > animalHandling.max) {\n                animalHandling.names = [party[i].name];\n                animalHandling.max = party[i].system.skills.ani.passive;\n            }\n        }\n\n        passives += `<tr><td>Animal Handling</td><td>${animalHandling.max}</td><td>${animalHandling.names}</td></tr>`;\n    }\n\n    if (passivesIncluded.includes(\"arcana\")) {\n        for (let i = 0; i < party.length; i++) {\n            if (party[i].system.skills.arc.passive === arcana.max) {\n                arcana.names.push(party[i].name);\n            }\n            if (party[i].system.skills.arc.passive > arcana.max) {\n                arcana.names = [party[i].name];\n                arcana.max = party[i].system.skills.arc.passive;\n            }\n        }\n\n        passives += `<tr><td>Arcana</td><td>${arcana.max}</td><td>${arcana.names}</td></tr>`;\n    }\n\n    if (passivesIncluded.includes(\"athletics\")) {\n        for (let i = 0; i < party.length; i++) {\n            if (party[i].system.skills.ath.passive === athletics.max) {\n                athletics.names.push(party[i].name);\n            }\n            if (party[i].system.skills.ath.passive > athletics.max) {\n                athletics.names = [party[i].name];\n                athletics.max = party[i].system.skills.ath.passive;\n            }\n        }\n\n        passives += `<tr><td>Athletics</td><td>${athletics.max}</td><td>${athletics.names}</td></tr>`;\n    }\n\n    if (passivesIncluded.includes(\"deception\")) {\n        for (let i = 0; i < party.length; i++) {\n            if (party[i].system.skills.dec.passive === deception.max) {\n                deception.names.push(party[i].name);\n            }\n            if (party[i].system.skills.dec.passive > deception.max) {\n                deception.names = [party[i].name];\n                deception.max = party[i].system.skills.dec.passive;\n            }\n        }\n\n        passives += `<tr><td>Deception</td><td>${deception.max}</td><td>${deception.names}</td></tr>`;\n    }\n\n    if (passivesIncluded.includes(\"history\")) {\n        for (let i = 0; i < party.length; i++) {\n            if (party[i].system.skills.his.passive === history.max) {\n                history.names.push(party[i].name);\n            }\n            if (party[i].system.skills.his.passive > history.max) {\n                history.names = [party[i].name];\n                history.max = party[i].system.skills.his.passive;\n            }\n        }\n\n        passives += `<tr><td>History</td><td>${history.max}</td><td>${history.names}</td></tr>`;\n    }\n\n    if (passivesIncluded.includes(\"insight\")) {\n        for (let i = 0; i < party.length; i++) {\n            if (party[i].system.skills.ins.passive === insight.max) {\n                insight.names.push(party[i].name);\n            }\n            if (party[i].system.skills.ins.passive > insight.max) {\n                insight.names = [party[i].name];\n                insight.max = party[i].system.skills.ins.passive;\n            }\n        }\n\n        passives += `<tr><td>Insight</td><td>${insight.max}</td><td>${insight.names}</td></tr>`;\n    }\n\n    if (passivesIncluded.includes(\"investigation\")) {\n        for (let i = 0; i < party.length; i++) {\n            if (party[i].system.skills.inv.passive === investigation.max) {\n                investigation.names.push(party[i].name);\n            }\n            if (party[i].system.skills.inv.passive > investigation.max) {\n                investigation.names = [party[i].name];\n                investigation.max = party[i].system.skills.inv.passive;\n            }\n        }\n\n        passives += `<tr><td>Investigation</td><td>${investigation.max}</td><td>${investigation.names}</td></tr>`;\n    }\n\n    if (passivesIncluded.includes(\"intimidation\")) {\n        for (let i = 0; i < party.length; i++) {\n            if (party[i].system.skills.itm.passive === intimidation.max) {\n                intimidation.names.push(party[i].name);\n            }\n            if (party[i].system.skills.itm.passive > intimidation.max) {\n                intimidation.names = [party[i].name];\n                intimidation.max = party[i].system.skills.itm.passive;\n            }\n        }\n\n        passives += `<tr><td>Intimidation</td><td>${intimidation.max}</td><td>${intimidation.names}</td></tr>`;\n    }\n\n    if (passivesIncluded.includes(\"medicine\")) {\n        for (let i = 0; i < party.length; i++) {\n            if (party[i].system.skills.med.passive === medicine.max) {\n                medicine.names.push(party[i].name);\n            }\n            if (party[i].system.skills.med.passive > medicine.max) {\n                medicine.names = [party[i].name];\n                medicine.max = party[i].system.skills.med.passive;\n            }\n        }\n\n        passives += `<tr><td>Medicine</td><td>${medicine.max}</td><td>${medicine.names}</td></tr>`;\n    }\n\n    if (passivesIncluded.includes(\"nature\")) {\n        for (let i = 0; i < party.length; i++) {\n            if (party[i].system.skills.nat.passive === nature.max) {\n                nature.names.push(party[i].name);\n            }\n            if (party[i].system.skills.nat.passive > nature.max) {\n                nature.names = [party[i].name];\n                nature.max = party[i].system.skills.nat.passive;\n            }\n        }\n\n        passives += `<tr><td>Nature</td><td>${nature.max}</td><td>${nature.names}</td></tr>`;\n    }\n\n    if (passivesIncluded.includes(\"perception\")) {\n        for (let i = 0; i < party.length; i++) {\n            if (party[i].system.skills.prc.passive === perception.max) {\n                perception.names.push(party[i].name);\n            }\n            if (party[i].system.skills.prc.passive > perception.max) {\n                perception.names = [party[i].name];\n                perception.max = party[i].system.skills.prc.passive;\n            }\n        }\n\n        passives += `<tr><td>Perception</td><td>${perception.max}</td><td>${perception.names}</td></tr>`;\n    }\n\n    if (passivesIncluded.includes(\"persuasion\")) {\n        for (let i = 0; i < party.length; i++) {\n            if (party[i].system.skills.per.passive === persuasion.max) {\n                persuasion.names.push(party[i].name);\n            }\n            if (party[i].system.skills.per.passive > persuasion.max) {\n                persuasion.names = [party[i].name];\n                persuasion.max = party[i].system.skills.per.passive;\n            }\n        }\n\n        passives += `<tr><td>Persuasion</td><td>${persuasion.max}</td><td>${persuasion.names}</td></tr>`;\n    }\n\n    if (passivesIncluded.includes(\"performance\")) {\n        for (let i = 0; i < party.length; i++) {\n            if (party[i].system.skills.prf.passive === performance.max) {\n                performance.names.push(party[i].name);\n            }\n            if (party[i].system.skills.prf.passive > performance.max) {\n                performance.names = [party[i].name];\n                performance.max = party[i].system.skills.prf.passive;\n            }\n        }\n\n        passives += `<tr><td>Performance</td><td>${performance.max}</td><td>${performance.names}</td></tr>`;\n    }\n\n    if (passivesIncluded.includes(\"religion\")) {\n        for (let i = 0; i < party.length; i++) {\n            if (party[i].system.skills.rel.passive === religion.max) {\n                religion.names.push(party[i].name);\n            }\n            if (party[i].system.skills.rel.passive > religion.max) {\n                religion.names = [party[i].name];\n                religion.max = party[i].system.skills.rel.passive;\n            }\n        }\n\n        passives += `<tr><td>Religion</td><td>${religion.max}</td><td>${religion.names}</td></tr>`;\n    }\n\n    if (passivesIncluded.includes(\"sleightOfHand\")) {\n        for (let i = 0; i < party.length; i++) {\n            if (party[i].system.skills.slt.passive === sleightOfHand.max) {\n                sleightOfHand.names.push(party[i].name);\n            }\n            if (party[i].system.skills.slt.passive > sleightOfHand.max) {\n                sleightOfHand.names = [party[i].name];\n                sleightOfHand.max = party[i].system.skills.slt.passive;\n            }\n        }\n\n        passives += `<tr><td>Sleight of Hand</td><td>${sleightOfHand.max}</td><td>${sleightOfHand.names}</td></tr>`;\n    }\n\n    if (passivesIncluded.includes(\"stealth\")) {\n        for (let i = 0; i < party.length; i++) {\n            if (party[i].system.skills.ste.passive === stealth.max) {\n                stealth.names.push(party[i].name);\n            }\n            if (party[i].system.skills.ste.passive > stealth.max) {\n                stealth.names = [party[i].name];\n                stealth.max = party[i].system.skills.ste.passive;\n            }\n        }\n\n        passives += `<tr><td>Stealth</td><td>${stealth.max}</td><td>${stealth.names}</td></tr>`;\n    }\n\n    if (passivesIncluded.includes(\"survival\")) {\n        for (let i = 0; i < party.length; i++) {\n            if (party[i].system.skills.sur.passive === survival.max) {\n                survival.names.push(party[i].name);\n            }\n            if (party[i].system.skills.sur.passive > survival.max) {\n                survival.names = [party[i].name];\n                survival.max = party[i].system.skills.sur.passive;\n            }\n        }\n\n        passives += `<tr><td>Survival</td><td>${survival.max}</td><td>${survival.names}</td></tr>`;\n    }\n\n    passives += `</table>`;\n\n    return passives;\n}","ownership":{"default":0,"npmYF618vZgxA5SD":3},"flags":{"core":{"sourceId":"Macro.vyaBDAW77v6ziAei"}},"_stats":{"systemId":"dnd5e","systemVersion":"2.0.3","coreVersion":"10.291","createdTime":1670957883646,"modifiedTime":1672019050691,"lastModifiedBy":"npmYF618vZgxA5SD"},"folder":null,"sort":0,"_id":"CbS9Fa51bEciia0z"}
{"name":"-10hp","type":"script","scope":"global","author":"npmYF618vZgxA5SD","img":"modules/Tablerules/icons/magic/healing/r10.webp","command":"const damage = 10;\n\nactor = canvas.tokens.hover?.actor;\n\nif (canvas.tokens.hover === null) {\n    ui.notifications.warn(`${macroLabel}, Actor hovered ${actor?.name} invalid target.`);\n    return;\n}\n\nactor.applyDamage(damage);","ownership":{"default":0,"npmYF618vZgxA5SD":3},"flags":{"core":{"sourceId":"Macro.7Zq6jeF6XTfU4P6s"}},"_stats":{"systemId":"dnd5e","systemVersion":"2.0.3","coreVersion":"10.290","createdTime":1668446799383,"modifiedTime":1668454525583,"lastModifiedBy":"npmYF618vZgxA5SD"},"folder":null,"sort":0,"_id":"Dj8u2n86kWN4Lrvl"}
{"name":"Lights Out","type":"script","scope":"global","author":"npmYF618vZgxA5SD","img":"icons/sundries/lights/lantern-steel.webp","command":"// icon suggestion: icons/sundries/lights/lantern-steel.webp\nconst tokensToBeModified = canvas.tokens.controlled;\nfor (let i = 0; i < tokensToBeModified.length; i++) {\n    if (tokensToBeModified[i].data.light.dim !== 0) {\n        await tokensToBeModified[i].document.update({\n            light: {\n                alpha: 0.5,\n                angle: 0,\n                bright: 0,\n                color: \"#000000\",\n                coloration: 1,\n                dim: 0,\n                gradual: true,\n                luminosity: 0.5,\n                saturation: 0,\n                contrast: 0,\n                shadows: 0,\n                animation: {\n                    speed: 5,\n                    intensity: 5,\n                    reverse: false,\n                },\n                darkness: {\n                    min: 0,\n                    max: 1,\n                },\n            },\n        });\n    }\n}","ownership":{"default":0,"npmYF618vZgxA5SD":3},"flags":{"core":{"sourceId":"Macro.RwgvgVqRscTRwvXw"}},"_stats":{"systemId":"dnd5e","systemVersion":"2.0.3","coreVersion":"10.290","createdTime":1668318820559,"modifiedTime":1668318859555,"lastModifiedBy":"npmYF618vZgxA5SD"},"folder":null,"sort":0,"_id":"EapfJgLDvZ3XYHwL"}
{"name":"+10hp","type":"script","scope":"global","author":"npmYF618vZgxA5SD","img":"modules/Tablerules/icons/magic/healing/g10.webp","command":"const damage = -10;\n\nactor = canvas.tokens.hover?.actor;\n\nif (canvas.tokens.hover === null) {\n    ui.notifications.warn(`${macroLabel}, Actor hovered ${actor?.name} invalid target.`);\n    return;\n}\n\nactor.applyDamage(damage);","ownership":{"default":0,"npmYF618vZgxA5SD":3},"flags":{"core":{"sourceId":"Macro.S1C7ytpywSYgMhrL"}},"_stats":{"systemId":"dnd5e","systemVersion":"2.0.3","coreVersion":"10.290","createdTime":1668446963152,"modifiedTime":1668454531441,"lastModifiedBy":"npmYF618vZgxA5SD"},"folder":null,"sort":0,"_id":"HLaeO6aEfvFXofQb"}
{"name":"listActiveModules","type":"script","scope":"global","author":"npmYF618vZgxA5SD","img":"icons/svg/dice-target.svg","command":"// the console report can be copied directly into the Markdown documentation (right-click copy String contents)\n\nconst modulesActive = game.modules.filter(m => m.active);\nconst moduleReport = modulesActive.map(\n    m => ({ id: m.id, title: m.title, version: m.version })\n);\nconsole.log(modulesActive);\nconsole.log(moduleReport);\n\nlet reportString = \"\";\n\nfor (i = 0; i < modulesActive.length; i++) {\n    m = modulesActive[i];\n    reportString = `${reportString}\\n1. ${m.title} (version: ${m.version}) : [Project-URL](${m.url})`;\n}\n\nconsole.log({ reportString: reportString });","ownership":{"default":0,"npmYF618vZgxA5SD":3},"flags":{"core":{"sourceId":"Macro.JjoRX5KwFPNQdSlr"}},"_stats":{"systemId":"dnd5e","systemVersion":"2.0.3","coreVersion":"10.290","createdTime":1668016102525,"modifiedTime":1668184530058,"lastModifiedBy":"npmYF618vZgxA5SD"},"folder":null,"sort":0,"_id":"KnJ4shfO7vbi8eqg"}
{"name":"WordCount","type":"script","scope":"global","author":"YCF2Heb7DMHDaF2f","img":"icons/tools/scribal/spectacles-glasses.webp","command":"const text = \"This is a text for which something or somebody would like to know how many words it has.\";\n\nconst dialog = true;\nconst chat = false;\n\nif(dialog)\nnew Dialog({title: \"Word Count\", content: `${text} (${text.split(\" \").length} words)`, buttons: {}}).render(true);\n\nif(chat)\nawait ChatMessage.create({content: `${text} (${text.split(\" \").length} words)`});","ownership":{"default":0,"YCF2Heb7DMHDaF2f":3},"flags":{"core":{"sourceId":"Macro.3xg5gwq3Xjndnef0"}},"_stats":{"systemId":"dnd5e","systemVersion":"2.1.5","coreVersion":"10.291","createdTime":1679871232461,"modifiedTime":1679871799433,"lastModifiedBy":"YCF2Heb7DMHDaF2f"},"folder":null,"sort":0,"_id":"Lsdabf2KD1dWYt51"}
{"name":"Update Initiative","type":"script","scope":"global","author":"YCF2Heb7DMHDaF2f","img":"icons/magic/time/clock-stopwatch-white-blue.webp","command":"/**\n * Control Bar Macro for putting all summoned Actors' initiative to their summoners in order to enable letting them have their Turn after the Actor who summoned them.\n */\n\nconst combats = game.combats;\n\nif (combats.size === 0) {\n    ui.notifications.warn(\"No active combats found.\");\n    return;\n}\n\n// tie-breaking (skip this for the time being)\n\nasync function doCombatant(combatant, combat) {\n    const token = game.scenes.get(combatant.sceneId).tokens.get(combatant.tokenId); // is a TokenDocument5e both for pc and npc\n    if (token.actorData?.flags?.world?.summoned === undefined) {\n        return;\n    }\n\n    const summonerId = token.actorData.flags.world.summoned.actor.substring(6);\n    const summonerCombatant = combat.turns.find(c => c.actorId === summonerId);\n\n    await combatant.update({ initiative: summonerCombatant.initiative - 0.01 });\n}\n\nfunction adjustCombat(combat) {\n    for (const c of combat.turns) {\n        doCombatant(c, combat);\n    }\n}\n\ncombats.forEach(adjustCombat);","ownership":{"default":0,"YCF2Heb7DMHDaF2f":3},"flags":{"core":{"sourceId":"Macro.iJBq47kINY76PaJj"}},"_stats":{"systemId":"dnd5e","systemVersion":"2.1.5","coreVersion":"10.291","createdTime":1678670079448,"modifiedTime":1678718099932,"lastModifiedBy":"YCF2Heb7DMHDaF2f"},"folder":null,"sort":0,"_id":"O7AUr3MNLZMIFe4Y"}
{"name":"Torch (Selected)","type":"script","scope":"global","author":"npmYF618vZgxA5SD","img":"icons/sundries/lights/torch-brown-lit.webp","command":"// icon suggestion: icons/sundries/lights/torch-brown-lit.webp\nconst dim_range = 40;\nconst bright_range = 20;\nconst tokensToBeModified = canvas.tokens.controlled;\nfor (let i = 0; i < tokensToBeModified.length; i++) {\n\tif (tokensToBeModified[i].data.light.dim === 0) {\n\t\tawait tokensToBeModified[i].document.update({\n\t\t\tlight: {\n\t\t\t\talpha: 0.2,\n\t\t\t\tangle: 0,\n\t\t\t\tbright: bright_range,\n\t\t\t\tcoloration: 1,\n\t\t\t\tdim: dim_range,\n\t\t\t\tgradual: true,\n\t\t\t\tluminosity: 0.5,\n\t\t\t\tsaturation: 0,\n\t\t\t\tcontrast: 0.25,\n\t\t\t\tshadows: 0,\n\t\t\t\tanimation: {\n\t\t\t\t\tspeed: 1,\n\t\t\t\t\tintensity: 2,\n\t\t\t\t\treverse: false,\n\t\t\t\t\ttype: \"torch\",\n\t\t\t\t},\n\t\t\t\tdarkness: {\n\t\t\t\t\tmin: 0,\n\t\t\t\t\tmax: 1,\n\t\t\t\t},\n\t\t\t\tcolor: \"#f3e09b\",\n\t\t\t},\n\t\t});\n\t} else {\n\t\tawait tokensToBeModified[i].document.update({\n\t\t\tlight: {\n\t\t\t\talpha: 0.5,\n\t\t\t\tangle: 0,\n\t\t\t\tbright: 0,\n\t\t\t\tcolor: \"#000000\",\n\t\t\t\tcoloration: 1,\n\t\t\t\tdim: 0,\n\t\t\t\tgradual: true,\n\t\t\t\tluminosity: 0.5,\n\t\t\t\tsaturation: 0,\n\t\t\t\tcontrast: 0,\n\t\t\t\tshadows: 0,\n\t\t\t\tanimation: {\n\t\t\t\t\tspeed: 5,\n\t\t\t\t\tintensity: 5,\n\t\t\t\t\treverse: false,\n\t\t\t\t},\n\t\t\t\tdarkness: {\n\t\t\t\t\tmin: 0,\n\t\t\t\t\tmax: 1,\n\t\t\t\t},\n\t\t\t},\n\t\t});\n\t}\n}","ownership":{"default":0,"npmYF618vZgxA5SD":3},"flags":{"core":{"sourceId":"Macro.ZcpMEBvmrtf4fC4y"}},"_stats":{"systemId":"dnd5e","systemVersion":"2.0.3","coreVersion":"10.290","createdTime":1668692035955,"modifiedTime":1669742083890,"lastModifiedBy":"npmYF618vZgxA5SD"},"folder":null,"sort":0,"_id":"Q1AruMQQJk0HoSgR"}
{"name":"Rotate CW +45","type":"script","scope":"global","author":"YCF2Heb7DMHDaF2f","img":"modules/Tablerules/icons/gui/rotateCW_white.png","command":"token.document.update({rotation:token.document.rotation+45});","ownership":{"default":0,"ygKdWY9DRiutAWqh":3,"YCF2Heb7DMHDaF2f":3},"flags":{"core":{"sourceId":"Macro.gHbCqKBGSwSkInfD"}},"_stats":{"systemId":"dnd5e","systemVersion":"2.1.4","coreVersion":"10.291","createdTime":1676490505197,"modifiedTime":1676491236106,"lastModifiedBy":"YCF2Heb7DMHDaF2f"},"folder":null,"sort":0,"_id":"QJyLzdKo3cq3059f"}
{"name":"Rotate CCW -45","type":"script","scope":"global","author":"YCF2Heb7DMHDaF2f","img":"modules/Tablerules/icons/gui/rotateCCW_white.png","command":"token.document.update({rotation:token.document.rotation-45});","ownership":{"default":0,"ygKdWY9DRiutAWqh":3,"YCF2Heb7DMHDaF2f":3},"flags":{"core":{"sourceId":"Macro.IQo3GajqRw4SE0P6"}},"_stats":{"systemId":"dnd5e","systemVersion":"2.1.4","coreVersion":"10.291","createdTime":1676490983132,"modifiedTime":1676491233813,"lastModifiedBy":"YCF2Heb7DMHDaF2f"},"folder":null,"sort":0,"_id":"TLZlFBbhRMphYkCB"}
{"name":"tHP -1","type":"script","scope":"global","author":"npmYF618vZgxA5SD","img":"icons/magic/life/heart-cross-strong-purple-orange.webp","command":"/**\n * Macro for GM Control Bar. Modifies hp.temp for the Token hovered's Actor with feedback by ChatMessage to self.\n */\n\nconst macroLabel = \"ModifyTempHP\";\nconst damage = 1;\n\nactor = canvas.tokens.hover?.actor;\n\nif (canvas.tokens.hover === null) {\n    ui.notifications.warn(`${macroLabel}, Actor hovered ${actor?.name} invalid target.`);\n    return;\n}\n\nconst oldTempHP = actor.system.attributes.hp.temp;\n\nawait actor.update({ \"system.attributes.hp.temp\": actor.system.attributes.hp.temp - damage });\n\n// https://pixijs.io/pixi-text-style/\ncanvas.interface.createScrollingText(token.center, oldTempHP - damage, { anchor: CONST.TEXT_ANCHOR_POINTS.CENTER, fill: \"#45c7f2\" });\n\n/*\nChatMessage.create({\n    content: `${macroLabel}: modifying hp.temp on ${actor.name} (${actor._id}), from ${oldTempHP} to ${actor.system.attributes.hp.temp}.`,\n    whisper: [game.users.getName(\"GM\")]\n});\n*/","ownership":{"default":0,"npmYF618vZgxA5SD":3},"flags":{"core":{"sourceId":"Macro.8XGSMg6YPEakrX2l"}},"_stats":{"systemId":"dnd5e","systemVersion":"2.0.3","coreVersion":"10.291","createdTime":1671340298660,"modifiedTime":1671342822509,"lastModifiedBy":"npmYF618vZgxA5SD"},"folder":null,"sort":0,"_id":"VM9Jyrf9d1YBk2yd"}
{"name":"ScaleUp","type":"script","scope":"global","author":"npmYF618vZgxA5SD","img":"modules/Tablerules/icons/gui/ScaleUp.png","command":"const scalingPercent = 5/100;\ntoken = canvas.tokens.controlled[0];\nawait token.document.update({\"texture.scaleX\":token.document.texture.scaleX * (1+scalingPercent),\"texture.scaleY\":token.document.texture.scaleY * (1+scalingPercent)});","ownership":{"default":0,"npmYF618vZgxA5SD":3},"flags":{"core":{"sourceId":"Macro.1xrW2YrC5jConchC"}},"_stats":{"systemId":"dnd5e","systemVersion":"2.0.3","coreVersion":"10.291","createdTime":1670444236834,"modifiedTime":1670514663196,"lastModifiedBy":"npmYF618vZgxA5SD"},"folder":null,"sort":0,"_id":"WhNLy8hgiUrVrV49"}
{"name":"ScaleDown","type":"script","scope":"global","author":"npmYF618vZgxA5SD","img":"modules/Tablerules/icons/gui/ScaleDown.png","command":"const scalingPercent = -(5/100);\ntoken = canvas.tokens.controlled[0];\nawait token.document.update({\"texture.scaleX\":token.document.texture.scaleX * (1+scalingPercent),\"texture.scaleY\":token.document.texture.scaleY * (1+scalingPercent)});","ownership":{"default":0,"npmYF618vZgxA5SD":3},"flags":{"core":{"sourceId":"Macro.6mAbWFLRhOU8xQfj"}},"_stats":{"systemId":"dnd5e","systemVersion":"2.0.3","coreVersion":"10.291","createdTime":1670444547714,"modifiedTime":1670514660205,"lastModifiedBy":"npmYF618vZgxA5SD"},"folder":null,"sort":0,"_id":"Y72nBr6LhJLgco8D"}
{"name":"Cycle Wildcard Token","type":"script","scope":"global","author":"npmYF618vZgxA5SD","img":"icons/svg/dice-target.svg","command":"// https://github.com/krbz999/zhell-macros/blob/main/tools/token/cycle_token_wildcards.js\nconst currentImg = token.document.texture.src;\nconst actorId = token.actor.id;\nconst wildcardImages = await game.actors.get(actorId).getTokenImages();\nconst currentIndex = wildcardImages.indexOf(currentImg);\nconst next = (currentIndex + 1) === wildcardImages.length ? 0 : currentIndex + 1;\nawait token.document.update({ \"texture.src\": wildcardImages[next] });","ownership":{"default":0,"npmYF618vZgxA5SD":3},"flags":{"core":{"sourceId":"Macro.hjsPei1SwSYahJ6m"}},"_stats":{"systemId":"dnd5e","systemVersion":"2.0.3","coreVersion":"10.290","createdTime":1668177770431,"modifiedTime":1668184498110,"lastModifiedBy":"npmYF618vZgxA5SD"},"folder":null,"sort":0,"_id":"bPbwE5JCZkByg9w5"}
{"name":"Stress","type":"script","scope":"global","author":"g325YPUxaNNgCApI","img":"icons/magic/death/undead-ghosts-trio-blue.webp","command":"//const actorIds = [\"tBmsCEZ4otbmmPcO\",\"anotherID\",\"...\"]; // for corner cases and whatever\nconst actorIds = canvas.tokens.controlled.map(t => t.actor.id);\nconst icon = \"icons/magic/death/undead-ghosts-trio-blue.webp\";\nconst label = \"Stress\";\n\nconst keys = [\n  \"system.bonuses.abilities.save\",\n  \"system.bonuses.abilities.check\",\n  \"system.bonuses.mwak.attack\",\n  \"system.bonuses.rwak.attack\",\n  \"system.bonuses.msak.attack\",\n  \"system.bonuses.rsak.attack\"\n];\nconst actorOptions = actorIds.reduce((acc, id) => {\n  const name = game.actors.get(id).name;\n  return acc + `<option value=\"${id}\">${name}</option>`;\n}, \"\");\nconst dirOptions = `\n<option value=\"-1\">Reduce Stress</option>\n<option value=\"1\">Increase Stress</option>`;\nconst content = `\n<form>\n  <div class=\"form-group\">\n    <label>Affected Actor:</laberl>\n    <div class=\"form-fields\">\n      <select id=\"target-stress-actor\">${actorOptions}</select>\n      <select id=\"stress-direction\">${dirOptions}</select>\n    </div>\n  </div>\n</form>`;\nawait Dialog.prompt({\n  title: \"Stress Config\", content, callback: (html) => {\n    const actorId = html[0].querySelector(\"#target-stress-actor\").value;\n    const dir = html[0].querySelector(\"#stress-direction\").value;\n    return updateValue(actorId, dir);\n  }\n});\n\nfunction updateValue(actorId, dir) {\n  const actor = game.actors.get(actorId);\n  const effect = actor.effects.find(e => foundry.utils.hasProperty(e, \"flags.world.stress\"));\n  const current = effect?.getFlag(\"world\", \"stress\") ?? 0;\n  //    const stress = Number(Math.max(current, 0)) + Number(dir);\n  const stress = Number(Math.max(current + Number(dir), 0));\n  const changes = keys.map(key => {\n    return { key, mode: CONST.ACTIVE_EFFECT_MODES.ADD, value: `-${stress}` };\n  });\n  const effectData = { changes, icon, label };\n  foundry.utils.setProperty(effectData, \"flags.world.stress\", stress);\n  if (effect) return effect.update(effectData);\n  return actor.createEmbeddedDocuments(\"ActiveEffect\", [effectData]);\n}","ownership":{"default":0,"g325YPUxaNNgCApI":3},"flags":{"core":{"sourceId":"Macro.dkK4qMJG7zQLkfT0"}},"_stats":{"systemId":"dnd5e","systemVersion":"2.0.3","coreVersion":"10.288","createdTime":1667051893165,"modifiedTime":1667187932266,"lastModifiedBy":"g325YPUxaNNgCApI"},"folder":null,"sort":0,"_id":"bUIwtAnVoqFQgdKV"}
{"name":"tHP -10","type":"script","scope":"global","author":"npmYF618vZgxA5SD","img":"icons/magic/life/heart-cross-strong-purple-orange.webp","command":"/**\n * Macro for GM Control Bar. Modifies hp.temp for the Token hovered's Actor with feedback by ChatMessage to self.\n */\n\nconst macroLabel = \"ModifyTempHP\";\nconst damage = 10;\n\nactor = canvas.tokens.hover?.actor;\n\nif (canvas.tokens.hover === null) {\n    ui.notifications.warn(`${macroLabel}, Actor hovered ${actor?.name} invalid target.`);\n    return;\n}\n\nconst oldTempHP = actor.system.attributes.hp.temp;\n\nawait actor.update({ \"system.attributes.hp.temp\": actor.system.attributes.hp.temp - damage });\n\n// https://pixijs.io/pixi-text-style/\ncanvas.interface.createScrollingText(token.center, oldTempHP - damage, { anchor: CONST.TEXT_ANCHOR_POINTS.CENTER, fill: \"#45c7f2\" });\n\n/*\nChatMessage.create({\n    content: `${macroLabel}: modifying hp.temp on ${actor.name} (${actor._id}), from ${oldTempHP} to ${actor.system.attributes.hp.temp}.`,\n    whisper: [game.users.getName(\"GM\")]\n});\n*/","ownership":{"default":0,"npmYF618vZgxA5SD":3},"flags":{"core":{"sourceId":"Macro.ZTxgSVmy8C1H7sv8"}},"_stats":{"systemId":"dnd5e","systemVersion":"2.0.3","coreVersion":"10.291","createdTime":1671342625465,"modifiedTime":1671342820784,"lastModifiedBy":"npmYF618vZgxA5SD"},"folder":null,"sort":0,"_id":"ciiwkTXvc4OB0l5a"}
{"name":"Twilight Sanctuary tHP","type":"script","scope":"global","author":"npmYF618vZgxA5SD","img":"icons/magic/light/light-lantern-lit-white.webp","command":"/* \n    icon suggestion: icons/magic/light/light-lantern-lit-white.webp\n    source: https://github.com/itteerde/fvttconfig/blob/main/tools/macros/gm/TwilightSanctuaryTakeTempHP.js\n    discussion: https://github.com/itteerde/fvttconfig/issues/29\n\n    I think I like the version where the Cleric player gets the `Effect` (that can create the `Aura` [either already or once we adopt `Effect Macro` which we'll test]) for having the `Twilight Sanctuary` active, maybe being applied by hitting the `Feature` (think we have that possibility already). All players get another `Macro` `Take Twilight Sanctuary HP` that looks for the active `Twilight Sanctuary` (everyone can read everything through code, just not save changes non-locally, so everyone can find the source in order to read their Cleric-Level), `Roll` and upgrade their own `Actor.system.attributes.hp.temp`.\n\n    We do not let the Cleric player give the temp hp as that would require socket registering and programming or warpgate in order to modify an `Actor` the `User` does have the prvileges to modify.\n*/\n\nconst macroLabel = \"Channel Divinity: Twilight Sanctuary tempHP\";\nconst sourceLabel = \"Channel Divinity: Twilight Sanctuary\";\nconst useDistance3D = true;\n\n//get the source Twilight Cleric\nconst twilightClericPCs = canvas.tokens.placeables.filter(t => {\n    if (t.actor.type !== \"character\")\n        return;\n    if (!t.actor.items.find(i => i.name === \"Twilight Domain\"))\n        return;\n    return t.actor.effects.find(e => e.label === \"Channel Divinity: Twilight Sanctuary\");\n});\nconsole.log(twilightClericPCs);\n\nif (twilightClericPCs.length === 0) {\n    ui.notifications.error(\n        `${macroLabel}, ${twilightClericPCs.length} Twilight Clerics found.`,\n        { permanent: true }\n    );\n    return;\n}\n\n// check validity of source, maybe enforce hover if it is not?\nif (twilightClericPCs.length !== 1) {\n    ui.notifications.warn(\n        `${macroLabel}, ${twilightClericPCs.length} Twilight Clerics found. Expected 1 and only 1.`,\n        { permanent: true }\n    );\n}\n\n\n// target?\nif (canvas.tokens.controlled.length !== 1) {\n    ui.notifications.error(`${macroLabel}, ${canvas.tokens.controlled.length} Actors selected. Select 1 and only 1.`, { permanent: true });\n    return;\n}\n\nif (actor.type !== \"character\") {\n    ui.notifications.error(`${macroLabel}, Actor selected is type:${actor.type}. Select a character.`);\n    return;\n}\n\nconsole.log({ target: actor, name: actor.name, id: actor._id });\n\n\n// check distance\nconst tokenSource = twilightClericPCs[0]; // this is not sound, there should be logid to chose if there are more than one.\n\nconst tokenTarget = canvas.tokens.placeables.find(t => t.actor._id === actor._id); // also not sound technically. There might be more than one Token for the same correct Actor, and not all might be in range.\nif (!tokenTarget) {\n    ui.notifications.error(`${macroLabel}, Actor context ${actor} does not match ${tokenTarget} found.`);\n    return;\n}\n\nconst cleric = tokenSource.actor;\nconst clericLevel = cleric.items.filter(i => i.type === \"class\").find(c => c.name === \"Cleric\").system.levels;\n\nconst distance = Math.round(canvas.grid.measureDistance(tokenSource, tokenTarget, { gridSpaces: true }));\nconst distance3D = Math.round(Math.sqrt(distance * distance + (tokenSource.document.elevation - tokenTarget.document.elevation) * (tokenSource.document.elevation - tokenTarget.document.elevation)));\nconsole.log({ message: \"distance\", distance: distance, distance3D: distance3D });\n\nif ((useDistance3D ? distance3D : distance) > 30) {\n    ui.notifications.warn(\n        `Distance between ${cleric.name} and ${actor.name} is ${(useDistance3D ? distance3D : distance)}. Expected distance<=30.`,\n        { permanent: true }\n    );\n\n    return;\n}\n\n// create the Roll\nconst roll = await new Roll(`1d6+${clericLevel}`, actor.getRollData()).evaluate({ async: true })\n\n// create the ChatMessage\nawait roll.toMessage({ speaker: ChatMessage.getSpeaker({ actor: cleric.name }), flavor: `getting temporary hit points by ${macroLabel} from ${cleric.name}.` });\n\nconst currentTempHP = tokenTarget.actor.system.attributes.hp.temp !== null ? tokenTarget.actor.system.attributes.hp.temp : 0;\nconst newTempHP = Math.max(roll.total, currentTempHP);\nconsole.log({ message: \"newTempHP\", temp: newTempHP });\n\nawait actor.update({ \"system.attributes.hp.temp\": newTempHP });","ownership":{"default":0,"npmYF618vZgxA5SD":3},"flags":{"core":{"sourceId":"Macro.Wi8tj7jT2lkYEcBD"}},"_stats":{"systemId":"dnd5e","systemVersion":"2.0.3","coreVersion":"10.290","createdTime":1668184550598,"modifiedTime":1668184611234,"lastModifiedBy":"npmYF618vZgxA5SD"},"folder":null,"sort":0,"_id":"ctugKIda2tJRhtdm"}
{"name":"Stress -1","type":"script","scope":"global","author":"npmYF618vZgxA5SD","img":"icons/magic/death/undead-ghosts-trio-blue.webp","command":"// icon suggestion: icons/magic/death/undead-ghosts-trio-blue.webp\n\nconst icon = \"icons/magic/death/undead-ghosts-trio-blue.webp\";\nconst macroLabel = \"Stress Plus One\";\nconst label = \"Stress\";\nconst changeBy = -1;\n\nconst keys = [\n    \"system.bonuses.abilities.save\",\n    \"system.bonuses.abilities.check\",\n    \"system.bonuses.mwak.attack\",\n    \"system.bonuses.rwak.attack\",\n    \"system.bonuses.msak.attack\",\n    \"system.bonuses.rsak.attack\"\n];\n\nactor = canvas.tokens.hover?.actor;\n\nif (canvas.tokens.hover === null) {\n    ui.notifications.warn(`${macroLabel}, Actor hovered ${actor?.name} invalid target.`);\n    return;\n}\n\n// works, but maybe save the state, delete the old one, create new one, in order to get out of the box stuff from ActiveEffect and Effect-Macro.\n\nconst effect = actor.effects.find(e => foundry.utils.hasProperty(e, \"flags.world.stress\"));\nconst current = effect?.getFlag(\"world\", \"stress\") ?? 0;\nconst stress = Number(Math.max(current + changeBy, 0));\nconst changes = keys.map(key => {\n    return { key, mode: CONST.ACTIVE_EFFECT_MODES.ADD, value: `-${stress}` };\n});\nconst effectData = { changes, icon };\nfoundry.utils.setProperty(effectData, \"label\", `${label}: ${stress}`);\nfoundry.utils.setProperty(effectData, \"flags.world.stress\", stress);\nif (effect) {\n    await effect.delete();\n}\n\nif (stress > 0) {\n    await actor.createEmbeddedDocuments(\"ActiveEffect\", [effectData]);\n}","ownership":{"default":0,"npmYF618vZgxA5SD":3},"flags":{"core":{"sourceId":"Macro.cZ5utQzgiD2ToC8H"}},"_stats":{"systemId":"dnd5e","systemVersion":"2.0.3","coreVersion":"10.290","createdTime":1669142733878,"modifiedTime":1669150684242,"lastModifiedBy":"npmYF618vZgxA5SD"},"folder":null,"sort":0,"_id":"eALkW8fIV3lL0nQ3"}
{"name":"Cycle Wildcard Token -1","type":"script","scope":"global","author":"npmYF618vZgxA5SD","img":"icons/svg/dice-target.svg","command":"// https://github.com/krbz999/zhell-macros/blob/main/tools/token/cycle_token_wildcards.js\nconst currentImg = token.document.texture.src;\nconst actorId = token.actor.id;\nconst wildcardImages = await game.actors.get(actorId).getTokenImages();\nconst currentIndex = wildcardImages.indexOf(currentImg);\nconst next = (currentIndex -1)>=0?(currentIndex -1):wildcardImages.length-1;\n\nawait token.document.update({ \"texture.src\": wildcardImages[next] });","ownership":{"default":0,"npmYF618vZgxA5SD":3},"flags":{"core":{"sourceId":"Macro.hjsPei1SwSYahJ6m"}},"_stats":{"systemId":"dnd5e","systemVersion":"2.0.3","coreVersion":"10.290","createdTime":1668177770431,"modifiedTime":1669580087121,"lastModifiedBy":"npmYF618vZgxA5SD"},"folder":null,"sort":0,"_id":"fT8o95kMcQlQrS30"}
{"name":"Faerie Fire","type":"script","scope":"global","author":"npmYF618vZgxA5SD","img":"icons/magic/fire/projectile-meteor-salvo-strong-teal.webp","command":"/**\n * GM only Macro Bar version for Faerie Fire\n * \n * https://www.dndbeyond.com/spells/faerie-fire\n * https://github.com/itteerde/fvttconfig/issues/73\n * \n * requires: Token-Attacher, Token Magic FX.\n */\n\nconst macroLabel = \"Faerie Fire\";\nconst icon = \"icons/magic/fire/projectile-meteor-salvo-strong-teal.webp\";\nconst flags = { scope: \"world\", key: \"Faerie Fire\" };\n\ntoken = canvas.tokens.controlled[0];// TODO: once works change to all tokens selected (and test properly once more)\nactor = token.actor;// TODO: once works change to all tokens selected (and test properly once more)\n\n// if token's actor is affected by Faerie Fire already\nif (token.actor.effects.find(e => e.getFlag(flags.scope, flags.key))) {\n    TokenMagic.deleteFilters(token, macroLabel);\n    canvas.scene.deleteEmbeddedDocuments(\"AmbientLight\", canvas.scene.lights.filter(l => l.getFlag(flags.scope, \"origin\") === token.id && l.getFlag(flags.scope, flags.key)).map(l => l.id));\n    token.actor.deleteEmbeddedDocuments(\"ActiveEffect\", [token.actor.effects.find(e => e.getFlag(flags.scope, flags.key)).id]);\n    return;\n}\n\nconst effectData = { icon, label: macroLabel, duration: { seconds: 60 } };\nconst effectsCreated = await actor.createEmbeddedDocuments(\"ActiveEffect\", [effectData]);\n//console.log({ message: `${macroLabel}`, effectsCreated: effectsCreated });\n\nconst effect = effectsCreated[0];\nawait effect.setFlag(flags.scope, flags.key, true);\nconsole.log({ message: `${macroLabel}`, effect: effect });\n\nlet params =\n    [{\n        filterType: \"glow\",\n        filterId: macroLabel,\n        outerStrength: 4,\n        innerStrength: 0,\n        color: 0x003300,\n        quality: 0.5,\n        padding: 10,\n        animated:\n        {\n            color:\n            {\n                active: true,\n                loopDuration: 3000,\n                animType: \"colorOscillation\",\n                val1: 0x006600,\n                val2: 0x00FF00\n            }\n        }\n    }];\n\nawait TokenMagic.addUpdateFilters(token, params);\n\nconst lightData = {\n    config: {\n        alpha: 0.5,\n        angle: 360,\n        bright: 0,\n        color: \"#37b800\",\n        coloration: 1,\n        dim: 10,\n        attenuation: 0.5,\n        luminosity: 0.5,\n        saturation: 0,\n        contrast: 0,\n        shadows: 0,\n        animation: {\n            type: null,\n            speed: 5,\n            intensity: 5,\n            reverse: false\n        },\n        darkness: {\n            min: 0,\n            max: 1\n        }\n    },\n    x: token.center.x,\n    y: token.center.y\n};\n\nconst created = await canvas.scene.createEmbeddedDocuments(\"AmbientLight\", [lightData]);\nconst lightCreated = created[0];\nawait lightCreated.setFlag(flags.scope, \"origin\", token.id);\nawait lightCreated.setFlag(flags.scope, flags.key, true);\nawait tokenAttacher.attachElementsToToken([lightCreated], token);","ownership":{"default":0,"npmYF618vZgxA5SD":3},"flags":{"core":{"sourceId":"Macro.U7kqD0z6XNzmkn30"}},"_stats":{"systemId":"dnd5e","systemVersion":"2.0.3","coreVersion":"10.291","createdTime":1670853019618,"modifiedTime":1670855286834,"lastModifiedBy":"npmYF618vZgxA5SD"},"folder":null,"sort":0,"_id":"jhZrFnBTJTwkW1F8"}
{"name":"Delete unused Macros","type":"script","scope":"global","author":"npmYF618vZgxA5SD","img":"icons/svg/dice-target.svg","command":"const allMacroIds = new Set(game.macros.map(e => e.id));\nconst used = new Set();\nfor(let user of game.users){\n    Object.values(user.hotbar).forEach(id => used.add(id))\n}\nconst unused = allMacroIds.difference(used);\nawait Macro.deleteDocuments([...unused]);","ownership":{"default":0,"npmYF618vZgxA5SD":3},"flags":{"core":{"sourceId":"Macro.2AHt5iTiZmQH7dCl"}},"_stats":{"systemId":"dnd5e","systemVersion":"2.0.3","coreVersion":"10.291","createdTime":1670301010947,"modifiedTime":1671814756140,"lastModifiedBy":"npmYF618vZgxA5SD"},"folder":null,"sort":0,"_id":"lE5HXupuSPaCd71f"}
{"name":"Torch (This Token)","type":"script","scope":"global","author":"npmYF618vZgxA5SD","img":"icons/sundries/lights/torch-brown-lit.webp","command":"// icon suggestion: icons/sundries/lights/torch-brown-lit.webp\nconst dim_range = 20;\nconst bright_range = 10;\nif (token.data.light.dim === 0) {\n    await token.document.update({\n        light: {\n            alpha: 0.2,\n            angle: 0,\n            bright: bright_range,\n            coloration: 1,\n            dim: dim_range,\n            gradual: true,\n            luminosity: 0.5,\n            saturation: 0,\n            contrast: 0.25,\n            shadows: 0,\n            animation: {\n                speed: 1,\n                intensity: 2,\n                reverse: false,\n                type: \"torch\",\n            },\n            darkness: {\n                min: 0,\n                max: 1,\n            },\n            color: \"#f3e09b\",\n        },\n    });\n} else {\n    await token.document.update({\n        light: {\n            alpha: 0.5,\n            angle: 0,\n            bright: 0,\n            color: \"#000000\",\n            coloration: 1,\n            dim: 0,\n            gradual: true,\n            luminosity: 0.5,\n            saturation: 0,\n            contrast: 0,\n            shadows: 0,\n            animation: {\n                speed: 5,\n                intensity: 5,\n                reverse: false,\n            },\n            darkness: {\n                min: 0,\n                max: 1,\n            },\n        },\n    });\n}","ownership":{"default":0,"npmYF618vZgxA5SD":3},"flags":{"core":{"sourceId":"Macro.ZcpMEBvmrtf4fC4y"}},"_stats":{"systemId":"dnd5e","systemVersion":"2.0.3","coreVersion":"10.290","createdTime":1668692035955,"modifiedTime":1669742053548,"lastModifiedBy":"npmYF618vZgxA5SD"},"folder":null,"sort":0,"_id":"oDuG1LjVmcvgqXKJ"}
{"name":"+5hp","type":"script","scope":"global","author":"npmYF618vZgxA5SD","img":"modules/Tablerules/icons/magic/healing/g5.webp","command":"const damage = -5;\n\nactor = canvas.tokens.hover?.actor;\n\nif (canvas.tokens.hover === null) {\n    ui.notifications.warn(`${macroLabel}, Actor hovered ${actor?.name} invalid target.`);\n    return;\n}\n\nactor.applyDamage(damage);","ownership":{"default":0,"npmYF618vZgxA5SD":3},"flags":{"core":{"sourceId":"Macro.S1C7ytpywSYgMhrL"}},"_stats":{"systemId":"dnd5e","systemVersion":"2.0.3","coreVersion":"10.291","createdTime":1668446963152,"modifiedTime":1672396490096,"lastModifiedBy":"npmYF618vZgxA5SD"},"folder":null,"sort":0,"_id":"pKC745ine0rG2V8y"}
{"name":"dim Down","type":"script","scope":"global","author":"YCF2Heb7DMHDaF2f","img":"modules/Tablerules/icons/gui/ScaleDown.png","command":"await token.document.update({height:token.document.height/2,width:token.document.width/2})","ownership":{"default":0,"ygKdWY9DRiutAWqh":3,"YCF2Heb7DMHDaF2f":3},"flags":{"core":{"sourceId":"Macro.cgQ0fnQs3J3j87rM"}},"_stats":{"systemId":"dnd5e","systemVersion":"2.1.5","coreVersion":"10.291","createdTime":1677796607109,"modifiedTime":1678644545478,"lastModifiedBy":"YCF2Heb7DMHDaF2f"},"folder":null,"sort":0,"_id":"q6KNYV5vXw8E8Ww4"}
{"name":"-1hp","type":"script","scope":"global","author":"npmYF618vZgxA5SD","img":"modules/Tablerules/icons/magic/healing/r1.webp","command":"const damage = 1;\n\nactor = canvas.tokens.hover?.actor;\n\nif (canvas.tokens.hover === null) {\n    ui.notifications.warn(`${macroLabel}, Actor hovered ${actor?.name} invalid target.`);\n    return;\n}\n\nactor.applyDamage(damage);","ownership":{"default":0,"npmYF618vZgxA5SD":3},"flags":{"core":{"sourceId":"Macro.ikCJ4nwpX2AlMh4k"}},"_stats":{"systemId":"dnd5e","systemVersion":"2.0.3","coreVersion":"10.290","createdTime":1668446891617,"modifiedTime":1668454527621,"lastModifiedBy":"npmYF618vZgxA5SD"},"folder":null,"sort":0,"_id":"rM5BrXDFAwx7v3vn"}
{"name":"+1hp","type":"script","scope":"global","author":"npmYF618vZgxA5SD","img":"modules/Tablerules/icons/magic/healing/g1.webp","command":"const damage = -1;\n\nactor = canvas.tokens.hover?.actor;\n\nif (canvas.tokens.hover === null) {\n    ui.notifications.warn(`${macroLabel}, Actor hovered ${actor?.name} invalid target.`);\n    return;\n}\n\nactor.applyDamage(damage);","ownership":{"default":0,"npmYF618vZgxA5SD":3},"flags":{"core":{"sourceId":"Macro.3jdQqgSiRuUiTv8H"}},"_stats":{"systemId":"dnd5e","systemVersion":"2.0.3","coreVersion":"10.290","createdTime":1668446925879,"modifiedTime":1668454529389,"lastModifiedBy":"npmYF618vZgxA5SD"},"folder":null,"sort":0,"_id":"tLMcmnae7qXte1Hi"}
{"name":"-5hp","type":"script","scope":"global","author":"npmYF618vZgxA5SD","img":"modules/Tablerules/icons/magic/healing/r5.webp","command":"const damage = 5;\n\nactor = canvas.tokens.hover?.actor;\n\nif (canvas.tokens.hover === null) {\n    ui.notifications.warn(`${macroLabel}, Actor hovered ${actor?.name} invalid target.`);\n    return;\n}\n\nactor.applyDamage(damage);","ownership":{"default":0,"npmYF618vZgxA5SD":3},"flags":{"core":{"sourceId":"Macro.7Zq6jeF6XTfU4P6s"}},"_stats":{"systemId":"dnd5e","systemVersion":"2.0.3","coreVersion":"10.291","createdTime":1668446799383,"modifiedTime":1672396487847,"lastModifiedBy":"npmYF618vZgxA5SD"},"folder":null,"sort":0,"_id":"tz7GDiIAC0MWkDl8"}
{"name":"Guidance (One D&D)","type":"script","scope":"global","author":"npmYF618vZgxA5SD","img":"icons/magic/control/buff-flight-wings-blue.webp","command":"// icon suggestion: icons/magic/control/buff-flight-wings-blue.webp\nconst icon = \"icons/magic/control/buff-flight-wings-blue.webp\";\nconst label = \"Guidance\";\nconst macroLabel = \"Guidance One D&D\";\n\nif (canvas.tokens.controlled.length !== 1) {\n    ui.notifications.warn(`${macroLabel}, ${canvas.tokens.controlled.length} Actors selected. Select 1 and only 1.`, { permanent: true });\n    return;\n}\n\nif (actor.type !== \"character\") {\n    ui.notifications.warn(`${macroLabel}, Actor selected is type:${actor.type}. Select a character.`);\n    return;\n}\n\nconst effect = actor.effects.find(e => e.getFlag(\"world\", \"guidance\"));\nconst current = effect?.getFlag(\"world\", \"guidance.timesSinceLongRest\") ?? 0;\n\nconst max = CONFIG.Tablerules?.guidance?.maxTimesPerLongRest ?? 1;\n\nif (current >= max) {\n    ui.notifications.warn(`${macroLabel}, maximum numbers per Long Rest: ${max}, current: ${current}. ${actor.name} at cooldown.`);\n    ChatMessage.create({ content: `${macroLabel}, maximum numbers per Long Rest: ${max}, current: ${current}. ${actor.name} cooldown.`, flavor: macroLabel });\n    return;\n}\n\nconst effectData = { icon, label };\nfoundry.utils.setProperty(effectData, \"flags.world.guidance.timesSinceLongRest\", current + 1);\nfoundry.utils.setProperty(effectData, \"flags.dae.specialDuration\", [\"longRest\"]);\n\nif (effect) return effect.update(effectData);\nawait actor.createEmbeddedDocuments(\"ActiveEffect\", [effectData]);\n\nnew Roll(\"1d4\", actor.getRollData()).toMessage({ speaker: ChatMessage.getSpeaker({ actor: actor.name }), flavor: macroLabel });","ownership":{"default":0,"npmYF618vZgxA5SD":3},"flags":{"core":{"sourceId":"Macro.mLrFgRshpnS1zcpd"}},"_stats":{"systemId":"dnd5e","systemVersion":"2.0.3","coreVersion":"10.290","createdTime":1667591528551,"modifiedTime":1669055637170,"lastModifiedBy":"npmYF618vZgxA5SD"},"folder":null,"sort":0,"_id":"xYkcltGffRr4oSty"}
{"name":"Regeneration Suppress","type":"script","scope":"global","author":"npmYF618vZgxA5SD","img":"icons/magic/life/heart-broken-red.webp","command":"/**\n * Control Bar Macro for suppressing regeneraion.\n * \n * https://github.com/itteerde/fvttconfig/issues/74\n */\n\nconst macroLabel = \"Regeneration Suppress\";\nconst flagKey = \"flags.world.regenerationSuppress\";\nconst icon = \"icons/magic/life/heart-broken-red.webp\";\n\nconst tokensToBeModified = canvas.tokens.controlled;\nconst actors = canvas.tokens.controlled.map(t => t.actor);\n\nfor (let i = 0; i < actors.length; i++) {\n\n    const actor = actors[i];\n\n    const effect = actor.effects.find(e => foundry.utils.hasProperty(e, flagKey));\n\n    if (effect) {\n        ui.notifications.warn(`${macroLabel}, found effect on Actor: ${actor.name}. Only one instance per Actor allowed.`, { permanent: false });\n    }\n\n    const effectData = { icon, label: macroLabel, duration: { seconds: 6 } };\n    foundry.utils.setProperty(effectData, flagKey, true);\n    if (effect) {\n        await effect.update(effectData);\n    } else {\n        await actor.createEmbeddedDocuments(\"ActiveEffect\", [effectData]);\n    }\n}","ownership":{"default":0,"npmYF618vZgxA5SD":3},"flags":{"core":{"sourceId":"Macro.nChjMEh92A73wwQq"}},"_stats":{"systemId":"dnd5e","systemVersion":"2.0.3","coreVersion":"10.291","createdTime":1670537999877,"modifiedTime":1670624058995,"lastModifiedBy":"npmYF618vZgxA5SD"},"folder":null,"sort":0,"_id":"yOXzq6xrLybPmxpH"}
{"name":"Stress +1","type":"script","scope":"global","author":"npmYF618vZgxA5SD","img":"icons/magic/death/undead-ghosts-trio-blue.webp","command":"// icon suggestion: icons/magic/death/undead-ghosts-trio-blue.webp\n\nconst icon = \"icons/magic/death/undead-ghosts-trio-blue.webp\";\nconst macroLabel = \"Stress Plus One\";\nconst label = \"Stress\";\nconst changeBy = 1;\n\nconst keys = [\n    \"system.bonuses.abilities.save\",\n    \"system.bonuses.abilities.check\",\n    \"system.bonuses.mwak.attack\",\n    \"system.bonuses.rwak.attack\",\n    \"system.bonuses.msak.attack\",\n    \"system.bonuses.rsak.attack\"\n];\n\nactor = canvas.tokens.hover?.actor;\n\nif (canvas.tokens.hover === null) {\n    ui.notifications.warn(`${macroLabel}, Actor hovered ${actor?.name} invalid target.`);\n    return;\n}\n\n// works, but maybe save the state, delete the old one, create new one, in order to get out of the box stuff from ActiveEffect and Effect-Macro.\n\nconst effect = actor.effects.find(e => foundry.utils.hasProperty(e, \"flags.world.stress\"));\nconst current = effect?.getFlag(\"world\", \"stress\") ?? 0;\nconst stress = Number(Math.max(current + changeBy, 0));\nconst changes = keys.map(key => {\n    return { key, mode: CONST.ACTIVE_EFFECT_MODES.ADD, value: `-${stress}` };\n});\nconst effectData = { changes, icon };\nfoundry.utils.setProperty(effectData, \"label\", `${label}: ${stress}`);\nfoundry.utils.setProperty(effectData, \"flags.world.stress\", stress);\nif (effect) {\n    await effect.delete();\n}\n\nif (stress > 0) {\n    await actor.createEmbeddedDocuments(\"ActiveEffect\", [effectData]);\n}","ownership":{"default":0,"npmYF618vZgxA5SD":3},"flags":{"core":{"sourceId":"Macro.h9VFjFVm6w7kxY90"}},"_stats":{"systemId":"dnd5e","systemVersion":"2.0.3","coreVersion":"10.290","createdTime":1667650864581,"modifiedTime":1669150690649,"lastModifiedBy":"npmYF618vZgxA5SD"},"folder":null,"sort":0,"_id":"yRjCSiufpDFftlIK"}
{"$$deleted":true,"_id":"O7AUr3MNLZMIFe4Y"}
{"name":"Update Initiative","type":"script","scope":"global","author":"YCF2Heb7DMHDaF2f","img":"icons/magic/time/clock-stopwatch-white-blue.webp","command":"/**\n * Control Bar Macro for putting all summoned Actors' initiative to their summoners in order to enable letting them have their Turn after the Actor who summoned them.\n */\n\nconst combats = game.combats;\n\nif (combats.size === 0) {\n    ui.notifications.warn(\"No active combats found.\");\n    return;\n}\n\nasync function doCombatant(combatant, combat) {\n    const token = game.scenes.get(combatant.sceneId).tokens.get(combatant.tokenId); // is a TokenDocument5e both for pc and npc\n    if (token.actorData?.flags?.world?.summoned === undefined) {\n        if (combatant.initiative === Math.floor(combatant.initiative)) {\n            await combatant.update({ initiative: combatant.initiative + token.actor.system.abilities.dex.value / 100 + Math.random() / 100000 });\n        }\n        return;\n    }\n\n    const summonerId = token.actorData.flags.world.summoned.actor.substring(6);\n    const summonerCombatant = combat.turns.find(c => c.actorId === summonerId);\n\n    if (summonerCombatant === undefined) {\n        return;\n    }\n\n    await combatant.update({ initiative: summonerCombatant.initiative - 0.0000001 });\n}\n\nfunction adjustCombat(combat) {\n    for (const c of combat.turns) {\n        doCombatant(c, combat);\n    }\n}\n\ncombats.forEach(adjustCombat);","ownership":{"default":0,"YCF2Heb7DMHDaF2f":3},"flags":{"core":{"sourceId":"Macro.iJBq47kINY76PaJj"}},"_stats":{"systemId":"dnd5e","systemVersion":"2.1.5","coreVersion":"10.291","createdTime":1678670079448,"modifiedTime":1680088831623,"lastModifiedBy":"YCF2Heb7DMHDaF2f"},"folder":null,"sort":0,"_id":"Pxl8tebY5hq0Gar3"}
