{"type":"spell","system":{"description":{"value":"<p>You call forth a celestial spirit. It manifests in an angelic form in an unoccupied space that you can see within range. This corporeal form uses the Celestial Spirit stat block. When you cast the spell, choose Avenger or Defender. Your choice determines the creature’s attack in its stat block. The creature disappears when it drops to 0 hit points or when the spell ends.</p>\n<p>The creature is an ally to you and your companions. In combat, the creature shares your initiative count, but it takes its turn immediately after yours. It obeys your verbal commands (no action required by you). If you don’t issue any, it takes the Dodge action and uses its move to avoid danger.</p>\n<p><em><strong>At Higher Levels.</strong></em> When you cast this spell using a spell slot of 6th level or higher, use the higher level wherever the spell’s level appears in the stat block.</p>\n<div class=\"Basic-Text-Frame stat-block-finder\">\n<p class=\"Stat-Block-Styles_Stat-Block-Title\">Celestial Spirit</p>\n<p class=\"Stat-Block-Styles_Stat-Block-Metadata\">Large celestial</p>\n<p class=\"Stat-Block-Styles_Stat-Block-Data\"><strong>Armor Class</strong> 11 + the level of the spell (natural armor) + 2 (Defender only)</p>\n<p class=\"Stat-Block-Styles_Stat-Block-Data\"><strong>Hit Points</strong> 40 + 10 for each spell level above 5th</p>\n<p class=\"Stat-Block-Styles_Stat-Block-Data\"><strong>Speed</strong> 30 ft., fly 40 ft.</p>\n<div class=\"stat-block-ability-scores\">\n<div class=\"stat-block-ability-scores-stat\">\n<div class=\"stat-block-ability-scores-heading\">STR</div>\n<div class=\"stat-block-ability-scores-data\"><span class=\"stat-block-ability-scores-score\">16</span> <span class=\"stat-block-ability-scores-modifier\">(+3)</span></div>\n</div>\n<div class=\"stat-block-ability-scores-stat\">\n<div class=\"stat-block-ability-scores-heading\">DEX</div>\n<div class=\"stat-block-ability-scores-data\"><span class=\"stat-block-ability-scores-score\">14</span> <span class=\"stat-block-ability-scores-modifier\">(+2)</span></div>\n</div>\n<div class=\"stat-block-ability-scores-stat\">\n<div class=\"stat-block-ability-scores-heading\">CON</div>\n<div class=\"stat-block-ability-scores-data\"><span class=\"stat-block-ability-scores-score\">16</span> <span class=\"stat-block-ability-scores-modifier\">(+3)</span></div>\n</div>\n<div class=\"stat-block-ability-scores-stat\">\n<div class=\"stat-block-ability-scores-heading\">INT</div>\n<div class=\"stat-block-ability-scores-data\"><span class=\"stat-block-ability-scores-score\">10</span> <span class=\"stat-block-ability-scores-modifier\">(+0)</span></div>\n</div>\n<div class=\"stat-block-ability-scores-stat\">\n<div class=\"stat-block-ability-scores-heading\">WIS</div>\n<div class=\"stat-block-ability-scores-data\"><span class=\"stat-block-ability-scores-score\">14</span> <span class=\"stat-block-ability-scores-modifier\">(+2)</span></div>\n</div>\n<div class=\"stat-block-ability-scores-stat\">\n<div class=\"stat-block-ability-scores-heading\">CHA</div>\n<div class=\"stat-block-ability-scores-data\"><span class=\"stat-block-ability-scores-score\">16</span> <span class=\"stat-block-ability-scores-modifier\">(+3)</span></div>\n</div>\n</div>\n<p class=\"Stat-Block-Styles_Stat-Block-Data\"><strong>Damage Resistances</strong> radiant</p>\n<p class=\"Stat-Block-Styles_Stat-Block-Data\"><strong>Condition Immunities</strong> charmed, frightened</p>\n<p class=\"Stat-Block-Styles_Stat-Block-Data\"><strong>Senses</strong> @Compendium[dnd5e.rules.eVtpEGXjA2tamEIJ]{darkvision} 60 ft., passive @Compendium[dnd5e.rules.0AGfrwZRzSG0vNKb]{Perception} 12</p>\n<p class=\"Stat-Block-Styles_Stat-Block-Data\"><strong>Languages</strong> Celestial, understands the languages you speak</p>\n<p class=\"Stat-Block-Styles_Stat-Block-Data-Last\"><strong>Challenge</strong> — <strong>Proficiency Bonus</strong> equals your bonus</p>\n<p class=\"Stat-Block-Styles_Stat-Block-Heading\">Actions</p>\n<p class=\"Stat-Block-Styles_Stat-Block-Body\"><em><strong>Multiattack.</strong></em> The celestial makes a number of attacks equal to half this spell’s level (rounded down).</p>\n<p class=\"Stat-Block-Styles_Stat-Block-Body\"><em><strong>Radiant Bow (Avenger Only).</strong> Ranged Weapon Attack:</em> your spell attack modifier to hit, range 150/600 ft., one target. <em>Hit:</em> 2d6 + 2 + the spell’s level radiant damage.</p>\n<p class=\"Stat-Block-Styles_Stat-Block-Body\"><em><strong>Radiant Mace (Defender Only).</strong> Melee Weapon Attack:</em> your spell attack modifier to hit, reach 5 ft., one target. <em>Hit:</em> 1d10 + 3 + the spell’s level radiant damage, and the celestial can choose itself or another creature it can see within 10 feet of the target. The chosen creature gains 1d10 temporary hit points.</p>\n<p class=\"Stat-Block-Styles_Stat-Block-Body\"><em><strong>Healing Touch (1/Day).</strong></em> The celestial touches another creature. The target magically regains hit points equal to 2d8 + the spell’s level.</p>\n</div>","chat":"","unidentified":""},"source":"Tasha’s Cauldron of Everything pg 110","activation":{"type":"action","cost":1,"condition":""},"duration":{"value":"1","units":"hour"},"cover":null,"target":{"value":null,"width":null,"units":"","type":""},"range":{"value":90,"long":null,"units":"ft"},"uses":{"value":null,"max":"","per":"","recovery":""},"consume":{"type":"","target":"","amount":null},"ability":"","actionType":"other","attackBonus":"","chatFlavor":"","critical":{"threshold":null,"damage":""},"damage":{"parts":[],"versatile":""},"formula":"","save":{"ability":"","dc":null,"scaling":"spell"},"level":5,"school":"con","components":{"vocal":true,"somatic":true,"material":true,"ritual":false,"concentration":true},"materials":{"value":"a golden reliquary worth at least 500 gp","consumed":false,"cost":500,"supply":0},"preparation":{"mode":"prepared","prepared":true},"scaling":{"mode":"none","formula":""}},"name":"Summon Celestial","flags":{"ddbimporter":{"id":5854911,"definitionId":721194,"entityTypeId":435869154,"dndbeyond":{"lookup":"classSpell","class":"Cleric","level":14,"characterClassId":127710854,"spellLevel":5,"ability":"wis","mod":3,"dc":16,"cantripBoost":false,"overrideDC":false,"id":5854911,"entityTypeId":435869154,"healingBoost":0,"usesSpellSlot":true},"originalName":"Summon Celestial","sources":[{"sourceId":67,"pageNumber":110,"sourceType":1}],"tags":["Summoning"],"version":"3.3.16","importId":"ApvPDBlD6sXmt6Na"},"midiProperties":{"magicdam":true,"magiceffect":true},"spell-class-filter-for-5e":{"parentClass":"cleric"},"itemacro":{"macro":{"name":"Summon Celestial","type":"script","scope":"global","command":"/**\n * Item-Macro Macro.\n * \n * https://www.dndbeyond.com/spells/summon-celestial\n */\n\nconst macroLabel = item.name;\nconst textureAvenger = \"modules/Tablerules/icons/magic/summons/celestialSpiritAvenger.webp\";\nconst textureDefender = \"modules/Tablerules/icons/magic/summons/celestialSpiritDefender.webp\";\n\nconst formAvenger = \"Avenger\";\nconst formDefender = \"Defender\";\n\nconst scaleAvenger = 1;\nconst scaleDefender = 1;\n\nconst level = await warpgate.dnd5e.rollItem(item);\nconst summonerDc = actor.system.attributes.spelldc;\nconst summonerAttack = summonerDc - 8;\n\nif (!level > 0) {\n    ui.notifications.error(`${macroLabel}, !level>0, check console error.`);\n    console.error({ message: `${macroLabel}, !level>0`, arguments: arguments });\n    return;\n}\n\n/* Prompt the user for which type of spirit to summon */\nconst buttonData = {\n    buttons: [{\n        label: formAvenger,\n        value: {\n            token: { name: formAvenger },\n            actor: { name: formAvenger },\n            embedded: {\n                Item: {\n                    \"Radiant Mace\": warpgate.CONST.DELETE\n                }\n            }\n        }\n    }, {\n        label: formDefender,\n        value: {\n            actor: { name: formDefender },\n            token: { name: formDefender },\n            embedded: {\n                Item: {\n                    \"Radiant Bow\": warpgate.CONST.DELETE\n                }\n            }\n        }\n    }\n    ], title: \"Which version?\"\n};\n\nlet spirit = await warpgate.buttonDialog(buttonData);\n\n/* Craft the updates that are common to all spirits */\nlet updates = {\n    token: {\n        \"displayName\": CONST.TOKEN_DISPLAY_MODES.HOVER,\n        \"flags.Tablerules.spellLevel\": level\n    },\n    actor: {\n        'system.attributes.ac.flat': 11 + level,\n        'system.attributes.hp': { value: 40 + 10 * (level - 5), max: 40 + 10 * (level - 5) },\n        \"system.details.cr\": actor.system.attributes.prof,\n        \"system.attributes.prof\": actor.system.attributes.prof,\n        \"flags.world.summoned.item\": item.uuid,\n        \"flags.world.summoned.actor\": actor.uuid\n    },\n    embedded: {\n        Item: {\n            \"Multiattack\": { name: `Multiattack (${Math.floor(level / 2)} attacks)` },\n            \"Radiant Bow\": {\n                'system.damage.parts': [[`2d6 + 2 + ${level}`, \"radiant\"]],\n                'system.attackBonus': `- @mod - @prof + ${summonerAttack}`\n            },\n            \"Radiant Mace\": {\n                'system.damage.parts': [[`1d10 + 3 + ${level}`, \"radiant\"]],\n                'system.attackBonus': `- @mod - @prof + ${summonerAttack}`\n            },\n            \"Healing Touch\": {\n                \"system.damage.parts\": [[`2d8+ ${level}`, \"healing\"]]\n            }\n        }\n    }\n}\n\n/* update variants */\nif (spirit.actor.name === formAvenger) {\n    updates[\"actor.img\"] = textureAvenger;\n    updates[\"token.texture.src\"] = textureAvenger;\n    updates[\"token.texture.scaleX\"] = scaleAvenger;\n    updates[\"token.texture.scaleY\"] = scaleAvenger;\n}\n\nif (spirit.actor.name === formDefender) {\n    updates[\"actor.img\"] = textureDefender;\n    updates[\"token.texture.src\"] = textureDefender;\n    updates[\"token.texture.scaleX\"] = scaleDefender;\n    updates[\"token.texture.scaleY\"] = scaleDefender;\n}\n\n/* Combine the general and specific updates */\nupdates = mergeObject(updates, spirit);\n\nconst spawnIds = await warpgate.spawn(\"Celestial Spirit\", updates);","author":"YCF2Heb7DMHDaF2f","_id":null,"img":"icons/svg/dice-target.svg","folder":null,"sort":0,"ownership":{"default":0},"flags":{},"_stats":{"systemId":null,"systemVersion":null,"coreVersion":null,"createdTime":null,"modifiedTime":null,"lastModifiedBy":null}}},"core":{"sourceId":"Actor.25uya6OX8BbpJcRj.Item.e0ou4cVTF6lj6lsu"}},"img":"icons/commodities/treasure/trinket-wing-white.webp","effects":[],"ownership":{"default":0,"YCF2Heb7DMHDaF2f":3},"_stats":{"systemId":"dnd5e","systemVersion":"2.1.5","coreVersion":"10.291","createdTime":1678310374444,"modifiedTime":1678716559023,"lastModifiedBy":"YCF2Heb7DMHDaF2f"},"folder":null,"sort":0,"_id":"21TLnPTgOxOfaMSq"}
{"type":"spell","system":{"description":{"value":"<p>You call forth an aberrant spirit. It manifests in an unoccupied space that you can see within range. This corporeal form uses the Aberrant Spirit stat block. When you cast the spell, choose Beholderkin, Slaad, or Star Spawn. The creature resembles an aberration of that kind, which determines certain traits in its stat block. The creature disappears when it drops to 0 hit points or when the spell ends.</p>\n<p>The creature is an ally to you and your companions. In combat, the creature shares your initiative count, but it takes its turn immediately after yours. It obeys your verbal commands (no action required by you). If you don’t issue any, it takes the Dodge action and uses its move to avoid danger.</p>\n<p><em><strong>At Higher Levels.</strong></em> When you cast this spell using a spell slot of 5th level or higher, use the higher level wherever the spell’s level appears in the stat block.</p>\n<div class=\"Basic-Text-Frame stat-block-finder\">\n<p class=\"Stat-Block-Styles_Stat-Block-Title\">Aberrant Spirit</p>\n<p class=\"Stat-Block-Styles_Stat-Block-Metadata\">Medium aberration</p>\n<p class=\"Stat-Block-Styles_Stat-Block-Data\"><strong>Armor Class</strong> 11 + the level of the spell (natural armor)</p>\n<p class=\"Stat-Block-Styles_Stat-Block-Data\"><strong>Hit Points</strong> 40 + 10 for each spell level above 4th</p>\n<p class=\"Stat-Block-Styles_Stat-Block-Data\"><strong>Speed</strong> 30 ft.; fly 30 ft. (hover) (Beholderkin only)</p>\n<div class=\"stat-block-ability-scores\">\n<div class=\"stat-block-ability-scores-stat\">\n<div class=\"stat-block-ability-scores-heading\">STR</div>\n<div class=\"stat-block-ability-scores-data\"><span class=\"stat-block-ability-scores-score\">16</span><span class=\"stat-block-ability-scores-modifier\">(+3)</span></div>\n</div>\n<div class=\"stat-block-ability-scores-stat\">\n<div class=\"stat-block-ability-scores-heading\">DEX</div>\n<div class=\"stat-block-ability-scores-data\"><span class=\"stat-block-ability-scores-score\">10</span><span class=\"stat-block-ability-scores-modifier\">(+0)</span></div>\n</div>\n<div class=\"stat-block-ability-scores-stat\">\n<div class=\"stat-block-ability-scores-heading\">CON</div>\n<div class=\"stat-block-ability-scores-data\"><span class=\"stat-block-ability-scores-score\">15</span><span class=\"stat-block-ability-scores-modifier\">(+2)</span></div>\n</div>\n<div class=\"stat-block-ability-scores-stat\">\n<div class=\"stat-block-ability-scores-heading\">INT</div>\n<div class=\"stat-block-ability-scores-data\"><span class=\"stat-block-ability-scores-score\">16</span><span class=\"stat-block-ability-scores-modifier\">(+3)</span></div>\n</div>\n<div class=\"stat-block-ability-scores-stat\">\n<div class=\"stat-block-ability-scores-heading\">WIS</div>\n<div class=\"stat-block-ability-scores-data\"><span class=\"stat-block-ability-scores-score\">10</span><span class=\"stat-block-ability-scores-modifier\">(+0)</span></div>\n</div>\n<div class=\"stat-block-ability-scores-stat\">\n<div class=\"stat-block-ability-scores-heading\">CHA</div>\n<div class=\"stat-block-ability-scores-data\"><span class=\"stat-block-ability-scores-score\">6</span><span class=\"stat-block-ability-scores-modifier\">(-2)</span></div>\n</div>\n</div>\n<p class=\"Stat-Block-Styles_Stat-Block-Data\"><strong>Damage Immunities</strong> psychic</p>\n<p class=\"Stat-Block-Styles_Stat-Block-Data\"><strong>Senses</strong> @Compendium[dnd5e.rules.eVtpEGXjA2tamEIJ]{darkvision} 60 ft., passive @Compendium[dnd5e.rules.0AGfrwZRzSG0vNKb]{Perception} 10</p>\n<p class=\"Stat-Block-Styles_Stat-Block-Data\"><strong>Languages</strong> Deep Speech, understands the languages you speak</p>\n<p class=\"Stat-Block-Styles_Stat-Block-Data-Last\"><strong>Challenge</strong> — <strong>Proficiency Bonus</strong> equals your bonus</p>\n<p><em><strong>Regeneration (Slaad Only).</strong></em> The aberration regains 5 hit points at the start of its turn if it has at least 1 hit point.</p>\n<p><em><strong>Whispering Aura (Star Spawn Only).</strong></em> At the start of each of the aberration’s turns, each creature within 5 feet of the aberration must succeed on a Wisdom saving throw against your spell save DC or take 2d6 psychic damage, provided that the aberration isn’t @Compendium[dnd5e.rules.w7eitkpD7QQTB6j0]{incapacitated}.</p>\n<p class=\"Stat-Block-Styles_Stat-Block-Heading\">Actions</p>\n<p><em><strong>Multiattack.</strong></em> The aberration makes a number of attacks equal to half this spell’s level (rounded down).</p>\n<p><em><strong>Claws (Slaad Only).</strong> Melee Weapon Attack:</em> your spell attack modifier to hit, reach 5 ft., one target. <em>Hit:</em> 1d10 + 3 + the spell’s level slashing damage. If the target is a creature, it can’t regain hit points until the start of the aberration’s next turn.</p>\n<p><em><strong>Eye Ray (Beholderkin Only).</strong> Ranged Spell Attack:</em> your spell attack modifier to hit, range 150 ft., one creature. <em>Hit:</em> 1d8 + 3 + the spell’s level psychic damage.</p>\n<p><em><strong>Psychic Slam (Star Spawn Only).</strong> Melee Spell Attack:</em> your spell attack modifier to hit, reach 5 ft., one creature. <em>Hit:</em> 1d8 + 3 + the spell’s level psychic damage.</p>\n</div>","chat":"","unidentified":""},"source":"Tasha’s Cauldron of Everything pg 109","activation":{"type":"action","cost":1,"condition":""},"duration":{"value":"1","units":"hour"},"cover":null,"target":{"value":null,"width":null,"units":"","type":""},"range":{"value":90,"long":null,"units":"ft"},"uses":{"value":null,"max":"","per":"","recovery":""},"consume":{"type":"","target":"","amount":null},"ability":"","actionType":"other","attackBonus":"","chatFlavor":"","critical":{"threshold":null,"damage":""},"damage":{"parts":[],"versatile":""},"formula":"","save":{"ability":"","dc":null,"scaling":"spell"},"level":4,"school":"con","components":{"vocal":true,"somatic":true,"material":true,"ritual":false,"concentration":true},"materials":{"value":"a pickled tentacle and an eyeball in a platinum-inlaid vial worth at least 400 gp","consumed":false,"cost":400,"supply":0},"preparation":{"mode":"prepared","prepared":true},"scaling":{"mode":"none","formula":""}},"name":"Summon Aberration","flags":{"ddbimporter":{"id":5833900,"definitionId":718613,"entityTypeId":435869154,"dndbeyond":{"lookup":"classSpell","class":"Warlock","level":9,"characterClassId":125262878,"spellLevel":4,"ability":"cha","mod":4,"dc":16,"cantripBoost":false,"overrideDC":false,"id":5833900,"entityTypeId":435869154,"healingBoost":0,"usesSpellSlot":true},"originalName":"Summon Aberration","sources":[{"sourceId":67,"pageNumber":109,"sourceType":1}],"tags":["Summoning"],"version":"3.3.16","importId":"NTMT3Mxhe9PjhQJK"},"midiProperties":{"magicdam":true,"magiceffect":true},"spell-class-filter-for-5e":{"parentClass":"warlock"},"itemacro":{"macro":{"name":"Summon Aberration","type":"script","scope":"global","command":"/**\n * Item-Macro Macro.\n * \n * https://www.dndbeyond.com/spells/summon-aberration\n */\n\nconst macroLabel = item.name;\nconst textureBeholderkin = \"modules/Tablerules/icons/magic/summons/aberrationSpiritBeholderkin.png\";\nconst textureSlaad = \"modules/Tablerules/icons/magic/summons/aberrationSpiritSlaad.png\";\nconst textureStarSpawn = \"modules/Tablerules/icons/magic/summons/aberrationSpiritStarSpawn.png\";\n\nconst formBeholderkin = \"Beholderkin\";\nconst formSlaad = \"Slaad\";\nconst formStarSpawn = \"Star Spawn\";\n\nconst scaleBeholderkin = 1;\nconst scaleSlaad = 1;\nconst scaleStarSpawn = 1;\n\nconst level = await warpgate.dnd5e.rollItem(item);\nconst summonerDc = actor.system.attributes.spelldc;\nconst summonerAttack = summonerDc - 8;\n\nif (!level > 0) {\n    ui.notifications.error(`${macroLabel}, !level>0, check console error.`);\n    console.error({ message: `${macroLabel}, !level>0`, arguments: arguments });\n    return;\n}\n\n/* Prompt the user for which type of spirit to summon */\nconst buttonData = {\n    buttons: [{\n        label: formBeholderkin,\n        value: {\n            token: { name: formBeholderkin },\n            actor: { name: formBeholderkin },\n            embedded: {\n                Item: {\n                    \"Claws\": warpgate.CONST.DELETE,\n                    \"Psychic Slam\": warpgate.CONST.DELETE,\n                    \"Regeneration\": warpgate.CONST.DELETE,\n                    \"Whispering Aura\": warpgate.CONST.DELETE\n                }\n            }\n        }\n    }, {\n        label: formSlaad,\n        value: {\n            actor: { name: formSlaad },\n            token: { name: formSlaad },\n            embedded: {\n                Item: {\n                    \"Eye Ray\": warpgate.CONST.DELETE,\n                    \"Psychic Slam\": warpgate.CONST.DELETE,\n                    \"Whispering Aura\": warpgate.CONST.DELETE\n                }\n            }\n        }\n    }, {\n        label: formStarSpawn,\n        value: {\n            actor: { name: formStarSpawn },\n            token: { name: formStarSpawn },\n            embedded: {\n                Item: {\n                    \"Claws\": warpgate.CONST.DELETE,\n                    \"Eye Ray\": warpgate.CONST.DELETE,\n                    \"Regeneration\": warpgate.CONST.DELETE\n                }\n            }\n        }\n    }\n    ], title: \"Which version?\"\n};\n\nlet spirit = await warpgate.buttonDialog(buttonData);\n\n/* Craft the updates that are common to all spirits */\nlet updates = {\n    token: {\n        \"displayName\": CONST.TOKEN_DISPLAY_MODES.HOVER,\n        \"flags.Tablerules.spellLevel\": level\n    },\n    actor: {\n        'system.attributes.ac.flat': 11 + level,\n        'system.attributes.hp': { value: 40 + 10 * (level - 4), max: 40 + 10 * (level - 4) },\n        \"system.details.cr\": actor.system.attributes.prof,\n        \"system.attributes.prof\": actor.system.attributes.prof,\n        \"flags.world.summoned.item\": item.uuid,\n        \"flags.world.summoned.actor\": actor.uuid\n    },\n    embedded: {\n        Item: {\n            \"Multiattack\": { name: `Multiattack (${Math.floor(level / 2)} attacks)` },\n            \"Claws\": {\n                'system.damage.parts': [[`1d10 + 3 + ${level}`, \"slashing\"]],\n                'system.attackBonus': `- @mod - @prof + ${summonerAttack}`,\n            },\n            \"Eye Ray\": {\n                'system.damage.parts': [[`1d8 + 3 + ${level}`, \"psychic\"]],\n                'system.attackBonus': `- @mod - @prof + ${summonerAttack}`,\n            },\n            \"Psychic Slam\": {\n                'system.damage.parts': [[`1d8 + 3 + ${level}`, \"psychic\"]],\n                'system.attackBonus': `- @mod - @prof + ${summonerAttack}`,\n            },\n            \"Whispering Aura\": {\n                \"system.save.dc\": summonerDc\n            }\n        }\n    }\n}\n\n/* update variants */\nif (spirit.actor.name === \"Beholderkin\") {\n    updates[\"actor.img\"] = textureBeholderkin;\n    updates[\"token.texture.src\"] = textureBeholderkin;\n    updates[\"token.texture.scaleX\"] = scaleBeholderkin;\n    updates[\"token.texture.scaleY\"] = scaleBeholderkin;\n    updates[\"actor.system.attributes.movement.fly\"] = 30;\n    updates[\"actor.system.attributes.movement.hover\"] = true;\n}\n\nif (spirit.actor.name === \"Slaad\") {\n    updates[\"actor.img\"] = textureSlaad;\n    updates[\"token.texture.src\"] = textureSlaad;\n    updates[\"token.texture.scaleX\"] = scaleSlaad;\n    updates[\"token.texture.scaleY\"] = scaleSlaad;\n    updates[\"actor.system.attributes.movement.fly\"] = 0;\n}\n\nif (spirit.actor.name === \"Star Spawn\") {\n    updates[\"actor.img\"] = textureStarSpawn;\n    updates[\"token.texture.src\"] = textureStarSpawn;\n    updates[\"token.texture.scaleX\"] = scaleStarSpawn;\n    updates[\"token.texture.scaleY\"] = scaleStarSpawn;\n    updates[\"actor.system.attributes.movement.fly\"] = 0;\n}\n\n/* Combine the general and specific updates */\nupdates = mergeObject(updates, spirit);\n\nconst spawnIds = await warpgate.spawn(\"Aberrant Spirit\", updates);\n\n//const spawn = canvas.tokens.get(spawnIds[0]); // or canvas.scene.tokens.get(id) to get the document immediately for further changes like animations.\n\nif (spirit.actor.name === formStarSpawn) {\n    const token = canvas.tokens.get(spawnIds[0]);\n    // create and attach MeasuredTemplate\n    const data = {\n        distance: 7.5,\n        borderColor: \"#52004b\",\n        fillColor: \"#940088\",\n        x: token.center.x,\n        y: token.center.y\n    };\n    foundry.utils.setProperty(data, \"flags.dnd5e.origin\", item.uuid);\n    await canvas.scene.createEmbeddedDocuments(\"MeasuredTemplate\", [data]);\n\n    const template = canvas.scene.templates.find(t => t.flags?.dnd5e?.origin === item.uuid);\n    await tokenAttacher.attachElementsToToken([template], token);\n}","author":"YCF2Heb7DMHDaF2f","_id":null,"img":"icons/svg/dice-target.svg","folder":null,"sort":0,"ownership":{"default":0},"flags":{},"_stats":{"systemId":null,"systemVersion":null,"coreVersion":null,"createdTime":null,"modifiedTime":null,"lastModifiedBy":null}}},"core":{"sourceId":"Actor.eLUEKKNI2QejlHF0.Item.eil49CCk9EyOrswr"}},"img":"icons/creatures/unholy/demon-fanged-horned-yellow.webp","effects":[{"label":"Summon Aberration","icon":"icons/creatures/unholy/demon-fanged-horned-yellow.webp","origin":"Actor.eLUEKKNI2QejlHF0.Item.eil49CCk9EyOrswr","duration":{"seconds":3600,"startTime":null,"combat":null,"rounds":null,"turns":null,"startRound":null,"startTurn":null},"disabled":false,"_id":"NEQMI2yTMDHET4NE","changes":[],"tint":null,"transfer":false,"flags":{}}],"ownership":{"default":0,"YCF2Heb7DMHDaF2f":3},"_stats":{"systemId":"dnd5e","systemVersion":"2.1.5","coreVersion":"10.291","createdTime":1678390721645,"modifiedTime":1678716554887,"lastModifiedBy":"YCF2Heb7DMHDaF2f"},"folder":null,"sort":0,"_id":"2qiny4oOyIvFTssu"}
{"type":"spell","system":{"description":{"value":"<p>A flash of light streaks toward a creature of your choice within range. Make a ranged spell attack against the target. On a hit, the target takes 4d6 radiant damage, and the next attack roll made against this target before the end of your next turn has advantage, thanks to the mystical dim light glittering on the target until then.</p>\n<p><strong>At Higher Levels.</strong> When you cast this spell using a spell slot of 2nd level or higher, the damage increases by 1d6 for each slot level above 1st.</p>","chat":"","unidentified":""},"source":"Basic Rules, Player's Handbook pg 248","activation":{"type":"action","cost":1,"condition":""},"duration":{"value":1,"units":"round"},"target":{"value":1,"width":null,"units":"","type":"creature"},"range":{"value":120,"long":null,"units":"ft"},"uses":{"value":null,"max":"","per":"","recovery":""},"consume":{"type":"","target":"","amount":null},"ability":"wis","actionType":"rsak","attackBonus":"0","chatFlavor":"","critical":{"threshold":null,"damage":""},"damage":{"parts":[["4d6[radiant]","radiant"]],"versatile":""},"formula":"","save":{"ability":"","dc":null,"scaling":"spell"},"level":1,"school":"evo","components":{"value":"","vocal":true,"somatic":true,"material":false,"ritual":false,"concentration":false},"materials":{"value":"","consumed":false,"cost":0,"supply":0},"preparation":{"mode":"prepared","prepared":false},"scaling":{"mode":"level","formula":"1d6"}},"name":"Guiding Bolt","flags":{"ddbimporter":{"id":138023,"definitionId":2133,"entityTypeId":435869154,"dndbeyond":{"lookup":"classSpell","class":"Cleric","level":1,"characterClassId":118182112,"spellLevel":1,"ability":"wis","mod":2,"dc":12,"cantripBoost":false,"overrideDC":false,"id":138023,"entityTypeId":435869154,"healingBoost":2,"usesSpellSlot":true},"originalName":"Guiding Bolt","sources":[{"sourceId":1,"pageNumber":null,"sourceType":2},{"sourceId":2,"pageNumber":248,"sourceType":1}],"tags":["Damage","Buff"],"version":"3.2.4","importId":"XpwygIbTgqS9zbhX"},"spell-class-filter-for-5e":{"parentClass":"cleric"},"midi-qol":{"fumbleThreshold":null,"effectActivation":false,"forceCEOn":false},"midiProperties":{"nodam":false,"fulldam":false,"halfdam":false,"rollOther":false,"critOther":false,"magicdam":false,"magiceffect":false,"concentration":false,"toggleEffect":false,"ignoreTotalCover":false},"core":{"sourceId":"Actor.jItLUReNSJ6NAwL3.Item.TrSQY9r3fAutcaUU"}},"img":"icons/magic/fire/projectile-fireball-smoke-large-blue.webp","effects":[{"label":"Guiding Bolt","icon":"icons/magic/fire/projectile-fireball-smoke-large-blue.webp","origin":"Actor.3IDJAqCn3WKSy8xf.Item.TrSQY9r3fAutcaUU","duration":{"rounds":1,"startTime":null,"seconds":null,"combat":null,"turns":null,"startRound":null,"startTurn":null},"disabled":false,"_id":"ID0l92YKhsroB0ok","changes":[],"tint":null,"transfer":false,"flags":{"effectmacro":{"onCreate":{"script":"let params =\n[{\n    filterType: \"glow\",\n    filterId: \"GuidingBolt\",\n    outerStrength: 4,\n    innerStrength: 0,\n    color: 0x5099DD,\n    quality: 0.5,\n    padding: 10,\n    animated:\n    {\n        color: \n        {\n           active: true, \n           loopDuration: 3000, \n           animType: \"colorOscillation\", \n           val1:0xfff24f, \n           val2:0xfffabc\n        }\n    }\n}];\n\nawait TokenMagic.addFilters(token, params);"},"onDelete":{"script":"await TokenMagic.deleteFilters(token, \"GuidingBolt\");"}},"effective-transferral":{"transferBlock":{"button":false,"chat":false,"displayCard":false}},"dae":{"selfTarget":false,"selfTargetAlways":false,"stackable":"none","durationExpression":"","macroRepeat":"none","specialDuration":[]},"core":{"statusId":""}}}],"_stats":{"systemId":"dnd5e","systemVersion":"2.0.3","coreVersion":"10.291","createdTime":1669694313372,"modifiedTime":1671041501812,"lastModifiedBy":"npmYF618vZgxA5SD"},"ownership":{"default":0,"npmYF618vZgxA5SD":3},"folder":null,"sort":0,"_id":"4TWWkEh04XwJDdMz"}
{"type":"spell","system":{"description":{"value":"<p>You call forth spirits to protect you. They flit around you to a distance of 15 feet for the duration. If you are good or neutral, their spectral form appears angelic or fey (your choice). If you are evil, they appear fiendish.</p>\n<p>When you cast this spell, you can designate any number of creatures you can see to be unaffected by it. An affected creature's speed is halved in the area, and when the creature enters the area for the first time on a turn or starts its turn there, it must make a Wisdom saving throw. On a failed save, the creature takes 3d8 radiant damage (if you are good or neutral) or 3d8 necrotic damage (if you are evil). On a successful save, the creature takes half as much damage.</p>\n<p><strong>At Higher Levels.</strong> When you cast this spell using a spell slot of 4th level or higher, the damage increases by 1d8 for each slot level above 3rd.</p>","chat":"","unidentified":""},"source":"Basic Rules, Player's Handbook pg 278","activation":{"type":"action","cost":1,"condition":""},"duration":{"value":"10","units":"minute"},"cover":null,"target":{"value":15,"width":null,"units":"ft","type":"sphere"},"range":{"value":null,"long":null,"units":"self"},"uses":{"value":null,"max":"","per":"","recovery":""},"consume":{"type":"","target":"","amount":null},"ability":"","actionType":"save","attackBonus":"","chatFlavor":"","critical":{"threshold":null,"damage":""},"damage":{"parts":[["3d8","radiant"]],"versatile":""},"formula":"","save":{"ability":"wis","dc":null,"scaling":"spell"},"level":3,"school":"con","components":{"vocal":true,"somatic":true,"material":true,"ritual":false,"concentration":true},"materials":{"value":"a holy symbol","consumed":false,"cost":0,"supply":0},"preparation":{"mode":"prepared","prepared":true},"scaling":{"mode":"level","formula":"1d8"}},"name":"Spirit Guardians","flags":{"ddbimporter":{"id":138784,"definitionId":2264,"entityTypeId":435869154,"dndbeyond":{"lookup":"classSpell","class":"Cleric","level":14,"characterClassId":127710854,"spellLevel":3,"ability":"wis","mod":3,"dc":16,"cantripBoost":false,"overrideDC":false,"id":138784,"entityTypeId":435869154,"healingBoost":0,"usesSpellSlot":true},"originalName":"Spirit Guardians","sources":[{"sourceId":1,"pageNumber":null,"sourceType":2},{"sourceId":2,"pageNumber":278,"sourceType":1}],"tags":["Damage","Control"],"version":"3.3.16","damageType":"radiant","importId":"ApvPDBlD6sXmt6Na"},"midiProperties":{"magicdam":true,"magiceffect":true},"spell-class-filter-for-5e":{"parentClass":"cleric"},"itemacro":{"macro":{"name":"Spirit Guardians","type":"script","scope":"global","command":"/**\n * Item-Macro Macro for Spirit Guardians\n * \n * after dropping onto Actor create empty AE for duration/concentration and deleting the MeasuredTemplate with\n * await canvas.scene.deleteEmbeddedDocuments(\"MeasuredTemplate\",canvas.scene.templates.filter(t => t.flags?.dnd5e?.origin === origin.uuid).map(t=>t.id));\n * on Effect-Macro onDelete\n */\n\nconst macroLabel = item.name;\nconst icon = item.img;\n\nif (canvas.scene.templates.filter(t => t.flags.dnd5e !== undefined).filter(t => t.flags.dnd5e.origin === item.uuid).length !== 0) {\n    ui.notifications.warn(`${macroLabel}, MeasuredTemplate for this item ${item.name} (${item.uuid}) present. Delete if spell is supposed to not be active already (delte AE if present).`);\n    return;\n}\n\n\n// use the item (takes care of resources, ChatMessage), if returning null (i believe) return\nconst use = await item.use();\nif (!use) {\n    return;\n}\n\n// select the MeasuringTemplate created by the Item.Spell use() and modify\ntemplate = canvas.scene.templates.filter(t => t.flags.dnd5e !== undefined).find(t => t.flags.dnd5e.origin === item.uuid);\n\nconst templateData = {\n    distance: 17.5,\n    borderColor: \"#00800f\",\n    fillColor: \"#022400\",\n    x: token.center.x,\n    y: token.center.y\n};\nawait template.update(templateData);\nawait tokenAttacher.attachElementsToToken([template], token);","author":"YCF2Heb7DMHDaF2f","_id":null,"img":"icons/svg/dice-target.svg","folder":null,"sort":0,"ownership":{"default":0},"flags":{},"_stats":{"systemId":null,"systemVersion":null,"coreVersion":null,"createdTime":null,"modifiedTime":null,"lastModifiedBy":null}}},"core":{"sourceId":"Actor.25uya6OX8BbpJcRj.Item.6SJHVPx38Hiz2t80"}},"img":"icons/magic/defensive/shield-barrier-blades-teal.webp","effects":[{"label":"Spirit Guardians","icon":"icons/magic/defensive/shield-barrier-blades-teal.webp","origin":"Actor.25uya6OX8BbpJcRj.Item.6SJHVPx38Hiz2t80","duration":{"seconds":600,"startTime":null,"combat":null,"rounds":null,"turns":null,"startRound":null,"startTurn":null},"disabled":false,"_id":"1MiJQrL0cHX4TIYS","changes":[],"tint":null,"transfer":false,"flags":{"dfreds-convenient-effects":{"description":""},"effective-transferral":{"transferBlock":{"button":false,"chat":false,"displayCard":false},"transferrable":{"self":true,"target":true}},"dae":{"selfTarget":false,"selfTargetAlways":false,"stackable":"none","durationExpression":"","macroRepeat":"none","specialDuration":[]},"core":{"statusId":""},"effectmacro":{"onDelete":{"script":"await canvas.scene.deleteEmbeddedDocuments(\"MeasuredTemplate\",canvas.scene.templates.filter(t => t.flags?.dnd5e?.origin === origin.uuid).map(t=>t.id));"}}}}],"ownership":{"default":0,"YCF2Heb7DMHDaF2f":3},"_stats":{"systemId":"dnd5e","systemVersion":"2.1.5","coreVersion":"10.291","createdTime":1678310374442,"modifiedTime":1678631239734,"lastModifiedBy":"YCF2Heb7DMHDaF2f"},"folder":null,"sort":0,"_id":"5Wi1APjFsXqcbQdV"}
{"type":"spell","system":{"description":{"value":"<p>You call forth a fiendish spirit. It manifests in an unoccupied space that you can see within range. This corporeal form uses the Fiendish Spirit stat block. When you cast the spell, choose Demon, Devil, or Yugoloth. The creature resembles a fiend of the chosen type, which determines certain traits in its stat block. The creature disappears when it drops to 0 hit points or when the spell ends.</p>\n<p>The creature is an ally to you and your companions. In combat, the creature shares your initiative count, but it takes its turn immediately after yours. It obeys your verbal commands (no action required by you). If you don’t issue any, it takes the Dodge action and uses its move to avoid danger.</p>\n<p><em><strong>At Higher Levels.</strong></em> When you cast this spell using a spell slot of 7th level or higher, use the higher level wherever the spell’s level appears in the stat block.</p>\n<div class=\"Basic-Text-Frame stat-block-finder stat-block-background\">\n<p class=\"Stat-Block-Styles_Stat-Block-Title\">Fiendish Spirit</p>\n<p class=\"Stat-Block-Styles_Stat-Block-Metadata\">Large fiend</p>\n<p class=\"Stat-Block-Styles_Stat-Block-Data\"><strong>Armor Class</strong> 12 + the level of the spell (natural armor)</p>\n<p class=\"Stat-Block-Styles_Stat-Block-Data\"><strong>Hit Points</strong> 50 (Demon only) or 40 (Devil only) or 60 (Yugoloth only) + 15 for each spell level above 6th</p>\n<p class=\"Stat-Block-Styles_Stat-Block-Data\"><strong>Speed</strong> 40 ft.; climb 40 ft. (Demon only); fly 60 ft. (Devil only)</p>\n<div class=\"stat-block-ability-scores\">\n<div class=\"stat-block-ability-scores-stat\">\n<div class=\"stat-block-ability-scores-heading\">STR</div>\n<div class=\"stat-block-ability-scores-data\"><span class=\"stat-block-ability-scores-score\">13</span> <span class=\"stat-block-ability-scores-modifier\">(+1)</span></div>\n</div>\n<div class=\"stat-block-ability-scores-stat\">\n<div class=\"stat-block-ability-scores-heading\">DEX</div>\n<div class=\"stat-block-ability-scores-data\"><span class=\"stat-block-ability-scores-score\">16</span> <span class=\"stat-block-ability-scores-modifier\">(+3)</span></div>\n</div>\n<div class=\"stat-block-ability-scores-stat\">\n<div class=\"stat-block-ability-scores-heading\">CON</div>\n<div class=\"stat-block-ability-scores-data\"><span class=\"stat-block-ability-scores-score\">15</span> <span class=\"stat-block-ability-scores-modifier\">(+2)</span></div>\n</div>\n<div class=\"stat-block-ability-scores-stat\">\n<div class=\"stat-block-ability-scores-heading\">INT</div>\n<div class=\"stat-block-ability-scores-data\"><span class=\"stat-block-ability-scores-score\">10</span> <span class=\"stat-block-ability-scores-modifier\">(+0)</span></div>\n</div>\n<div class=\"stat-block-ability-scores-stat\">\n<div class=\"stat-block-ability-scores-heading\">WIS</div>\n<div class=\"stat-block-ability-scores-data\"><span class=\"stat-block-ability-scores-score\">10</span> <span class=\"stat-block-ability-scores-modifier\">(+0)</span></div>\n</div>\n<div class=\"stat-block-ability-scores-stat\">\n<div class=\"stat-block-ability-scores-heading\">CHA</div>\n<div class=\"stat-block-ability-scores-data\"><span class=\"stat-block-ability-scores-score\">16</span> <span class=\"stat-block-ability-scores-modifier\">(+3)</span></div>\n</div>\n</div>\n<p class=\"Stat-Block-Styles_Stat-Block-Data\"><strong>Damage Resistances </strong>fire</p>\n<p class=\"Stat-Block-Styles_Stat-Block-Data\"><strong>Damage Immunities </strong>poison</p>\n<p class=\"Stat-Block-Styles_Stat-Block-Data\"><strong>Condition Immunities </strong>@Compendium[dnd5e.rules.w7eitkpD7QQTB6j0]{poisoned}</p>\n<p class=\"Stat-Block-Styles_Stat-Block-Data\"><strong>Senses </strong>@Compendium[dnd5e.rules.eVtpEGXjA2tamEIJ]{darkvision} 60 ft., passive @Compendium[dnd5e.rules.0AGfrwZRzSG0vNKb]{Perception} 10</p>\n<p class=\"Stat-Block-Styles_Stat-Block-Data\"><strong>Languages </strong>Abyssal, Infernal, telepathy 60 ft.</p>\n<p class=\"Stat-Block-Styles_Stat-Block-Data-Last\"><strong>Challenge</strong> — <strong>Proficiency Bonus</strong> equals your bonus</p>\n<p class=\"Stat-Block-Styles_Stat-Block-Body\"><em><strong>Death Throes (Demon Only).</strong></em> When the fiend drops to 0 hit points or the spell ends, the fiend explodes, and each creature within 10 feet of it must make a Dexterity saving throw against your spell save DC. A creature takes 2d10 + this spell’s level fire damage on a failed save, or half as much damage on a successful one.</p>\n<p class=\"Stat-Block-Styles_Stat-Block-Body\"><em><strong>Devil’s Sight (Devil Only).</strong></em> Magical darkness doesn’t impede the fiend’s @Compendium[dnd5e.rules.eVtpEGXjA2tamEIJ]{darkvision}.</p>\n<p class=\"Stat-Block-Styles_Stat-Block-Body\"><em><strong>Magic Resistance.</strong></em> The fiend has advantage on saving throws against spells and other magical effects.</p>\n<p class=\"Stat-Block-Styles_Stat-Block-Heading\">Actions</p>\n<p class=\"Stat-Block-Styles_Stat-Block-Body\"><em><strong>Multiattack.</strong></em> The fiend makes a number of attacks equal to half this spell’s level (rounded down).</p>\n<p class=\"Stat-Block-Styles_Stat-Block-Body\"><em><strong>Bite (Demon Only).</strong></em> <em>Melee Weapon Attack:</em> your spell attack modifier to hit, reach 5 ft., one target. <em>Hit:</em> 1d12 + 3 + the spell’s level necrotic damage.</p>\n<p class=\"Stat-Block-Styles_Stat-Block-Body\"><em><strong>Claws (Yugoloth Only).</strong></em> <em>Melee Weapon Attack:</em> your spell attack modifier to hit, reach 5 ft., one target. <em>Hit:</em> 1d8 + 3 + the spell’s level slashing damage. Immediately after the attack hits or misses, the fiend can magically teleport up to 30 feet to an unoccupied space it can see.</p>\n<p class=\"Stat-Block-Styles_Stat-Block-Body\"><em><strong>Hurl Flame (Devil Only).</strong></em> <em>Ranged Spell Attack:</em> your spell attack modifier to hit, range 150 ft., one target. <em>Hit:</em> 2d6 + 3 + the spell’s level fire damage. If the target is a flammable object that isn’t being worn or carried, it also catches fire.</p>\n</div>","chat":"","unidentified":""},"source":"Tasha’s Cauldron of Everything pg 112","activation":{"type":"action","cost":1,"condition":""},"duration":{"value":"1","units":"hour"},"cover":null,"target":{"value":null,"width":null,"units":"","type":""},"range":{"value":90,"long":null,"units":"ft"},"uses":{"value":null,"max":"","per":"","recovery":""},"consume":{"type":"","target":"","amount":null},"ability":"","actionType":"other","attackBonus":"","chatFlavor":"","critical":{"threshold":null,"damage":""},"damage":{"parts":[],"versatile":""},"formula":"","save":{"ability":"","dc":null,"scaling":"spell"},"level":6,"school":"con","components":{"vocal":true,"somatic":true,"material":true,"ritual":false,"concentration":true},"materials":{"value":"humanoid blood inside a ruby vial worth at least 600 gp","consumed":false,"cost":600,"supply":0},"preparation":{"mode":"prepared","prepared":false},"scaling":{"mode":"none","formula":""}},"name":"Summon Fiend","flags":{"ddbimporter":{"id":5843024,"definitionId":719934,"entityTypeId":435869154,"dndbeyond":{"lookup":"classSpell","class":"Wizard","level":20,"characterClassId":128250765,"spellLevel":6,"ability":"int","mod":5,"dc":19,"cantripBoost":false,"overrideDC":false,"id":5843024,"entityTypeId":435869154,"healingBoost":0,"usesSpellSlot":true},"originalName":"Summon Fiend","sources":[{"sourceId":67,"pageNumber":112,"sourceType":1}],"tags":["Summoning"],"version":"3.3.16","importId":"2SMktUT3UBtnkWqF"},"midiProperties":{"magicdam":true,"magiceffect":true},"spell-class-filter-for-5e":{"parentClass":"wizard"},"itemacro":{"macro":{"name":"Summon Fiend","type":"script","scope":"global","command":"/**\n * Item-Macro Macro.\n * \n * https://www.dndbeyond.com/spells/summon-fiend\n */\n\nconst macroLabel = item.name;\nconst textureDemon = \"modules/Tablerules/icons/magic/summons/fiendishSpiritDemon.png\";\nconst textureDevil = \"modules/Tablerules/icons/magic/summons/fiendishSpiritDevil.png\";\nconst textureYugoloth = \"modules/Tablerules/icons/magic/summons/fiendishSpiritYugoloth.png\";\n\nconst level = await warpgate.dnd5e.rollItem(item);\nconst summonerDc = actor.system.attributes.spelldc;\nconst summonerAttack = summonerDc - 8;\n\nif (!level > 0) {\n    ui.notifications.error(`${macroLabel}, !level>0, check console error.`);\n    console.error({ message: `${macroLabel}, !level>0`, arguments: arguments });\n    return;\n}\n\n/* Prompt the user for which type of spirit to summon */\nconst buttonData = {\n    buttons: [{\n        label: \"Demon\",\n        value: {\n            token: { name: \"Demon\" },\n            actor: { name: \"Demon\" },\n            embedded: {\n                Item: {\n                    \"Claws\": warpgate.CONST.DELETE,\n                    \"Hurl Flame\": warpgate.CONST.DELETE\n                }\n            }\n        }\n    }, {\n        label: \"Devil\",\n        value: {\n            actor: { name: \"Devil\" },\n            token: { name: \"Devil\" },\n            embedded: {\n                Item: {\n                    \"Claws\": warpgate.CONST.DELETE,\n                    \"Bite\": warpgate.CONST.DELETE,\n                    \"Death Throes\": warpgate.CONST.DELETE\n                }\n            }\n        }\n    }, {\n        label: \"Yugoloth\",\n        value: {\n            actor: { name: \"Yugoloth\" },\n            token: { name: \"Yugoloth\" },\n            embedded: {\n                Item: {\n                    \"Bite\": warpgate.CONST.DELETE,\n                    \"Hurl Flame\": warpgate.CONST.DELETE,\n                    \"Death Throes\": warpgate.CONST.DELETE\n                }\n            }\n        }\n    }\n    ], title: \"Which version?\"\n};\n\nlet spirit = await warpgate.buttonDialog(buttonData);\n\n/* Craft the updates that are common to all spirits */\nlet updates = {\n    token: {\n        \"displayName\": CONST.TOKEN_DISPLAY_MODES.HOVER,\n        \"flags.Tablerules.spellLevel\": level\n    },\n    actor: {\n        'system.attributes.ac.flat': 11 + level,\n        'system.attributes.hp': { value: 50 + 15 * (level - 6), max: 50 + 15 * (level - 6) },\n        \"system.details.cr\": actor.system.attributes.prof,\n        \"system.attributes.prof\": actor.system.attributes.prof,\n        \"flags.world.summoned.item\": item.uuid,\n        \"flags.world.summoned.actor\": actor.uuid\n    },\n    embedded: {\n        Item: {\n            \"Multiattack\": { name: `Multiattack (${Math.floor(level / 2)} attacks)` },\n            \"Claws\": {\n                'system.damage.parts': [[`1d8 + 3 + ${level}`, \"slashing\"]],\n                'system.attackBonus': `- @mod - @prof + ${summonerAttack}`,\n            },\n            \"Bite\": {\n                'system.damage.parts': [[`1d12 + 3 + ${level}`, \"necrotic\"]],\n                'system.attackBonus': `- @mod - @prof + ${summonerAttack}`,\n            },\n            \"Hurl Flame\": {\n                'system.damage.parts': [[`2d6 + 3 + ${level}`, \"fire\"]],\n                'system.attackBonus': `- @mod - @prof + ${summonerAttack}`,\n            },\n            \"Death Throes\": {\n                \"system.save.dc\": summonerDc,\n                'system.damage.parts': [[`2d10 + ${level}`, \"fire\"]],\n            }\n        }\n    }\n}\n\n/* update variants */\nif (spirit.actor.name === \"Demon\") {\n    updates[\"actor.img\"] = textureDemon;\n    updates[\"token.texture.src\"] = textureDemon;\n    updates[\"actor.system.attributes.movement.climb\"] = 40;\n}\n\nif (spirit.actor.name === \"Devil\") {\n    updates[\"actor.img\"] = textureDevil;\n    updates[\"token.texture.src\"] = textureDevil;\n    updates[\"actor.system.attributes.movement.fly\"] = 60;\n    updates['actor.system.attributes.hp'] = { value: 40 + 15 * (level - 6), max: 40 + 15 * (level - 6) };\n}\n\nif (spirit.actor.name === \"Yugoloth\") {\n    updates[\"actor.img\"] = textureYugoloth;\n    updates[\"token.texture.src\"] = textureYugoloth;\n    updates['actor.system.attributes.hp'] = { value: 60 + 15 * (level - 6), max: 60 + 15 * (level - 6) };\n}\n\n/* Combine the general and specific updates */\nupdates = mergeObject(updates, spirit);\n\nconst spawnIds = await warpgate.spawn(\"Fiendish Spirit\", updates);","author":"YCF2Heb7DMHDaF2f","_id":null,"img":"icons/svg/dice-target.svg","folder":null,"sort":0,"ownership":{"default":0},"flags":{},"_stats":{"systemId":null,"systemVersion":null,"coreVersion":null,"createdTime":null,"modifiedTime":null,"lastModifiedBy":null}}},"core":{"sourceId":"Actor.Q7hqVwhDhhZq8QEa.Item.wMDQ7AEQvDcu8Y4N"}},"img":"icons/magic/fire/explosion-embers-evade-silhouette.webp","effects":[],"ownership":{"default":0,"YCF2Heb7DMHDaF2f":3},"_stats":{"systemId":"dnd5e","systemVersion":"2.1.5","coreVersion":"10.291","createdTime":1678464911486,"modifiedTime":1678716564458,"lastModifiedBy":"YCF2Heb7DMHDaF2f"},"folder":null,"sort":0,"_id":"5fR4ejeka4Hvming"}
{"type":"spell","system":{"description":{"value":"<p>Each object in a 20-foot cube within range is outlined in blue, green, or violet light (your choice). Any creature in the area when the spell is cast is also outlined in light if it fails a Dexterity saving throw. For the duration, objects and affected creatures shed dim light in a 10-foot radius.</p>\n<p>Any attack roll against an affected creature or object has advantage if the attacker can see it, and the affected creature or object can't benefit from being @Compendium[dnd5e.rules.w7eitkpD7QQTB6j0]{invisible}.</p>","chat":"","unidentified":""},"source":"Basic Rules, Player's Handbook pg 239","activation":{"type":"action","cost":1,"condition":""},"duration":{"value":1,"units":"minute"},"target":{"value":20,"width":null,"units":"ft","type":"cube"},"range":{"value":60,"long":null,"units":"ft"},"uses":{"value":null,"max":"","per":"","recovery":""},"consume":{"type":"","target":"","amount":null},"ability":"","actionType":"save","attackBonus":0,"chatFlavor":"","critical":{"threshold":null,"damage":""},"damage":{"parts":[],"versatile":""},"formula":"","save":{"ability":"dex","dc":null,"scaling":"spell"},"level":1,"school":"evo","components":{"value":"","vocal":true,"somatic":false,"material":false,"ritual":false,"concentration":true},"materials":{"value":"","consumed":false,"cost":0,"supply":0},"preparation":{"mode":"always","prepared":true},"scaling":{"mode":"none","formula":""}},"name":"Faerie Fire","flags":{"ddbimporter":{"id":1337237,"definitionId":2091,"entityTypeId":420821570,"dndbeyond":{"class":"Ranger","lookup":"classFeature","lookupName":"Swarmkeeper Magic","lookupId":2991412,"level":3,"ability":"wis","mod":3,"dc":13,"overrideDC":false,"id":1337237,"entityTypeId":420821570,"healingBoost":0,"usesSpellSlot":true},"originalName":"Faerie Fire","sources":[{"sourceId":1,"pageNumber":null,"sourceType":2},{"sourceId":2,"pageNumber":239,"sourceType":1}],"tags":["Debuff"],"version":"3.2.7","importId":"zamgiLpNfuUC7XVv"},"midi-qol":{"effectActivation":false,"forceCEOn":false},"midiProperties":{"nodam":false,"fulldam":false,"halfdam":false,"autoFailFriendly":false,"rollOther":false,"critOther":false,"offHandWeapon":false,"magicdam":false,"magiceffect":false,"concentration":false,"toggleEffect":false,"ignoreTotalCover":false},"core":{"sourceId":"Actor.LRVMkm47PS7mtTbc.Item.PR5GLiREEx7hGAS5"}},"img":"icons/magic/fire/projectile-meteor-salvo-strong-teal.webp","effects":[{"label":"Faerie Fire","icon":"icons/magic/fire/projectile-meteor-salvo-strong-teal.webp","origin":"Actor.LRVMkm47PS7mtTbc.Item.PR5GLiREEx7hGAS5","duration":{"seconds":60,"startTime":null,"combat":null,"rounds":null,"turns":null,"startRound":null,"startTurn":null},"disabled":false,"_id":"zCaRxtVk0VGJIWNr","changes":[],"tint":null,"transfer":false,"flags":{"effective-transferral":{"transferBlock":{"button":false,"chat":false,"displayCard":false},"transferrable":{"self":true,"target":true}},"dae":{"selfTarget":false,"selfTargetAlways":false,"stackable":"none","durationExpression":"","macroRepeat":"none","specialDuration":[]},"core":{"statusId":""},"effectmacro":{"onCreate":{"script":"let params =\n[{\n    filterType: \"glow\",\n    filterId: \"Faerie Fire\",\n    outerStrength: 4,\n    innerStrength: 0,\n    color: 0x5099DD,\n    quality: 0.5,\n    padding: 10,\n    animated:\n    {\n        color: \n        {\n           active: true, \n           loopDuration: 3000, \n           animType: \"colorOscillation\", \n           val1:0x00FF00, \n           val2:0x006600\n        }\n    }\n}];\n\nawait TokenMagic.addUpdateFilters(token, params);"},"onDelete":{"script":"await TokenMagic.deleteFilters(token, \"Faerie Fire\");"}}}}],"_stats":{"systemId":"dnd5e","systemVersion":"2.0.3","coreVersion":"10.291","createdTime":1670449337548,"modifiedTime":1671041496203,"lastModifiedBy":"npmYF618vZgxA5SD"},"ownership":{"default":0,"npmYF618vZgxA5SD":3},"folder":null,"sort":0,"_id":"9zSosmFfHluIlPll"}
{"type":"spell","system":{"description":{"value":"<p>You call forth a draconic spirit. It manifests in an unoccupied space that you can see within range. This corporeal form uses the Draconic Spirit stat block. When you cast this spell, choose a family of dragon: chromatic, gem, or metallic. The creature resembles a dragon of the chosen family, which determines certain traits in its stat block. The creature disappears when it drops to 0 hit points or when the spell ends.</p>\n<p>The creature is an ally to you and your companions. In combat, the creature shares your initiative count, but it takes its turn immediately after yours. It obeys your verbal commands (no action required by you). If you don’t issue any, it takes the Dodge action and uses its move to avoid danger.</p>\n<p><em><strong>At Higher Levels.</strong></em> When you cast this spell using a spell slot of 6th level or higher, use the higher level wherever the spell’s level appears in the stat block.</p>\n<div class=\"Basic-Text-Frame stat-block-background stat-block-finder\">\n<p class=\"Stat-Block-Styles_Stat-Block-Title\">Draconic Spirit</p>\n<p class=\"Stat-Block-Styles_Stat-Block-Metadata\">Large Dragon, Neutral</p>\n<p class=\"Stat-Block-Styles_Stat-Block-Data\"><strong>Armor Class</strong> 14 + the level of the spell (natural armor)</p>\n<p class=\"Stat-Block-Styles_Stat-Block-Data\"><strong>Hit Points</strong> 50 + 10 for each spell level above 5th (the dragon has a number of Hit Dice [d10s] equal to the level of the spell)</p>\n<p class=\"Stat-Block-Styles_Stat-Block-Data\"><strong>Speed</strong> 30 ft., fly 60 ft., swim 30 ft.</p>\n<div class=\"stat-block-ability-scores\">\n<div class=\"stat-block-ability-scores-stat\">\n<div class=\"stat-block-ability-scores-heading\">STR</div>\n<div class=\"stat-block-ability-scores-data\"><span class=\"stat-block-ability-scores-score\">19</span> <span class=\"stat-block-ability-scores-modifier\">(+4)</span></div>\n</div>\n<div class=\"stat-block-ability-scores-stat\">\n<div class=\"stat-block-ability-scores-heading\">DEX</div>\n<div class=\"stat-block-ability-scores-data\"><span class=\"stat-block-ability-scores-score\">14</span> <span class=\"stat-block-ability-scores-modifier\">(+2)</span></div>\n</div>\n<div class=\"stat-block-ability-scores-stat\">\n<div class=\"stat-block-ability-scores-heading\">CON</div>\n<div class=\"stat-block-ability-scores-data\"><span class=\"stat-block-ability-scores-score\">17</span> <span class=\"stat-block-ability-scores-modifier\">(+3)</span></div>\n</div>\n<div class=\"stat-block-ability-scores-stat\">\n<div class=\"stat-block-ability-scores-heading\">INT</div>\n<div class=\"stat-block-ability-scores-data\"><span class=\"stat-block-ability-scores-score\">10</span> <span class=\"stat-block-ability-scores-modifier\">(+0)</span></div>\n</div>\n<div class=\"stat-block-ability-scores-stat\">\n<div class=\"stat-block-ability-scores-heading\">WIS</div>\n<div class=\"stat-block-ability-scores-data\"><span class=\"stat-block-ability-scores-score\">14</span> <span class=\"stat-block-ability-scores-modifier\">(+2)</span></div>\n</div>\n<div class=\"stat-block-ability-scores-stat\">\n<div class=\"stat-block-ability-scores-heading\">CHA</div>\n<div class=\"stat-block-ability-scores-data\"><span class=\"stat-block-ability-scores-score\">14</span> <span class=\"stat-block-ability-scores-modifier\">(+2)</span></div>\n</div>\n</div>\n<p class=\"Stat-Block-Styles_Stat-Block-Data\"><strong>Damage Resistances (Chromatic and Metallic Only)</strong> acid, cold, fire, lightning, poison</p>\n<p class=\"Stat-Block-Styles_Stat-Block-Data\"><strong>Damage Resistances (Gem Only)</strong> force, necrotic, psychic, radiant, thunder</p>\n<p class=\"Stat-Block-Styles_Stat-Block-Data\"><strong>Condition Immunities</strong> @Compendium[dnd5e.rules.w7eitkpD7QQTB6j0]{charmed}, @Compendium[dnd5e.rules.w7eitkpD7QQTB6j0]{frightened}, @Compendium[dnd5e.rules.w7eitkpD7QQTB6j0]{poisoned}</p>\n<p class=\"Stat-Block-Styles_Stat-Block-Data\"><strong>Senses</strong> @Compendium[dnd5e.rules.eVtpEGXjA2tamEIJ]{blindsight} 30 ft., @Compendium[dnd5e.rules.eVtpEGXjA2tamEIJ]{darkvision} 60 ft., passive @Compendium[dnd5e.rules.0AGfrwZRzSG0vNKb]{Perception} 12</p>\n<p class=\"Stat-Block-Styles_Stat-Block-Data\"><strong>Languages</strong> Draconic, understands the languages you speak</p>\n<p class=\"Stat-Block-Styles_Stat-Block-Data-Last\"><strong>Challenge</strong> — <strong>Proficiency Bonus</strong> equals your bonus</p>\n<p class=\"Stat-Block-Styles_Stat-Block-Body\"><em><strong>Shared Resistances.</strong></em> When you summon the dragon, choose one of its damage resistances. You have resistance to the chosen damage type until the spell ends.</p>\n<p class=\"Stat-Block-Styles_Stat-Block-Heading\">Actions</p>\n<p class=\"Stat-Block-Styles_Stat-Block-Body\"><em><strong>Multiattack.</strong></em> The dragon makes a number of Rend attacks equal to half the spell’s level (rounded down), and it uses Breath Weapon.</p>\n<p class=\"Stat-Block-Styles_Stat-Block-Body\"><em><strong>Rend.</strong> Melee Weapon Attack:</em> your spell attack modifier to hit, reach 10 ft., one target. <em>Hit:</em> 1d6 + 4 + the spell’s level piercing damage.</p>\n<p class=\"Stat-Block-Styles_Stat-Block-Body\"><em><strong>Breath Weapon.</strong></em> The dragon exhales destructive energy in a 30-foot cone. Each creature in that area must make a Dexterity saving throw against your spell save DC. A creature takes 2d6 damage of a type this dragon has resistance to (your choice) on a failed save, or half as much damage on a successful one.</p>\n</div>","chat":"","unidentified":""},"source":"Fizban's Treasury of Dragons pg 21","activation":{"type":"action","cost":1,"condition":""},"duration":{"value":"1","units":"hour"},"cover":null,"target":{"value":null,"width":null,"units":"","type":""},"range":{"value":60,"long":null,"units":"ft"},"uses":{"value":null,"max":"","per":"","recovery":""},"consume":{"type":"","target":"","amount":null},"ability":"","actionType":"other","attackBonus":"","chatFlavor":"","critical":{"threshold":null,"damage":""},"damage":{"parts":[],"versatile":""},"formula":"","save":{"ability":"","dc":null,"scaling":"spell"},"level":5,"school":"con","components":{"vocal":true,"somatic":true,"material":true,"ritual":false,"concentration":true},"materials":{"value":"an object with the image of a dragon engraved on it, worth at least 500 gp","consumed":false,"cost":500,"supply":0},"preparation":{"mode":"prepared","prepared":false},"scaling":{"mode":"none","formula":""}},"name":"Summon Draconic Spirit","flags":{"ddbimporter":{"id":9603640,"definitionId":1183868,"entityTypeId":435869154,"dndbeyond":{"lookup":"classSpell","class":"Wizard","level":20,"characterClassId":128250765,"spellLevel":5,"ability":"int","mod":5,"dc":19,"cantripBoost":false,"overrideDC":false,"id":9603640,"entityTypeId":435869154,"healingBoost":0,"usesSpellSlot":true},"originalName":"Summon Draconic Spirit","sources":[{"sourceId":81,"pageNumber":21,"sourceType":1}],"tags":["Summoning"],"version":"3.3.16","importId":"2SMktUT3UBtnkWqF"},"midiProperties":{"magicdam":true,"magiceffect":true},"spell-class-filter-for-5e":{"parentClass":"wizard"},"itemacro":{"macro":{"name":"Summon Draconic Spirit","type":"script","scope":"global","command":"/**\n * Item-Macro Macro onCreation for the Summon Draconic Spirit Spell, until now only tested from Control Bar.\n * \n * https://www.dndbeyond.com/spells/summon-fey\n * \n * TODO: clean up logging (pretty much remove, or put all to Tablerules logging with .debug() )\n */\n\nconst macroLabel = item.name;\nconst textureChromatic = \"modules/Tablerules/icons/magic/summons/draconicSpiritChromatic.png\";\nconst textureMetallic = \"modules/Tablerules/icons/magic/summons/draconicSpiritMetallic.png\"\nconst textureGem = \"modules/Tablerules/icons/magic/summons/draconicSpiritGem.png\";\n\nconst formChromatic = \"Chromatic Dragon Spirit\";\nconst formMetallic = \"Metallic Dragon Spirit\";\nconst formGem = \"Gem Dragon Spirit\";\n\nconst scaleChromatic = 1;\nconst scaleMetallic = 1;\nconst scaleGem = 1;\n\n\nconst summonerDc = actor.system.attributes.spelldc;\nconst summonerAttack = summonerDc - 8;\nconst level = await warpgate.dnd5e.rollItem(item);\nif (!level > 0) {\n    return;\n}\n\n\n/* Prompt the user for which type of spirit to summon */\nconst buttonData = {\n    buttons: [{\n        label: formChromatic,\n        value: {\n            token: { name: formChromatic },\n            actor: { name: formChromatic },\n            embedded: {\n                Item: {\n                    \"Breath Weapon - Force\": warpgate.CONST.DELETE,\n                    \"Breath Weapon - Necrotic\": warpgate.CONST.DELETE,\n                    \"Breath Weapon - Psychic\": warpgate.CONST.DELETE,\n                    \"Breath Weapon - Radiant\": warpgate.CONST.DELETE,\n                    \"Breath Weapon - Thunder\": warpgate.CONST.DELETE,\n                    \"Shared Resistances - Force\": warpgate.CONST.DELETE,\n                    \"Shared Resistances - Necrotic\": warpgate.CONST.DELETE,\n                    \"Shared Resistances - Psychic\": warpgate.CONST.DELETE,\n                    \"Shared Resistances - Radiant\": warpgate.CONST.DELETE,\n                    \"Shared Resistances - Thunder\": warpgate.CONST.DELETE\n                }\n            }\n        }\n    },\n    {\n        label: formMetallic,\n        value: {\n            token: { name: formMetallic },\n            actor: { name: formMetallic },\n            embedded: {\n                Item: {\n                    \"Breath Weapon - Force\": warpgate.CONST.DELETE,\n                    \"Breath Weapon - Necrotic\": warpgate.CONST.DELETE,\n                    \"Breath Weapon - Psychic\": warpgate.CONST.DELETE,\n                    \"Breath Weapon - Radiant\": warpgate.CONST.DELETE,\n                    \"Breath Weapon - Thunder\": warpgate.CONST.DELETE,\n                    \"Shared Resistances - Force\": warpgate.CONST.DELETE,\n                    \"Shared Resistances - Necrotic\": warpgate.CONST.DELETE,\n                    \"Shared Resistances - Psychic\": warpgate.CONST.DELETE,\n                    \"Shared Resistances - Radiant\": warpgate.CONST.DELETE,\n                    \"Shared Resistances - Thunder\": warpgate.CONST.DELETE\n                }\n            }\n        }\n    },\n    {\n        label: formGem,\n        value: {\n            actor: { name: formGem },\n            token: { name: formGem },\n            embedded: {\n                Item: {\n                    \"Breath Weapon - Acid\": warpgate.CONST.DELETE,\n                    \"Breath Weapon - Cold\": warpgate.CONST.DELETE,\n                    \"Breath Weapon - Fire\": warpgate.CONST.DELETE,\n                    \"Breath Weapon - Lightning\": warpgate.CONST.DELETE,\n                    \"Breath Weapon - Poison\": warpgate.CONST.DELETE,\n                    \"Shared Resistances - Acid\": warpgate.CONST.DELETE,\n                    \"Shared Resistances - Cold\": warpgate.CONST.DELETE,\n                    \"Shared Resistances - Fire\": warpgate.CONST.DELETE,\n                    \"Shared Resistances - Lightning\": warpgate.CONST.DELETE,\n                    \"Shared Resistances - Poison\": warpgate.CONST.DELETE\n                }\n            }\n        }\n    },\n    ], title: \"Which version?\"\n};\n\nlet spirit = await warpgate.buttonDialog(buttonData);\n\n/* Craft the updates that are common to all spirits */\nlet updates = {\n    token: {\n        \"displayName\": CONST.TOKEN_DISPLAY_MODES.HOVER,\n        \"flags.Tablerules.spellLevel\": level\n    },\n    actor: {\n        'system.attributes.ac.flat': 14 + level,\n        'system.attributes.hp': { value: 50 + 10 * (level - 5), max: 50 + 10 * (level - 5) },\n        \"system.details.cr\": actor.system.attributes.prof,\n        \"system.attributes.prof\": actor.system.attributes.prof,\n        \"flags.world.summoned.item\": item.uuid,\n        \"flags.world.summoned.actor\": actor.uuid\n    },\n    embedded: {\n        Item: {\n            \"Multiattack\": { name: `Multiattack (${Math.floor(level / 2)} attacks)` },\n            \"Rend\": {\n                'system.damage.parts': [[`1d6 + 4 + ${level}`, \"piercing\"]],\n                'system.attackBonus': `- @mod - @prof + ${summonerAttack}`,\n            },\n            \"Breath Weapon - Acid\": {\n                'system.save.dc': summonerDc\n            },\n            \"Breath Weapon - Cold\": {\n                'system.save.dc': summonerDc\n            },\n            \"Breath Weapon - Fire\": {\n                'system.save.dc': summonerDc\n            },\n            \"Breath Weapon - Lightning\": {\n                'system.save.dc': summonerDc\n            },\n            \"Breath Weapon - Poison\": {\n                'system.save.dc': summonerDc\n            },\n            \"Breath Weapon - Force\": {\n                'system.save.dc': summonerDc\n            },\n            \"Breath Weapon - Necrotic\": {\n                'system.save.dc': summonerDc\n            },\n            \"Breath Weapon - Psychic\": {\n                'system.save.dc': summonerDc\n            },\n            \"Breath Weapon - Radiant\": {\n                'system.save.dc': summonerDc\n            },\n            \"Breath Weapon - Thunder\": {\n                'system.save.dc': summonerDc\n            }\n        }\n    }\n}\n\n/* update variants */\nif (spirit.actor.name === formChromatic) {\n    updates[\"actor.img\"] = textureChromatic;\n    updates[\"token.texture.src\"] = textureChromatic;\n    updates[\"token.texture.scaleX\"] = scaleChromatic;\n    updates[\"token.texture.scaleY\"] = scaleChromatic;\n}\n\nif (spirit.actor.name === formMetallic) {\n    updates[\"actor.img\"] = textureMetallic;\n    updates[\"token.texture.src\"] = textureMetallic;\n    updates[\"token.texture.scaleX\"] = scaleMetallic;\n    updates[\"token.texture.scaleY\"] = scaleMetallic;\n}\n\nif (spirit.actor.name === formGem) {\n    updates[\"actor.img\"] = textureGem;\n    updates[\"token.texture.src\"] = textureGem;\n    updates[\"token.texture.scaleX\"] = scaleGem;\n    updates[\"token.texture.scaleY\"] = scaleGem;\n}\n\n/* Combine the general and specific updates */\nupdates = mergeObject(updates, spirit);\n\nconst spawnIds = await warpgate.spawn(\"Draconic Spirit\", updates);\n//const spawn = canvas.tokens.get(spawnIds[0]); // or canvas.scene.tokens.get(id) to get the document immediately","author":"YCF2Heb7DMHDaF2f","_id":null,"img":"icons/svg/dice-target.svg","folder":null,"sort":0,"ownership":{"default":0},"flags":{},"_stats":{"systemId":null,"systemVersion":null,"coreVersion":null,"createdTime":null,"modifiedTime":null,"lastModifiedBy":null}}},"core":{"sourceId":"Actor.Q7hqVwhDhhZq8QEa.Item.44HEUalf19oGgXv4"}},"img":"icons/creatures/reptiles/dragon-horned-blue.webp","effects":[],"ownership":{"default":0,"YCF2Heb7DMHDaF2f":3},"_stats":{"systemId":"dnd5e","systemVersion":"2.1.5","coreVersion":"10.291","createdTime":1678464911483,"modifiedTime":1678716561147,"lastModifiedBy":"YCF2Heb7DMHDaF2f"},"folder":null,"sort":0,"_id":"AEBbHNZIqiU1VFFc"}
{"type":"spell","system":{"description":{"value":"<p>A frigid beam of blue-white light streaks toward a creature within range. Make a ranged spell attack against the target. On a hit, it takes 1d8 cold damage, and its speed is reduced by 10 feet until the start of your next turn.</p>\n<p>The spell's damage increases by 1d8 when you reach 5th level (2d8), 11th level (3d8), and 17th level (4d8).</p>","chat":"","unidentified":""},"source":"Basic Rules, Player's Handbook pg 271","activation":{"type":"action","cost":1,"condition":""},"duration":{"value":null,"units":"inst"},"target":{"value":1,"width":null,"units":"","type":"creature"},"range":{"value":60,"long":null,"units":"ft"},"uses":{"value":null,"max":"","per":"","recovery":""},"consume":{"type":"","target":"","amount":null},"ability":"","actionType":"rsak","attackBonus":"0","chatFlavor":"","critical":{"threshold":null,"damage":""},"damage":{"parts":[["1d8[cold]","cold"]],"versatile":""},"formula":"","save":{"ability":"","dc":null,"scaling":"spell"},"level":0,"school":"evo","components":{"value":"","vocal":true,"somatic":true,"material":false,"ritual":false,"concentration":false},"materials":{"value":"","consumed":false,"cost":0,"supply":0},"preparation":{"mode":"prepared","prepared":false},"scaling":{"mode":"cantrip","formula":"1d8"}},"name":"Ray of Frost","flags":{"ddbimporter":{"id":138634,"definitionId":2226,"entityTypeId":435869154,"dndbeyond":{"lookup":"classSpell","class":"Wizard","level":1,"characterClassId":108474208,"spellLevel":0,"ability":"int","mod":3,"dc":13,"cantripBoost":false,"overrideDC":false,"id":138634,"entityTypeId":435869154,"healingBoost":0,"usesSpellSlot":false},"originalName":"Ray of Frost","sources":[{"sourceId":1,"pageNumber":null,"sourceType":2},{"sourceId":2,"pageNumber":271,"sourceType":1}],"tags":["Damage"],"version":"3.2.4","importId":"EgKCIFc1BkVC5JrI"},"spell-class-filter-for-5e":{"parentClass":"wizard"},"midi-qol":{"fumbleThreshold":null,"effectActivation":false,"forceCEOn":false},"midiProperties":{"nodam":false,"fulldam":false,"halfdam":false,"rollOther":false,"critOther":false,"magicdam":false,"magiceffect":false,"concentration":false,"toggleEffect":false,"ignoreTotalCover":false,"autoFailFriendly":false,"offHandWeapon":false},"core":{"sourceId":"Actor.ZhhF2ZWDPIY2g3KI.Item.Aw0bAaInqHlR7iL6"}},"img":"icons/magic/light/beam-rays-blue-small.webp","effects":[{"label":"Ray of Frost","icon":"icons/magic/light/beam-rays-blue-small.webp","origin":"Actor.6jtmp2Joatnf8PuB.Item.Aw0bAaInqHlR7iL6","duration":{"rounds":1,"startTime":null,"seconds":null,"combat":null,"turns":null,"startRound":null,"startTurn":null},"disabled":false,"_id":"NUt8F9KvRFPPh7UR","changes":[{"key":"system.attributes.movement.walk","mode":2,"value":"-10","priority":20},{"key":"system.attributes.movement.burrow","mode":2,"value":"-10","priority":20},{"key":"system.attributes.movement.climb","mode":2,"value":"-10","priority":20},{"key":"system.attributes.movement.fly","mode":2,"value":"-10","priority":20},{"key":"system.attributes.movement.swim","mode":2,"value":"-10","priority":20}],"tint":null,"transfer":false,"flags":{"effective-transferral":{"transferBlock":{"button":false,"chat":false,"displayCard":false}},"dae":{"selfTarget":false,"selfTargetAlways":false,"stackable":"none","durationExpression":"","macroRepeat":"none","specialDuration":[]},"core":{"statusId":""}}}],"_stats":{"systemId":"dnd5e","systemVersion":"2.0.3","coreVersion":"10.291","createdTime":1669500366049,"modifiedTime":1671041504786,"lastModifiedBy":"npmYF618vZgxA5SD"},"ownership":{"default":0,"npmYF618vZgxA5SD":3},"folder":null,"sort":0,"_id":"AJX3ggZgZlEKg246"}
{"type":"spell","system":{"description":{"value":"<p>You call forth an undead spirit. It manifests in an unoccupied space that you can see within range. This corporeal form uses the Undead Spirit stat block. When you cast the spell, choose the creature’s form: Ghostly, Putrid, or Skeletal. The spirit resembles an undead creature with the chosen form, which determines certain traits in its stat block. The creature disappears when it drops to 0 hit points or when the spell ends.</p>\n<p>The creature is an ally to you and your companions. In combat, the creature shares your initiative count, but it takes its turn immediately after yours. It obeys your verbal commands (no action required by you). If you don’t issue any, it takes the Dodge action and uses its move to avoid danger.</p>\n<p><em><strong>At Higher Levels.</strong></em> When you cast this spell using a spell slot of 4th level or higher, use the higher level wherever the spell’s level appears in the stat block.</p>\n<div class=\"Basic-Text-Frame stat-block-finder stat-block-background\">\n<p class=\"Stat-Block-Styles_Stat-Block-Title\">Undead Spirit</p>\n<p class=\"Stat-Block-Styles_Stat-Block-Metadata\">Medium undead</p>\n<p class=\"Stat-Block-Styles_Stat-Block-Data\"><strong>Armor Class</strong> 11 + the level of the spell (natural armor)</p>\n<p class=\"Stat-Block-Styles_Stat-Block-Data\"><strong>Hit Points</strong> 30 (Ghostly and Putrid only) or 20 (Skeletal only) + 10 for each spell level above 3rd</p>\n<p class=\"Stat-Block-Styles_Stat-Block-Data\"><strong>Speed</strong> 30 ft.; fly 40 ft. (hover) (Ghostly only)</p>\n<div class=\"stat-block-ability-scores\">\n<div class=\"stat-block-ability-scores-stat\">\n<div class=\"stat-block-ability-scores-heading\">STR</div>\n<div class=\"stat-block-ability-scores-data\"><span class=\"stat-block-ability-scores-score\">12</span> <span class=\"stat-block-ability-scores-modifier\">(+1)</span></div>\n</div>\n<div class=\"stat-block-ability-scores-stat\">\n<div class=\"stat-block-ability-scores-heading\">DEX</div>\n<div class=\"stat-block-ability-scores-data\"><span class=\"stat-block-ability-scores-score\">16</span> <span class=\"stat-block-ability-scores-modifier\">(+3)</span></div>\n</div>\n<div class=\"stat-block-ability-scores-stat\">\n<div class=\"stat-block-ability-scores-heading\">CON</div>\n<div class=\"stat-block-ability-scores-data\"><span class=\"stat-block-ability-scores-score\">15</span> <span class=\"stat-block-ability-scores-modifier\">(+2)</span></div>\n</div>\n<div class=\"stat-block-ability-scores-stat\">\n<div class=\"stat-block-ability-scores-heading\">INT</div>\n<div class=\"stat-block-ability-scores-data\"><span class=\"stat-block-ability-scores-score\">4</span> <span class=\"stat-block-ability-scores-modifier\">(−3)</span></div>\n</div>\n<div class=\"stat-block-ability-scores-stat\">\n<div class=\"stat-block-ability-scores-heading\">WIS</div>\n<div class=\"stat-block-ability-scores-data\"><span class=\"stat-block-ability-scores-score\">10</span> <span class=\"stat-block-ability-scores-modifier\">(+0)</span></div>\n</div>\n<div class=\"stat-block-ability-scores-stat\">\n<div class=\"stat-block-ability-scores-heading\">CHA</div>\n<div class=\"stat-block-ability-scores-data\"><span class=\"stat-block-ability-scores-score\">9</span> <span class=\"stat-block-ability-scores-modifier\">(−1)</span></div>\n</div>\n</div>\n<p class=\"Stat-Block-Styles_Stat-Block-Data\"><strong>Damage Immunities </strong>necrotic, poison</p>\n<p class=\"Stat-Block-Styles_Stat-Block-Data\"><strong>Condition Immunities </strong>@Compendium[dnd5e.rules.w7eitkpD7QQTB6j0]{exhaustion}, @Compendium[dnd5e.rules.w7eitkpD7QQTB6j0]{frightened}, @Compendium[dnd5e.rules.w7eitkpD7QQTB6j0]{paralyzed}, @Compendium[dnd5e.rules.w7eitkpD7QQTB6j0]{poisoned}</p>\n<p class=\"Stat-Block-Styles_Stat-Block-Data\"><strong>Senses </strong>@Compendium[dnd5e.rules.eVtpEGXjA2tamEIJ]{darkvision} 60 ft., passive @Compendium[dnd5e.rules.0AGfrwZRzSG0vNKb]{Perception} 10</p>\n<p class=\"Stat-Block-Styles_Stat-Block-Data\"><strong>Languages </strong>understands the languages you speak</p>\n<p class=\"Stat-Block-Styles_Stat-Block-Data-Last\"><strong>Challenge</strong> — <strong>Proficiency Bonus</strong> equals your bonus</p>\n<p class=\"Stat-Block-Styles_Stat-Block-Body\"><em><strong>Festering Aura (Putrid Only).</strong></em> Any creature, other than you, that starts its turn within 5 feet of the spirit must succeed on a Constitution saving throw against your spell save DC or be @Compendium[dnd5e.rules.w7eitkpD7QQTB6j0]{poisoned} until the start of its next turn.</p>\n<p class=\"Stat-Block-Styles_Stat-Block-Body\"><em><strong>Incorporeal Passage (Ghostly Only).</strong></em> The spirit can move through other creatures and objects as if they were difficult terrain. If it ends its turn inside an object, it is shunted to the nearest unoccupied space and takes 1d10 force damage for every 5 feet traveled.</p>\n<p class=\"Stat-Block-Styles_Stat-Block-Heading\">Actions</p>\n<p class=\"Stat-Block-Styles_Stat-Block-Body\"><em><strong>Multiattack.</strong></em> The spirit makes a number of attacks equal to half this spell’s level (rounded down).</p>\n<p class=\"Stat-Block-Styles_Stat-Block-Body\"><em><strong>Deathly Touch (Ghostly Only).</strong></em> <em>Melee Weapon Attack:</em> your spell attack modifier to hit, reach 5 ft., one creature. <em>Hit:</em> 1d8 + 3 + the spell’s level necrotic damage, and the creature must succeed on a Wisdom saving throw against your spell save DC or be @Compendium[dnd5e.rules.w7eitkpD7QQTB6j0]{frightened} of the undead until the end of the target’s next turn.</p>\n<p class=\"Stat-Block-Styles_Stat-Block-Body\"><em><strong>Grave Bolt (Skeletal Only).</strong></em> <em>Ranged Spell Attack:</em> your spell attack modifier to hit, range 150 ft., one target. <em>Hit:</em> 2d4 + 3 + the spell’s level necrotic damage.</p>\n<p class=\"Stat-Block-Styles_Stat-Block-Body\"><em><strong>Rotting Claw (Putrid Only).</strong></em> <em>Melee Weapon Attack:</em> your spell attack modifier to hit, reach 5 ft., one target. <em>Hit:</em> 1d6 + 3 + the spell’s level slashing damage. If the target is @Compendium[dnd5e.rules.w7eitkpD7QQTB6j0]{poisoned}, it must succeed on a Constitution saving throw against your spell save DC or be @Compendium[dnd5e.rules.w7eitkpD7QQTB6j0]{paralyzed} until the end of its next turn.</p>\n</div>","chat":"","unidentified":""},"source":"Tasha’s Cauldron of Everything pg 114","activation":{"type":"action","cost":1,"condition":""},"duration":{"value":"1","units":"hour"},"cover":null,"target":{"value":null,"width":null,"units":"","type":""},"range":{"value":90,"long":null,"units":"ft"},"uses":{"value":null,"max":"","per":"","recovery":""},"consume":{"type":"","target":"","amount":null},"ability":"","actionType":"other","attackBonus":"","chatFlavor":"","critical":{"threshold":null,"damage":""},"damage":{"parts":[],"versatile":""},"formula":"","save":{"ability":"","dc":null,"scaling":"spell"},"level":3,"school":"nec","components":{"vocal":true,"somatic":true,"material":true,"ritual":false,"concentration":true},"materials":{"value":"a gilded skull worth at least 300 gp","consumed":false,"cost":300,"supply":0},"preparation":{"mode":"prepared","prepared":false},"scaling":{"mode":"none","formula":""}},"name":"Summon Undead","flags":{"ddbimporter":{"id":5843250,"definitionId":719951,"entityTypeId":435869154,"dndbeyond":{"lookup":"classSpell","class":"Wizard","level":20,"characterClassId":128250765,"spellLevel":3,"ability":"int","mod":5,"dc":19,"cantripBoost":false,"overrideDC":false,"id":5843250,"entityTypeId":435869154,"healingBoost":0,"usesSpellSlot":true},"originalName":"Summon Undead","sources":[{"sourceId":67,"pageNumber":114,"sourceType":1}],"tags":["Summoning"],"version":"3.3.16","importId":"2SMktUT3UBtnkWqF"},"midiProperties":{"magicdam":true,"magiceffect":true},"spell-class-filter-for-5e":{"parentClass":"wizard"},"itemacro":{"macro":{"name":"Summon Undead","type":"script","scope":"global","command":"/**\n * Item-Macro Macro.\n * \n * https://www.dndbeyond.com/spells/summon-undead\n */\n\nconst macroLabel = item.name;\nconst textureGhostly = \"systems/dnd5e/tokens/undead/Ghost.webp\";\nconst texturePutrid = \"systems/dnd5e/tokens/undead/Ghast.webp\";\nconst textureSkeletal = \"modules/Tablerules/icons/magic/summons/undeadSpiritSkeleton.png\";\n\n// labels for easy customization and quick testing what works for unclear cases.\nconst formGhostly = \"Ghostly Spirit\";\nconst formPutrid = \"Putrid Spirit\";\nconst formSkeletal = \"Skeletal Spirit\";\n\nconst level = await warpgate.dnd5e.rollItem(item);\nconst summonerDc = actor.system.attributes.spelldc;\nconst summonerAttack = summonerDc - 8;\n\nif (!level > 0) {\n    ui.notifications.error(`${macroLabel}, !level>0, check console error.`);\n    console.error({ message: `${macroLabel}, !level>0`, arguments: arguments });\n    return;\n}\n\n/* Prompt the user for which type of spirit to summon */\nconst buttonData = {\n    buttons: [{\n        label: formGhostly,\n        value: {\n            token: { name: formGhostly },\n            actor: { name: formGhostly },\n            embedded: {\n                Item: {\n                    \"Grave Bolt\": warpgate.CONST.DELETE,\n                    \"Rotting Claw\": warpgate.CONST.DELETE,\n                    \"Festering Aura\": warpgate.CONST.DELETE\n                }\n            }\n        }\n    }, {\n        label: formPutrid,\n        value: {\n            actor: { name: formPutrid },\n            token: { name: formPutrid },\n            embedded: {\n                Item: {\n                    \"Deathly Touch\": warpgate.CONST.DELETE,\n                    \"Grave Bolt\": warpgate.CONST.DELETE\n                }\n            }\n        }\n    }, {\n        label: formSkeletal,\n        value: {\n            actor: { name: formSkeletal },\n            token: { name: formSkeletal },\n            embedded: {\n                Item: {\n                    \"Deathly Touch\": warpgate.CONST.DELETE,\n                    \"Rotting Claw\": warpgate.CONST.DELETE,\n                    \"Festering Aura\": warpgate.CONST.DELETE\n                }\n            }\n        }\n    }\n    ], title: \"Which version?\"\n};\n\nlet spirit = await warpgate.buttonDialog(buttonData);\n\n/* Craft the updates that are common to all spirits */\nlet updates = {\n    token: {\n        \"displayName\": CONST.TOKEN_DISPLAY_MODES.HOVER,\n        \"flags.Tablerules.spellLevel\": level\n    },\n    actor: {\n        'system.attributes.ac.flat': 11 + level,\n        'system.attributes.hp': { value: 30 + 10 * (level - 3), max: 30 + 10 * (level - 3) },\n        \"system.details.cr\": actor.system.attributes.prof,\n        \"system.attributes.prof\": actor.system.attributes.prof,\n        \"flags.world.summoned.item\": item.uuid,\n        \"flags.world.summoned.actor\": actor.uuid\n    },\n    embedded: {\n        Item: {\n            \"Multiattack\": { name: `Multiattack (${Math.floor(level / 2)} attacks)` },\n            \"Deathly Touch\": {\n                'system.damage.parts': [[`1d8 + 3 + ${level}`, \"necrotic\"]],\n                'system.attackBonus': `- @mod - @prof + ${summonerAttack}`,\n                \"system.save.dc\": summonerDc\n            },\n            \"Grave Bolt\": {\n                'system.damage.parts': [[`2d4 + 3 + ${level}`, \"necrotic\"]],\n                'system.attackBonus': `- @mod - @prof + ${summonerAttack}`,\n            },\n            \"Rotting Claw\": {\n                'system.damage.parts': [[`1d6 + 3 + ${level}`, \"slashing\"]],\n                'system.attackBonus': `- @mod - @prof + ${summonerAttack}`,\n            },\n            \"Festering Aura\": {\n                \"system.save.dc\": summonerDc\n            }\n        }\n    }\n}\n\n/* update variants */\nif (spirit.actor.name === formGhostly) {\n    updates[\"actor.img\"] = textureGhostly;\n    updates[\"token.texture.src\"] = textureGhostly;\n    updates[\"actor.system.attributes.movement.fly\"] = 40;\n    updates[\"actor.system.attributes.movement.hover\"] = true;\n}\n\nif (spirit.actor.name === formPutrid) {\n    updates[\"actor.img\"] = texturePutrid;\n    updates[\"token.texture.src\"] = texturePutrid;\n}\n\nif (spirit.actor.name === formSkeletal) {\n    updates[\"actor.img\"] = textureSkeletal;\n    updates[\"token.texture.src\"] = textureSkeletal;\n    updates['actor.system.attributes.hp'] = { value: 20 + 10 * (level - 3), max: 20 + 10 * (level - 3) };\n}\n\n/* Combine the general and specific updates */\nupdates = mergeObject(updates, spirit);\n\nconst spawnIds = await warpgate.spawn(\"Undead Spirit\", updates);\n\n//const spawn = canvas.tokens.get(spawnIds[0]); // or canvas.scene.tokens.get(id) to get the document immediately for further changes like animations.\n\nif (spirit.actor.name === formPutrid) {\n    const token = canvas.tokens.get(spawnIds[0]);\n    // create and attach MeasuredTemplate\n    const data = {\n        distance: 7.5,\n        borderColor: \"#52004b\",\n        fillColor: \"#940088\",\n        x: token.center.x,\n        y: token.center.y\n    };\n    foundry.utils.setProperty(data, \"flags.dnd5e.origin\", item.uuid);\n    await canvas.scene.createEmbeddedDocuments(\"MeasuredTemplate\", [data]);\n\n    const template = canvas.scene.templates.find(t => t.flags?.dnd5e?.origin === item.uuid);\n    await tokenAttacher.attachElementsToToken([template], token);\n}","author":"YCF2Heb7DMHDaF2f","_id":null,"img":"icons/svg/dice-target.svg","folder":null,"sort":0,"ownership":{"default":0},"flags":{},"_stats":{"systemId":null,"systemVersion":null,"coreVersion":null,"createdTime":null,"modifiedTime":null,"lastModifiedBy":null}}},"core":{"sourceId":"Actor.Q7hqVwhDhhZq8QEa.Item.mifD1GjUBGCdX4ZC"}},"img":"icons/magic/death/undead-skeleton-deformed-red.webp","effects":[],"ownership":{"default":0,"YCF2Heb7DMHDaF2f":3},"_stats":{"systemId":"dnd5e","systemVersion":"2.1.5","coreVersion":"10.291","createdTime":1678464911490,"modifiedTime":1678716543079,"lastModifiedBy":"YCF2Heb7DMHDaF2f"},"folder":null,"sort":0,"_id":"C26Z5gofh0MxUSU6"}
{"type":"spell","system":{"description":{"value":"<p>An @Compendium[dnd5e.rules.w7eitkpD7QQTB6j0]{invisible} barrier of magical force appears and protects you. Until the start of your next turn, you have a +5 bonus to AC, including against the triggering attack, and you take no damage from <strong>magic missile</strong>.</p>","chat":"","unidentified":""},"source":"Basic Rules, Player's Handbook pg 275","activation":{"type":"reaction","cost":1,"condition":"which you take when you are hit by an attack or targeted by the magic missile spell"},"duration":{"value":"1","units":"round"},"cover":null,"target":{"value":null,"width":null,"units":"","type":"self"},"range":{"value":null,"long":null,"units":"self"},"uses":{"value":null,"max":"","per":"","recovery":""},"consume":{"type":"","target":"","amount":null},"ability":"","actionType":"other","attackBonus":"","chatFlavor":"","critical":{"threshold":null,"damage":""},"damage":{"parts":[],"versatile":""},"formula":"","save":{"ability":"","dc":null,"scaling":"spell"},"level":1,"school":"abj","components":{"vocal":true,"somatic":true,"material":false,"ritual":false,"concentration":false},"materials":{"value":"","consumed":false,"cost":0,"supply":0},"preparation":{"mode":"prepared","prepared":true},"scaling":{"mode":"none","formula":""}},"name":"Shield (Water Theme)","flags":{"ddbimporter":{"id":138703,"definitionId":2247,"entityTypeId":435869154,"dndbeyond":{"lookup":"classSpell","class":"Wizard","level":3,"characterClassId":108474208,"spellLevel":1,"ability":"int","mod":3,"dc":13,"cantripBoost":false,"overrideDC":false,"id":138703,"entityTypeId":435869154,"healingBoost":0,"usesSpellSlot":true},"originalName":"Shield","sources":[{"sourceId":1,"pageNumber":null,"sourceType":2},{"sourceId":2,"pageNumber":275,"sourceType":1}],"tags":["Warding"],"version":"3.2.7","importId":"zviDp4XHAwjSNQBR"},"spell-class-filter-for-5e":{"parentClass":"wizard"},"midi-qol":{"effectActivation":false,"forceCEOn":false},"midiProperties":{"nodam":false,"fulldam":false,"halfdam":false,"autoFailFriendly":false,"rollOther":false,"critOther":false,"offHandWeapon":false,"magicdam":false,"magiceffect":false,"concentration":false,"toggleEffect":false,"ignoreTotalCover":false},"core":{"sourceId":"Actor.6jtmp2Joatnf8PuB.Item.IMtL5XRHVBIy981T"}},"img":"icons/magic/defensive/shield-barrier-glowing-triangle-magenta.webp","effects":[{"label":"Shield (Water Theme)","icon":"icons/magic/defensive/shield-barrier-glowing-triangle-magenta.webp","origin":"Actor.6jtmp2Joatnf8PuB.Item.IMtL5XRHVBIy981T","duration":{"rounds":null,"startTime":null,"seconds":null,"combat":null,"turns":null,"startRound":null,"startTurn":null},"disabled":false,"_id":"f2BRdkNkOycdA71j","changes":[{"key":"system.attributes.ac.bonus","mode":2,"value":"+5","priority":20}],"tint":null,"transfer":false,"flags":{"effectmacro":{"onCreate":{"script":"let params =\n[{\n    filterType: \"field\",\n    filterId: \"myWaterShield\",\n    shieldType: 9,\n    gridPadding: 1.2,\n    color: 0x20BBEE,\n    time: 0,\n    blend: 4,\n    intensity: 1,\n    lightAlpha: 0.7,\n    lightSize: 0.5,\n    scale: 0.6,\n    radius: 0.5,\n    chromatic: false,\n    animated :\n    {\n      time : \n      { \n        active: true, \n        speed: 0.0015, \n        animType: \"move\" \n      }\n    }\n}];\n\nawait TokenMagic.addUpdateFiltersOnSelected(params);"},"onDelete":{"script":"await TokenMagic.deleteFilters(token, \"myWaterShield\");"}},"effective-transferral":{"transferBlock":{"button":false,"chat":false,"displayCard":false},"transferrable":{"self":true,"target":true,"always":false}},"dae":{"selfTarget":false,"selfTargetAlways":false,"stackable":"none","durationExpression":"","macroRepeat":"none","specialDuration":["turnStart"]},"core":{"statusId":""},"dfreds-convenient-effects":{"description":""}}}],"_stats":{"systemId":"dnd5e","systemVersion":"2.1.5","coreVersion":"10.291","createdTime":1670549196605,"modifiedTime":1678951962611,"lastModifiedBy":"YCF2Heb7DMHDaF2f"},"ownership":{"default":0,"npmYF618vZgxA5SD":3,"YCF2Heb7DMHDaF2f":3},"folder":null,"sort":0,"_id":"Ez3aGLpbCHaCTgBn"}
{"type":"spell","system":{"description":{"value":"<p>Up to three creatures of your choice that you can see within range must make Charisma saving throws. Whenever a target that fails this saving throw makes an attack roll or a saving throw before the spell ends, the target must roll a d4 and subtract the number rolled from the attack roll or saving throw.</p>\n<p><strong>At Higher Levels.</strong> When you cast this spell using a spell slot of 2nd level or higher, you can target one additional creature for each slot level above 1st.</p>","chat":"","unidentified":""},"source":"Basic Rules, Player's Handbook pg 216","activation":{"type":"action","cost":1,"condition":""},"duration":{"value":1,"units":"minute"},"target":{"value":3,"width":null,"units":"","type":"creature"},"range":{"value":30,"long":null,"units":"ft"},"uses":{"value":null,"max":"","per":"","recovery":""},"consume":{"type":"","target":"","amount":null},"ability":"wis","actionType":"save","attackBonus":0,"chatFlavor":"","critical":{"threshold":null,"damage":""},"damage":{"parts":[],"versatile":""},"formula":"","save":{"ability":"cha","dc":null,"scaling":"wis"},"level":1,"school":"enc","components":{"value":"a drop of blood","vocal":true,"somatic":true,"material":true,"ritual":false,"concentration":true},"materials":{"value":"a drop of blood","consumed":false,"cost":0,"supply":0},"preparation":{"mode":"prepared","prepared":false},"scaling":{"mode":"none","formula":""}},"name":"Bane","flags":{"ddbimporter":{"id":136081,"definitionId":2009,"entityTypeId":435869154,"dndbeyond":{"lookup":"classSpell","class":"Cleric","level":1,"characterClassId":118182112,"spellLevel":1,"ability":"wis","mod":2,"dc":12,"cantripBoost":false,"overrideDC":false,"id":136081,"entityTypeId":435869154,"healingBoost":2,"usesSpellSlot":true},"originalName":"Bane","sources":[{"sourceId":1,"pageNumber":null,"sourceType":2},{"sourceId":2,"pageNumber":216,"sourceType":1}],"tags":["Debuff"],"version":"3.2.4","importId":"XpwygIbTgqS9zbhX"},"spell-class-filter-for-5e":{"parentClass":"cleric"},"midi-qol":{"effectActivation":false,"forceCEOn":false},"midiProperties":{"nodam":false,"fulldam":false,"halfdam":false,"rollOther":false,"critOther":false,"magicdam":false,"magiceffect":false,"concentration":false,"toggleEffect":false,"ignoreTotalCover":false},"core":{"sourceId":"Actor.jItLUReNSJ6NAwL3.Item.yF1aBXH1BQyoF0rW"}},"img":"icons/magic/unholy/strike-beam-blood-red-purple.webp","effects":[{"label":"Bane","icon":"icons/magic/unholy/strike-beam-blood-red-purple.webp","origin":"Actor.3IDJAqCn3WKSy8xf.Item.yF1aBXH1BQyoF0rW","duration":{"seconds":60,"startTime":null,"combat":null,"rounds":null,"turns":null,"startRound":null,"startTurn":null},"disabled":false,"_id":"ZM538EnHCYsXD3W4","changes":[{"key":"system.bonuses.All-Attacks","mode":2,"value":"-1d4","priority":20},{"key":"system.bonuses.abilities.save","mode":2,"value":"-1d4","priority":20}],"tint":null,"transfer":false,"flags":{"effective-transferral":{"transferBlock":{"button":false,"chat":false,"displayCard":false}},"dae":{"selfTarget":false,"selfTargetAlways":false,"stackable":"none","durationExpression":"","macroRepeat":"none","specialDuration":[]},"core":{"statusId":""}}}],"_stats":{"systemId":"dnd5e","systemVersion":"2.0.3","coreVersion":"10.291","createdTime":1669694313366,"modifiedTime":1671041490248,"lastModifiedBy":"npmYF618vZgxA5SD"},"ownership":{"default":0,"npmYF618vZgxA5SD":3},"folder":null,"sort":0,"_id":"GfLc8kZzS5w1448a"}
{"type":"spell","system":{"description":{"value":"<p>You touch one willing creature. Once before the spell ends, the target can roll a d4 and add the number rolled to one ability check of its choice. It can roll the die before or after making the ability check. The spell then ends.</p>","chat":"","unidentified":""},"source":"Basic Rules, Player's Handbook pg 248","activation":{"type":"action","cost":1,"condition":""},"duration":{"value":1,"units":"minute"},"target":{"value":1,"width":null,"units":"","type":"creature"},"range":{"value":10,"long":null,"units":"ft"},"uses":{"value":null,"max":"","per":"","recovery":""},"consume":{"type":"","target":"","amount":null},"ability":"","actionType":"util","attackBonus":0,"chatFlavor":"","critical":{"threshold":null,"damage":""},"damage":{"parts":[],"versatile":""},"formula":"1d4","save":{"ability":"","dc":null,"scaling":"spell"},"level":0,"school":"div","components":{"value":"","vocal":true,"somatic":true,"material":false,"ritual":false,"concentration":true},"materials":{"value":"","consumed":false,"cost":0,"supply":0},"preparation":{"mode":"prepared","prepared":false},"scaling":{"mode":"none","formula":""}},"name":"Guidance","flags":{"ddbimporter":{"id":2415266,"definitionId":2132,"entityTypeId":420821570,"dndbeyond":{"lookup":"feat","lookupName":"Strixhaven Initiate (Quandrix - Charisma)","lookupId":804983,"level":null,"ability":"cha","mod":3,"dc":13,"overrideDC":false,"id":2415266,"entityTypeId":420821570,"healingBoost":0,"usesSpellSlot":false},"originalName":"Guidance","sources":[{"sourceId":1,"pageNumber":null,"sourceType":2},{"sourceId":2,"pageNumber":248,"sourceType":1}],"tags":["Buff"],"version":"3.2.4","importId":"fbvS33ZV7suCX06g"},"midi-qol":{"effectActivation":false,"forceCEOn":false},"midiProperties":{"nodam":false,"fulldam":false,"halfdam":false,"rollOther":false,"critOther":false,"magicdam":false,"magiceffect":false,"concentration":false,"toggleEffect":false,"ignoreTotalCover":false,"autoFailFriendly":false,"offHandWeapon":false},"core":{"sourceId":"Actor.veOJg27EGlME2eld.Item.xKoc4njpm29ygQdm"}},"img":"icons/magic/control/buff-flight-wings-blue.webp","effects":[],"_stats":{"systemId":"dnd5e","systemVersion":"2.0.3","coreVersion":"10.291","createdTime":1669692601341,"modifiedTime":1671041499366,"lastModifiedBy":"npmYF618vZgxA5SD"},"ownership":{"default":0,"npmYF618vZgxA5SD":3},"folder":null,"sort":0,"_id":"Jc2RSASCKKbJe9WN"}
{"type":"spell","system":{"description":{"value":"<p>You call forth a fey spirit. It manifests in an unoccupied space that you can see within range. This corporeal form uses the Fey Spirit stat block. When you cast the spell, choose a mood: Fuming, Mirthful, or Tricksy. The creature resembles a fey creature of your choice marked by the chosen mood, which determines one of the traits in its stat block. The creature disappears when it drops to 0 hit points or when the spell ends.</p>\n<p>The creature is an ally to you and your companions. In combat, the creature shares your initiative count, but it takes its turn immediately after yours. It obeys your verbal commands (no action required by you). If you don’t issue any, it takes the Dodge action and uses its move to avoid danger.</p>\n<p><em><strong>At Higher Levels.</strong></em> When you cast this spell using a spell slot of 4th level or higher, use the higher level wherever the spell’s level appears in the stat block.</p>\n<div class=\"Basic-Text-Frame stat-block-finder\">\n<p class=\"Stat-Block-Styles_Stat-Block-Title\">Fey Spirit</p>\n<p class=\"Stat-Block-Styles_Stat-Block-Metadata\">Small fey</p>\n<p class=\"Stat-Block-Styles_Stat-Block-Data\"><strong>Armor Class</strong> 12 + the level of the spell (natural armor)</p>\n<p class=\"Stat-Block-Styles_Stat-Block-Data\"><strong>Hit Points</strong> 30 + 10 for each spell level above 3rd</p>\n<p class=\"Stat-Block-Styles_Stat-Block-Data\"><strong>Speed</strong> 40 ft.</p>\n<div class=\"stat-block-ability-scores\">\n<div class=\"stat-block-ability-scores-stat\">\n<div class=\"stat-block-ability-scores-heading\">STR</div>\n<div class=\"stat-block-ability-scores-data\"><span class=\"stat-block-ability-scores-score\">13</span><span class=\"stat-block-ability-scores-modifier\">(+1)</span></div>\n</div>\n<div class=\"stat-block-ability-scores-stat\">\n<div class=\"stat-block-ability-scores-heading\">DEX</div>\n<div class=\"stat-block-ability-scores-data\"><span class=\"stat-block-ability-scores-score\">16</span><span class=\"stat-block-ability-scores-modifier\">(+3)</span></div>\n</div>\n<div class=\"stat-block-ability-scores-stat\">\n<div class=\"stat-block-ability-scores-heading\">CON</div>\n<div class=\"stat-block-ability-scores-data\"><span class=\"stat-block-ability-scores-score\">14</span><span class=\"stat-block-ability-scores-modifier\">(+2)</span></div>\n</div>\n<div class=\"stat-block-ability-scores-stat\">\n<div class=\"stat-block-ability-scores-heading\">INT</div>\n<div class=\"stat-block-ability-scores-data\"><span class=\"stat-block-ability-scores-score\">14</span><span class=\"stat-block-ability-scores-modifier\">(+2)</span></div>\n</div>\n<div class=\"stat-block-ability-scores-stat\">\n<div class=\"stat-block-ability-scores-heading\">WIS</div>\n<div class=\"stat-block-ability-scores-data\"><span class=\"stat-block-ability-scores-score\">11</span><span class=\"stat-block-ability-scores-modifier\">(+0)</span></div>\n</div>\n<div class=\"stat-block-ability-scores-stat\">\n<div class=\"stat-block-ability-scores-heading\">CHA</div>\n<div class=\"stat-block-ability-scores-data\"><span class=\"stat-block-ability-scores-score\">16</span><span class=\"stat-block-ability-scores-modifier\">(+3)</span></div>\n</div>\n</div>\n<p class=\"Stat-Block-Styles_Stat-Block-Data\"><strong>Condition Immunities</strong> @Compendium[dnd5e.rules.w7eitkpD7QQTB6j0]{charmed}</p>\n<p class=\"Stat-Block-Styles_Stat-Block-Data\"><strong>Senses</strong> @Compendium[dnd5e.rules.eVtpEGXjA2tamEIJ]{darkvision} 60 ft., passive @Compendium[dnd5e.rules.0AGfrwZRzSG0vNKb]{Perception} 10</p>\n<p class=\"Stat-Block-Styles_Stat-Block-Data\"><strong>Languages</strong> Sylvan, understands the languages you speak</p>\n<p class=\"Stat-Block-Styles_Stat-Block-Data-Last\"><strong>Challenge</strong> — <strong>Proficiency Bonus</strong> equals your bonus</p>\n<p class=\"Stat-Block-Styles_Stat-Block-Heading\">Actions</p>\n<p class=\"Stat-Block-Styles_Stat-Block-Body\"><em><strong>Multiattack.</strong></em> The fey makes a number of attacks equal to half this spell’s level (rounded down).</p>\n<p class=\"Stat-Block-Styles_Stat-Block-Body\"><em><strong>Shortsword.</strong> Melee Weapon Attack:</em> your spell attack modifier to hit, reach 5 ft., one target. <em>Hit:</em> 1d6 + 3 + the spell’s level piercing damage + 1d6 force damage.</p>\n<p class=\"Stat-Block-Styles_Stat-Block-Heading\">Bonus Actions</p>\n<p class=\"Stat-Block-Styles_Stat-Block-Body\"><em><strong>Fey Step.</strong></em> The fey magically teleports up to 30 feet to an unoccupied space it can see. Then one of the following effects occurs, based on the fey’s chosen mood:</p>\n<p class=\"Stat-Block-Styles_Stat-Block-Body\"><strong>Fuming.</strong> The fey has advantage on the next attack roll it makes before the end of this turn.</p>\n<p class=\"Stat-Block-Styles_Stat-Block-Body\"><strong>Mirthful.</strong> The fey can force one creature it can see within 10 feet of it to make a Wisdom saving throw against your spell save DC. Unless the save succeeds, the target is @Compendium[dnd5e.rules.w7eitkpD7QQTB6j0]{charmed} by you and the fey for 1 minute or until the target takes any damage.</p>\n<p class=\"Stat-Block-Styles_Stat-Block-Body\"><strong>Tricksy.</strong> The fey can fill a 5-foot cube within 5 feet of it with magical darkness, which lasts until the end of its next turn.</p>\n</div>","chat":"","unidentified":""},"source":"Tasha’s Cauldron of Everything pg 112","activation":{"type":"action","cost":1,"condition":""},"duration":{"value":"1","units":"hour"},"cover":null,"target":{"value":1,"width":null,"units":"","type":"creature"},"range":{"value":90,"long":null,"units":"ft"},"uses":{"value":null,"max":"","per":"","recovery":""},"consume":{"type":"","target":"","amount":null},"ability":"","actionType":"other","attackBonus":"","chatFlavor":"","critical":{"threshold":null,"damage":""},"damage":{"parts":[],"versatile":""},"formula":"","save":{"ability":"","dc":null,"scaling":"spell"},"level":3,"school":"con","components":{"vocal":true,"somatic":true,"material":true,"ritual":false,"concentration":true},"materials":{"value":"a gilded flower worth at least 300 gp","consumed":false,"cost":300,"supply":0},"preparation":{"mode":"prepared","prepared":true},"scaling":{"mode":"none","formula":""}},"name":"Summon Fey","flags":{"ddbimporter":{"id":5855036,"definitionId":721204,"entityTypeId":435869154,"dndbeyond":{"lookup":"classSpell","class":"Druid","level":9,"characterClassId":103206845,"spellLevel":3,"ability":"wis","mod":3,"dc":15,"cantripBoost":false,"overrideDC":false,"id":5855036,"entityTypeId":435869154,"healingBoost":0,"usesSpellSlot":true},"originalName":"Summon Fey","sources":[{"sourceId":67,"pageNumber":112,"sourceType":1}],"tags":["Summoning"],"version":"3.3.16","importId":"c6ACMHKWqSp4dKCp"},"midiProperties":{"magicdam":true,"magiceffect":true},"spell-class-filter-for-5e":{"parentClass":"druid"},"itemacro":{"macro":{"name":"Summon Fey","type":"script","scope":"global","command":"/**\n * Item-Macro Macro onCreation for the Summon Fey Spell, until now only tested from Control Bar.\n * \n * https://www.dndbeyond.com/spells/summon-fey\n * \n * TODO: clean up logging (pretty much remove, or put all to Tablerules logging with .debug() )\n */\n\nconst macroLabel = item.name;\nconst textureFuming = \"modules/Tablerules/icons/magic/summons/feySpiritFuming.png\";\nconst textureMirthful = \"modules/Tablerules/icons/magic/summons/feySpiritMirthful.png\";\nconst textureTricksy = \"modules/Tablerules/icons/magic/summons/feySpiritTricksy.png\";\n\nconst formFuming = \"Fuming Fey Spirit\";\nconst formMirthful = \"Mirthful Fey Spirit\";\nconst formTricksy = \"Tricksy Fey Spirit\";\n\nconst scaleFuming = 1;\nconst scaleMirthful = 1.3;\nconst scaleTricksy = 1.3;\n\n\nconst summonerDc = actor.system.attributes.spelldc;\nconst summonerAttack = summonerDc - 8;\nconst level = await warpgate.dnd5e.rollItem(item);\nif (!level > 0) {\n    return;\n}\n\n\n/* Prompt the user for which type of spirit to summon */\nconst buttonData = {\n    buttons: [{\n        label: formFuming,\n        value: {\n            token: { name: formFuming },\n            actor: { name: formFuming },\n            embedded: {\n                Item: {\n                    \"Mirthful\": warpgate.CONST.DELETE,\n                    \"Tricksy\": warpgate.CONST.DELETE,\n                    \"Tricksy spell\": warpgate.CONST.DELETE\n                }\n            }\n        }\n    }, {\n        label: formMirthful,\n        value: {\n            actor: { name: formMirthful },\n            token: { name: formMirthful },\n            embedded: {\n                Item: {\n                    \"Fuming\": warpgate.CONST.DELETE,\n                    \"Tricksy\": warpgate.CONST.DELETE,\n                    \"Tricksy spell\": warpgate.CONST.DELETE\n                }\n            }\n        }\n    }, {\n        label: formTricksy,\n        value: {\n            actor: { name: formTricksy },\n            token: { name: formTricksy },\n            embedded: {\n                Item: {\n                    \"Fuming\": warpgate.CONST.DELETE,\n                    \"Mirthful\": warpgate.CONST.DELETE\n                }\n            }\n        }\n    }\n    ], title: \"Which version?\"\n};\n\nlet spirit = await warpgate.buttonDialog(buttonData);\n\n/* Craft the updates that are common to all spirits */\nlet updates = {\n    token: {\n        \"displayName\": CONST.TOKEN_DISPLAY_MODES.HOVER,\n        \"flags.Tablerules.spellLevel\": level\n    },\n    actor: {\n        'system.attributes.ac.flat': 12 + level,\n        'system.attributes.hp': { value: 30 + 10 * (level - 3), max: 30 + 10 * (level - 3) },\n        \"system.details.cr\": actor.system.attributes.prof,\n        \"system.attributes.prof\": actor.system.attributes.prof,\n        \"flags.world.summoned.item\": item.uuid,\n        \"flags.world.summoned.actor\": actor.uuid\n    },\n    embedded: {\n        Item: {\n            \"Multiattack\": { name: `Multiattack (${Math.floor(level / 2)} attacks)` },\n            \"Shortsword\": {\n                'system.damage.parts': [[`1d6 + 3 + ${level}`, \"piercing\"], [`1d6`, \"force\"]],\n                'system.attackBonus': `- @mod - @prof + ${summonerAttack}`,\n            },\n            \"Mirthful\": {\n                'system.save.dc': summonerDc\n            }\n        }\n    }\n}\n\n/* update variants */\nif (spirit.actor.name === formFuming) {\n    updates[\"actor.img\"] = textureFuming;\n    updates[\"token.texture.src\"] = textureFuming;\n    updates[\"token.texture.scaleX\"] = scaleFuming;\n    updates[\"token.texture.scaleY\"] = scaleFuming;\n}\n\nif (spirit.actor.name === formMirthful) {\n    updates[\"actor.img\"] = textureMirthful;\n    updates[\"token.texture.src\"] = textureMirthful;\n    updates[\"token.texture.scaleX\"] = scaleMirthful;\n    updates[\"token.texture.scaleY\"] = scaleMirthful;\n}\n\nif (spirit.actor.name === formTricksy) {\n    updates[\"actor.img\"] = textureTricksy;\n    updates[\"token.texture.src\"] = textureTricksy;\n    updates[\"token.texture.scaleX\"] = scaleTricksy;\n    updates[\"token.texture.scaleY\"] = scaleTricksy;\n}\n\n/* Combine the general and specific updates */\nupdates = mergeObject(updates, spirit);\n\nconst spawnIds = await warpgate.spawn(\"Fey Spirit\", updates);\n//const spawn = canvas.tokens.get(spawnIds[0]); // or canvas.scene.tokens.get(id) to get the document immediately","author":"YCF2Heb7DMHDaF2f","_id":null,"img":"icons/svg/dice-target.svg","folder":null,"sort":0,"ownership":{"default":0},"flags":{},"_stats":{"systemId":null,"systemVersion":null,"coreVersion":null,"createdTime":null,"modifiedTime":null,"lastModifiedBy":null}}},"core":{"sourceId":"Actor.PUn1W4QHh3iEit8l.Item.T9JpKWS0qAtXQmPQ"}},"img":"icons/creatures/mammals/elk-moose-marked-green.webp","effects":[],"ownership":{"default":0,"YCF2Heb7DMHDaF2f":3,"npmYF618vZgxA5SD":3,"cXa5UHu8mk9ndH95":3},"_stats":{"systemId":"dnd5e","systemVersion":"2.1.5","coreVersion":"10.291","createdTime":1678574818932,"modifiedTime":1678716540291,"lastModifiedBy":"YCF2Heb7DMHDaF2f"},"folder":null,"sort":0,"_id":"KvPWkjGvUoFFYr72"}
{"type":"spell","system":{"description":{"value":"<p>You touch one object that is no larger than 10 feet in any dimension. Until the spell ends, the object sheds bright light in a 20-foot radius and dim light for an additional 20 feet. The light can be colored as you like. Completely covering the object with something opaque blocks the light. The spell ends if you cast it again or dismiss it as an action.</p>\n<p>If you target an object held or worn by a hostile creature, that creature must succeed on a Dexterity saving throw to avoid the spell.</p>","chat":"","unidentified":""},"source":"Basic Rules, Player's Handbook pg 255","activation":{"type":"action","cost":1,"condition":""},"duration":{"value":1,"units":"hour"},"target":{"value":1,"width":null,"units":"","type":"object"},"range":{"value":null,"long":null,"units":"touch"},"uses":{"value":null,"max":"","per":"","recovery":""},"consume":{"type":"","target":"","amount":null},"ability":"","actionType":"save","attackBonus":0,"chatFlavor":"","critical":{"threshold":null,"damage":""},"damage":{"parts":[],"versatile":""},"formula":"","save":{"ability":"dex","dc":null,"scaling":"spell"},"level":0,"school":"evo","components":{"value":"a firefly or phosphorescent moss","vocal":true,"somatic":false,"material":true,"ritual":false,"concentration":false},"materials":{"value":"a firefly or phosphorescent moss","consumed":false,"cost":0,"supply":0},"preparation":{"mode":"prepared","prepared":false},"scaling":{"mode":"none","formula":""}},"name":"Light","flags":{"ddbimporter":{"id":138400,"definitionId":2166,"entityTypeId":435869154,"dndbeyond":{"lookup":"classSpell","class":"Cleric","level":10,"characterClassId":116804531,"spellLevel":0,"ability":"wis","mod":3,"dc":15,"cantripBoost":false,"overrideDC":false,"id":138400,"entityTypeId":435869154,"healingBoost":0,"usesSpellSlot":false},"originalName":"Light","sources":[{"sourceId":1,"pageNumber":null,"sourceType":2},{"sourceId":2,"pageNumber":255,"sourceType":1}],"tags":["Creation","Utility"],"version":"3.2.4","importId":"HK5s4atPMmweQr7v"},"spell-class-filter-for-5e":{"parentClass":"cleric"},"midi-qol":{"effectActivation":false,"forceCEOn":false},"midiProperties":{"nodam":false,"fulldam":false,"halfdam":false,"rollOther":false,"critOther":false,"magicdam":false,"magiceffect":false,"concentration":false,"toggleEffect":false,"ignoreTotalCover":false},"core":{"sourceId":"Actor.eRdyUWBs84M14oVO.Item.wjt32goECZH1NqG8"}},"img":"icons/magic/light/explosion-star-small-blue-yellow.webp","effects":[{"label":"Light","icon":"icons/magic/light/explosion-star-small-blue-yellow.webp","origin":"Actor.eRdyUWBs84M14oVO.Item.wjt32goECZH1NqG8","duration":{"seconds":3600,"startTime":null,"combat":null,"rounds":null,"turns":null,"startRound":null,"startTurn":null},"disabled":false,"_id":"1FjJV4OUtsky1Bad","changes":[],"tint":null,"transfer":false,"flags":{"effectmacro":{"onCreate":{"script":"// icon suggestion: icons/sundries/lights/torch-brown-lit.webp\nconst dim_range = 20;\nconst bright_range = 10;\nif (token.data.light.dim === 0) {\n    await token.document.update({\n        light: {\n            alpha: 0.2,\n            angle: 0,\n            bright: bright_range,\n            coloration: 1,\n            dim: dim_range,\n            gradual: true,\n            luminosity: 0.5,\n            saturation: 0,\n            contrast: 0.25,\n            shadows: 0,\n            animation: {\n                speed: 1,\n                intensity: 2,\n                reverse: false,\n                type: \"torch\",\n            },\n            darkness: {\n                min: 0,\n                max: 1,\n            },\n            color: \"#f3e09b\",\n        },\n    });\n} else {\n    await token.document.update({\n        light: {\n            alpha: 0.5,\n            angle: 0,\n            bright: 0,\n            color: \"#000000\",\n            coloration: 1,\n            dim: 0,\n            gradual: true,\n            luminosity: 0.5,\n            saturation: 0,\n            contrast: 0,\n            shadows: 0,\n            animation: {\n                speed: 5,\n                intensity: 5,\n                reverse: false,\n            },\n            darkness: {\n                min: 0,\n                max: 1,\n            },\n        },\n    });\n}"},"onDelete":{"script":"// icon suggestion: icons/sundries/lights/torch-brown-lit.webp\nconst dim_range = 20;\nconst bright_range = 10;\nif (token.data.light.dim === 0) {\n    await token.document.update({\n        light: {\n            alpha: 0.2,\n            angle: 0,\n            bright: bright_range,\n            coloration: 1,\n            dim: dim_range,\n            gradual: true,\n            luminosity: 0.5,\n            saturation: 0,\n            contrast: 0.25,\n            shadows: 0,\n            animation: {\n                speed: 1,\n                intensity: 2,\n                reverse: false,\n                type: \"torch\",\n            },\n            darkness: {\n                min: 0,\n                max: 1,\n            },\n            color: \"#f3e09b\",\n        },\n    });\n} else {\n    await token.document.update({\n        light: {\n            alpha: 0.5,\n            angle: 0,\n            bright: 0,\n            color: \"#000000\",\n            coloration: 1,\n            dim: 0,\n            gradual: true,\n            luminosity: 0.5,\n            saturation: 0,\n            contrast: 0,\n            shadows: 0,\n            animation: {\n                speed: 5,\n                intensity: 5,\n                reverse: false,\n            },\n            darkness: {\n                min: 0,\n                max: 1,\n            },\n        },\n    });\n}"}},"effective-transferral":{"transferBlock":{"button":false,"chat":false,"displayCard":false}},"dae":{"selfTarget":false,"selfTargetAlways":false,"stackable":"none","durationExpression":"","macroRepeat":"none","specialDuration":[]},"core":{"statusId":""}}}],"_stats":{"systemId":"dnd5e","systemVersion":"2.0.3","coreVersion":"10.291","createdTime":1669815040073,"modifiedTime":1671041503161,"lastModifiedBy":"npmYF618vZgxA5SD"},"ownership":{"default":0,"npmYF618vZgxA5SD":3},"folder":null,"sort":0,"_id":"N8tIWMR5vvjWtg5U"}
{"type":"spell","system":{"description":{"value":"<p>You call forth an elemental spirit. It manifests in an unoccupied space that you can see within range. This corporeal form uses the Elemental Spirit stat block. When you cast the spell, choose an element: Air, Earth, Fire, or Water. The creature resembles a bipedal form wreathed in the chosen element, which determines certain traits in its stat block. The creature disappears when it drops to 0 hit points or when the spell ends.</p>\n<p>The creature is an ally to you and your companions. In combat, the creature shares your initiative count, but it takes its turn immediately after yours. It obeys your verbal commands (no action required by you). If you don’t issue any, it takes the Dodge action and uses its move to avoid danger.</p>\n<p><em><strong>At Higher Levels.</strong></em> When you cast this spell using a spell slot of 5th level or higher, use the higher level wherever the spell’s level appears in the stat block.</p>\n<div class=\"Basic-Text-Frame stat-block-finder\">\n<p class=\"Stat-Block-Styles_Stat-Block-Title\">Elemental Spirit</p>\n<p class=\"Stat-Block-Styles_Stat-Block-Metadata\">Medium elemental</p>\n<p class=\"Stat-Block-Styles_Stat-Block-Data\"><strong>Armor Class</strong> 11 + the level of the spell (natural armor)</p>\n<p class=\"Stat-Block-Styles_Stat-Block-Data\"><strong>Hit Points</strong> 50 + 10 for each spell level above 4th</p>\n<p class=\"Stat-Block-Styles_Stat-Block-Data\"><strong>Speed</strong> 40 ft.; burrow 40 ft. (Earth only); fly 40 ft. (hover) (Air only); swim 40 ft. (Water only)</p>\n<div class=\"stat-block-ability-scores\">\n<div class=\"stat-block-ability-scores-stat\">\n<div class=\"stat-block-ability-scores-heading\">STR</div>\n<div class=\"stat-block-ability-scores-data\"><span class=\"stat-block-ability-scores-score\">18</span> <span class=\"stat-block-ability-scores-modifier\">(+4)</span></div>\n</div>\n<div class=\"stat-block-ability-scores-stat\">\n<div class=\"stat-block-ability-scores-heading\">DEX</div>\n<div class=\"stat-block-ability-scores-data\"><span class=\"stat-block-ability-scores-score\">15</span> <span class=\"stat-block-ability-scores-modifier\">(+2)</span></div>\n</div>\n<div class=\"stat-block-ability-scores-stat\">\n<div class=\"stat-block-ability-scores-heading\">CON</div>\n<div class=\"stat-block-ability-scores-data\"><span class=\"stat-block-ability-scores-score\">17</span> <span class=\"stat-block-ability-scores-modifier\">(+3)</span></div>\n</div>\n<div class=\"stat-block-ability-scores-stat\">\n<div class=\"stat-block-ability-scores-heading\">INT</div>\n<div class=\"stat-block-ability-scores-data\"><span class=\"stat-block-ability-scores-score\">4</span> <span class=\"stat-block-ability-scores-modifier\">(−3)</span></div>\n</div>\n<div class=\"stat-block-ability-scores-stat\">\n<div class=\"stat-block-ability-scores-heading\">WIS</div>\n<div class=\"stat-block-ability-scores-data\"><span class=\"stat-block-ability-scores-score\">10</span> <span class=\"stat-block-ability-scores-modifier\">(+0)</span></div>\n</div>\n<div class=\"stat-block-ability-scores-stat\">\n<div class=\"stat-block-ability-scores-heading\">CHA</div>\n<div class=\"stat-block-ability-scores-data\"><span class=\"stat-block-ability-scores-score\">16</span> <span class=\"stat-block-ability-scores-modifier\">(+3)</span></div>\n</div>\n</div>\n<p class=\"Stat-Block-Styles_Stat-Block-Data\"><strong>Damage Resistances</strong> acid (Water only); lightning and thunder (Air only); piercing and slashing (Earth only)</p>\n<p class=\"Stat-Block-Styles_Stat-Block-Data\"><strong>Damage Immunities</strong> poison; fire (Fire only)</p>\n<p class=\"Stat-Block-Styles_Stat-Block-Data\"><strong>Condition Immunities</strong> exhaustion, @Compendium[dnd5e.rules.w7eitkpD7QQTB6j0]{paralyzed}, @Compendium[dnd5e.rules.w7eitkpD7QQTB6j0]{petrified}, @Compendium[dnd5e.rules.w7eitkpD7QQTB6j0]{poisoned}, @Compendium[dnd5e.rules.w7eitkpD7QQTB6j0]{unconscious}</p>\n<p class=\"Stat-Block-Styles_Stat-Block-Data\"><strong>Senses</strong> @Compendium[dnd5e.rules.eVtpEGXjA2tamEIJ]{darkvision} 60 ft., passive @Compendium[dnd5e.rules.0AGfrwZRzSG0vNKb]{Perception} 10</p>\n<p class=\"Stat-Block-Styles_Stat-Block-Data\"><strong>Languages</strong> Primordial, understands the languages you speak</p>\n<p class=\"Stat-Block-Styles_Stat-Block-Data-Last\"><strong>Challenge</strong> — <strong>Proficiency Bonus</strong> equals your bonus</p>\n<p class=\"Stat-Block-Styles_Stat-Block-Body\"><em><strong>Amorphous Form (Air, Fire, and Water Only).</strong></em> The elemental can move through a space as narrow as 1 inch wide without squeezing.</p>\n<p class=\"Stat-Block-Styles_Stat-Block-Heading\">Actions</p>\n<p class=\"Stat-Block-Styles_Stat-Block-Body\"><em><strong>Multiattack.</strong></em> The elemental makes a number of attacks equal to half this spell’s level (rounded down).</p>\n<p class=\"Stat-Block-Styles_Stat-Block-Body\"><em><strong>Slam.</strong> Melee Weapon Attack:</em> your spell attack modifier to hit, reach 5 ft., one target. <em>Hit:</em> 1d10 + 4 + the spell’s level bludgeoning damage (Air, Earth, and Water only) or fire damage (Fire only).</p>\n</div>","chat":"","unidentified":""},"source":"Tasha’s Cauldron of Everything pg 111","activation":{"type":"action","cost":1,"condition":""},"duration":{"value":"1","units":"hour"},"cover":null,"target":{"value":null,"width":null,"units":"","type":""},"range":{"value":90,"long":null,"units":"ft"},"uses":{"value":null,"max":"","per":"","recovery":""},"consume":{"type":"","target":"","amount":null},"ability":"","actionType":"other","attackBonus":"","chatFlavor":"","critical":{"threshold":null,"damage":""},"damage":{"parts":[],"versatile":""},"formula":"","save":{"ability":"","dc":null,"scaling":"spell"},"level":4,"school":"con","components":{"vocal":true,"somatic":true,"material":true,"ritual":false,"concentration":true},"materials":{"value":"air, a pebble, ash, and water inside a gold-inlaid vial worth at least 400 gp","consumed":false,"cost":400,"supply":0},"preparation":{"mode":"prepared","prepared":false},"scaling":{"mode":"none","formula":""}},"name":"Summon Elemental","flags":{"ddbimporter":{"id":5854983,"definitionId":721199,"entityTypeId":435869154,"dndbeyond":{"lookup":"classSpell","class":"Wizard","level":20,"characterClassId":128250765,"spellLevel":4,"ability":"int","mod":5,"dc":19,"cantripBoost":false,"overrideDC":false,"id":5854983,"entityTypeId":435869154,"healingBoost":0,"usesSpellSlot":true},"originalName":"Summon Elemental","sources":[{"sourceId":67,"pageNumber":111,"sourceType":1}],"tags":["Summoning"],"version":"3.3.16","importId":"2SMktUT3UBtnkWqF"},"midiProperties":{"magicdam":true,"magiceffect":true},"spell-class-filter-for-5e":{"parentClass":"wizard"},"itemacro":{"macro":{"name":"Summon Elemental","type":"script","scope":"global","command":"/**\n * Item-Macro Macro.\n * \n * https://www.dndbeyond.com/spells/summon-elemental\n */\n\nconst macroLabel = item.name;\nconst textureAir = \"modules/Tablerules/icons/magic/summons/elementalSpiritAir.png\";\nconst textureEarth = \"modules/Tablerules/icons/magic/summons/elementalSpiritEarth.png\";\nconst textureFire = \"modules/Tablerules/icons/magic/summons/elementalSpiritFire.png\";\nconst textureWater = \"modules/Tablerules/icons/magic/summons/elementalSpiritWater.png\";\n\nconst formAir = \"Air\";\nconst formEarth = \"Earth\";\nconst formFire = \"Fire\";\nconst formWater = \"Water\";\n\nconst level = await warpgate.dnd5e.rollItem(item);\nconst summonerDc = actor.system.attributes.spelldc;\nconst summonerAttack = summonerDc - 8;\n\nif (!level > 0) {\n    ui.notifications.error(`${macroLabel}, !level>0, check console error.`);\n    console.error({ message: `${macroLabel}, !level>0`, arguments: arguments });\n    return;\n}\n\n/* Prompt the user for which type of spirit to summon */\nconst buttonData = {\n    buttons: [{\n        label: formAir,\n        value: {\n            token: { name: formAir },\n            actor: { name: formAir },\n            embedded: {\n                Item: {\n                }\n            }\n        }\n    },\n    {\n        label: formEarth,\n        value: {\n            actor: { name: formEarth },\n            token: { name: formEarth },\n            embedded: {\n                Item: {\n                    \"Amorphous Form\": warpgate.CONST.DELETE\n                }\n            }\n        }\n    },\n    {\n        label: formFire,\n        value: {\n            actor: { name: formFire },\n            token: { name: formFire },\n            embedded: {\n                Item: {\n                }\n            }\n        }\n    },\n    {\n        label: formWater,\n        value: {\n            actor: { name: formWater },\n            token: { name: formWater },\n            embedded: {\n                Item: {\n                }\n            }\n        }\n    }\n    ], title: \"Which version?\"\n};\n\nlet spirit = await warpgate.buttonDialog(buttonData);\n\n/* Craft the updates that are common to all spirits */\nlet updates = {\n    token: {\n        \"displayName\": CONST.TOKEN_DISPLAY_MODES.HOVER,\n        \"flags.Tablerules.spellLevel\": level\n    },\n    actor: {\n        'system.attributes.ac.flat': 11 + level,\n        'system.attributes.hp': { value: 50 + 10 * (level - 4), max: 50 + 10 * (level - 4) },\n        \"system.details.cr\": actor.system.attributes.prof,\n        \"system.attributes.prof\": actor.system.attributes.prof,\n        \"flags.world.summoned.item\": item.uuid,\n        \"flags.world.summoned.actor\": actor.uuid\n    },\n    embedded: {\n        Item: {\n            \"Multiattack\": { name: `Multiattack (${Math.floor(level / 2)} attacks)` },\n            \"Slam\": {\n                'system.damage.parts': [[`1d10 + 4 + ${level}`, spirit.actor.name === formFire ? \"fire\" : \"bludgeoning\"]],\n                'system.attackBonus': `- @mod - @prof + ${summonerAttack}`\n            }\n        }\n    }\n}\n\n/* update variants */\nif (spirit.actor.name === formAir) {\n    updates[\"actor.img\"] = textureAir;\n    updates[\"token.texture.src\"] = textureAir;\n    updates[\"actor.system.attributes.movement.fly\"] = 40;\n    updates[\"actor.system.attributes.movement.hover\"] = true;\n    updates[\"actor.system.traits.dr.value\"] = [\"lightning\", \"thunder\"];\n}\n\nif (spirit.actor.name === formEarth) {\n    updates[\"actor.img\"] = textureEarth;\n    updates[\"token.texture.src\"] = textureEarth;\n    updates[\"actor.system.attributes.movement.burrow\"] = 40;\n    updates[\"actor.system.traits.dr.value\"] = [\"piercing\", \"slashing\"];\n}\n\nif (spirit.actor.name === formFire) {\n    updates[\"actor.img\"] = textureFire;\n    updates[\"token.texture.src\"] = textureFire;\n    updates[\"actor.system.traits.di.value\"] = [\"poison\", \"fire\"];\n}\n\nif (spirit.actor.name === formWater) {\n    updates[\"actor.img\"] = textureWater;\n    updates[\"token.texture.src\"] = textureWater;\n    updates[\"actor.system.attributes.movement.swim\"] = 40;\n    updates[\"actor.system.traits.dr.value\"] = [\"acid\"];\n}\n\n/* Combine the general and specific updates */\nupdates = mergeObject(updates, spirit);\n\nconst spawnIds = await warpgate.spawn(\"Elemental Spirit\", updates);","author":"YCF2Heb7DMHDaF2f","_id":null,"img":"icons/svg/dice-target.svg","folder":null,"sort":0,"ownership":{"default":0},"flags":{},"_stats":{"systemId":null,"systemVersion":null,"coreVersion":null,"createdTime":null,"modifiedTime":null,"lastModifiedBy":null}}},"core":{"sourceId":"Actor.Q7hqVwhDhhZq8QEa.Item.VLZXGN6vvguJPjK1"}},"img":"icons/magic/water/strike-ice-blade-fang.webp","effects":[{"label":"Summon Elemental","icon":"icons/magic/water/strike-ice-blade-fang.webp","origin":"Actor.Q7hqVwhDhhZq8QEa.Item.VLZXGN6vvguJPjK1","duration":{"seconds":3600,"startTime":null,"combat":null,"rounds":null,"turns":null,"startRound":null,"startTurn":null},"disabled":false,"_id":"KWSe9bq1K1umcmu3","changes":[],"tint":null,"transfer":false,"flags":{}}],"ownership":{"default":0,"YCF2Heb7DMHDaF2f":3},"_stats":{"systemId":"dnd5e","systemVersion":"2.1.5","coreVersion":"10.291","createdTime":1678464911484,"modifiedTime":1678716549231,"lastModifiedBy":"YCF2Heb7DMHDaF2f"},"folder":null,"sort":0,"_id":"NAN49Z8vCx3NSDD8"}
{"type":"spell","system":{"description":{"value":"<p>Your spell bolsters your allies with toughness and resolve. Choose up to three creatures within range. Each target's hit point maximum and current hit points increase by 5 for the duration.</p>\n<p><em><strong>At Higher Levels.</strong></em> When you cast this spell using a spell slot of 3rd level or higher, a target's hit points increase by an additional 5 for each slot level above 2nd.</p>","chat":"","unidentified":""},"source":"Basic Rules, Player's Handbook pg 211","activation":{"type":"action","cost":1,"condition":""},"duration":{"value":8,"units":"hour"},"target":{"value":3,"width":null,"units":"","type":"creature"},"range":{"value":30,"long":null,"units":"ft"},"uses":{"value":null,"max":"","per":"","recovery":""},"consume":{"type":"","target":"","amount":null},"ability":"","actionType":"util","attackBonus":0,"chatFlavor":"","critical":{"threshold":null,"damage":""},"damage":{"parts":[["5","healing"]],"versatile":""},"formula":"","save":{"ability":"","dc":null,"scaling":"spell"},"level":2,"school":"abj","components":{"value":"a tiny strip of white cloth","vocal":true,"somatic":true,"material":true,"ritual":false,"concentration":false},"materials":{"value":"a tiny strip of white cloth","consumed":false,"cost":0,"supply":0},"preparation":{"mode":"prepared","prepared":true},"scaling":{"mode":"level","formula":"(@item.level - 2) * 5"}},"name":"Aid","flags":{"ddbimporter":{"id":136020,"definitionId":1990,"entityTypeId":435869154,"dndbeyond":{"lookup":"classSpell","class":"Cleric","level":10,"characterClassId":116804531,"spellLevel":2,"ability":"wis","mod":3,"dc":15,"cantripBoost":false,"overrideDC":false,"id":136020,"entityTypeId":435869154,"healingBoost":0,"usesSpellSlot":true},"originalName":"Aid","sources":[{"sourceId":1,"pageNumber":null,"sourceType":2},{"sourceId":2,"pageNumber":211,"sourceType":1}],"tags":["Buff"],"version":"3.2.5","importId":"QZvF1RLtxqetgW6P"},"spell-class-filter-for-5e":{"parentClass":"cleric"},"midi-qol":{"effectActivation":false,"forceCEOn":false},"midiProperties":{"nodam":false,"fulldam":false,"halfdam":false,"rollOther":false,"critOther":false,"magicdam":false,"magiceffect":false,"concentration":false,"toggleEffect":false,"ignoreTotalCover":false},"core":{"sourceId":"Actor.8ugKnRSqQzxSxrZO.Item.lkEkZJQWgyvPUigR"}},"img":"icons/magic/life/heart-cross-strong-blue.webp","effects":[{"label":"Aid","icon":"icons/magic/life/heart-cross-strong-blue.webp","origin":"Actor.8ugKnRSqQzxSxrZO.Item.lkEkZJQWgyvPUigR","duration":{"seconds":28800,"startTime":null,"combat":null,"rounds":null,"turns":null,"startRound":null,"startTurn":null},"disabled":false,"_id":"B97VzuSbScI7mJOh","changes":[{"key":"system.attributes.hp.tempmax","mode":2,"value":"+5","priority":20}],"tint":null,"transfer":false,"flags":{"effective-transferral":{"transferBlock":{"button":false,"chat":false,"displayCard":false}},"dae":{"selfTarget":false,"selfTargetAlways":false,"stackable":"none","durationExpression":"","macroRepeat":"none","specialDuration":[]},"core":{"statusId":""},"effectmacro":{"onCreate":{"script":"const castLevel = effect.flags[\"effective-transferral\"].castData.castLevel;\n\nconst changes = effect.changes;\nconst tempmax = castLevel * 5 - 5;\nchanges[0].value = tempmax;\n\nawait effect.update({ changes: changes });\nawait actor.update({ \"system.attributes.hp.value\": actor.system.attributes.hp.value + tempmax });\n"},"onDelete":{"script":"await actor.update({ \"system.attributes.hp.value\": Math.min(actor.system.attributes.hp.value, actor.system.attributes.hp.max) });"}}}}],"ownership":{"default":0,"npmYF618vZgxA5SD":3},"_stats":{"systemId":"dnd5e","systemVersion":"2.0.3","coreVersion":"10.291","createdTime":1669848893063,"modifiedTime":1671041526847,"lastModifiedBy":"npmYF618vZgxA5SD"},"folder":null,"sort":0,"_id":"PdQt53wccy7nBKvT"}
{"type":"spell","system":{"description":{"value":"<p>Divine energy radiates from you, distorting and diffusing magical energy within 30 feet of you. Until the spell ends, the sphere moves with you, centered on you. For the duration, each friendly creature in the area (including you) has advantage on saving throws against spells and other magical effects. <br /><br />Additionally, when an affected creature succeeds on a saving throw made against a spell or magical effect that allows it to make a saving throw to take only half damage, it instead takes no damage if it succeeds on the saving throws.</p>","chat":"","unidentified":""},"source":"Player's Handbook pg 221","activation":{"type":"action","cost":1,"condition":""},"duration":{"value":"10","units":"minute"},"cover":null,"target":{"value":30,"width":null,"units":"ft","type":"sphere"},"range":{"value":null,"long":null,"units":"self"},"uses":{"value":null,"max":"","per":"","recovery":""},"consume":{"type":"","target":"","amount":null},"ability":"","actionType":"util","attackBonus":"","chatFlavor":"","critical":{"threshold":null,"damage":""},"damage":{"parts":[],"versatile":""},"formula":"","save":{"ability":"","dc":null,"scaling":"spell"},"level":5,"school":"abj","components":{"vocal":true,"somatic":false,"material":false,"ritual":false,"concentration":true},"materials":{"value":"","consumed":false,"cost":0,"supply":0},"preparation":{"mode":"pact","prepared":false},"scaling":{"mode":"none","formula":""}},"name":"Circle of Power","flags":{"ddbimporter":{"id":434575,"definitionId":2353,"entityTypeId":341470558,"dndbeyond":{"lookup":"classSpell","class":"Warlock","level":9,"characterClassId":125262878,"spellLevel":5,"ability":"cha","mod":4,"dc":16,"cantripBoost":false,"overrideDC":false,"id":434575,"entityTypeId":341470558,"healingBoost":0,"usesSpellSlot":true},"originalName":"Circle of Power","sources":[{"sourceId":2,"pageNumber":221,"sourceType":1}],"tags":["Buff","Warding"],"version":"3.3.16","importId":"g92v1zqiWNYCwhBT"},"midiProperties":{"magicdam":true,"magiceffect":true},"spell-class-filter-for-5e":{"parentClass":"warlock"},"core":{"sourceId":"Actor.CVogtJ8SM5XVdEwE.Item.6ec6HG6xlddW3Kuq"},"itemacro":{"macro":{"name":"Circle of Power","type":"script","scope":"global","command":"/**\n * Item-Macro Macro for Circle of Power\n * \n * after dropping onto Actor create empty AE for duration/concentration and deleting the MeasuredTemplate with\n * await canvas.scene.deleteEmbeddedDocuments(\"MeasuredTemplate\",canvas.scene.templates.filter(t => t.flags?.dnd5e?.origin === origin.uuid).map(t=>t.id));\n * on Effect-Macro onDelete\n */\n\nconst macroLabel = item.name;\nconst icon = item.img;\n\nif (canvas.scene.templates.filter(t => t.flags.dnd5e !== undefined).filter(t => t.flags.dnd5e.origin === item.uuid).length !== 0) {\n    ui.notifications.warn(`${macroLabel}, MeasuredTemplate for this item ${item.name} (${item.uuid}) present. Delete if spell is supposed to not be active already (delte AE if present).`);\n    return;\n}\n\n\n// use the item (takes care of resources, ChatMessage), if returning null (i believe) return\nconst use = await item.use();\nif (!use) {\n    return;\n}\n\n// select the MeasuringTemplate created by the Item.Spell use() and modify\ntemplate = canvas.scene.templates.filter(t => t.flags.dnd5e !== undefined).filter(t => t.flags.dnd5e.origin === item.uuid)[0];\n\nconst templateData = {\n    borderColor: \"#00800f\",\n    fillColor: \"#022400\",\n    x: token.center.x,\n    y: token.center.y\n};\nawait template.update(templateData);\nawait tokenAttacher.attachElementsToToken([template], token);","author":"npmYF618vZgxA5SD","_id":null,"img":"icons/svg/dice-target.svg","folder":null,"sort":0,"ownership":{"default":0},"flags":{},"_stats":{"systemId":null,"systemVersion":null,"coreVersion":null,"createdTime":null,"modifiedTime":null,"lastModifiedBy":null}}}},"img":"icons/magic/light/explosion-star-glow-blue-purple.webp","effects":[{"label":"Circle of Power","icon":"icons/magic/light/explosion-star-glow-blue-purple.webp","origin":"Actor.CVogtJ8SM5XVdEwE.Item.6ec6HG6xlddW3Kuq","duration":{"seconds":600,"startTime":null,"combat":null,"rounds":null,"turns":null,"startRound":null,"startTurn":null},"disabled":false,"_id":"zgH962ah8d36WhCn","changes":[],"tint":null,"transfer":false,"flags":{"dfreds-convenient-effects":{"description":"test"},"effective-transferral":{"transferBlock":{"button":false,"chat":false,"displayCard":false},"transferrable":{"self":true,"target":true}},"dae":{"selfTarget":false,"selfTargetAlways":false,"stackable":"none","durationExpression":"","macroRepeat":"none","specialDuration":[]},"core":{"statusId":""},"effectmacro":{"onDelete":{"script":"await canvas.scene.deleteEmbeddedDocuments(\"MeasuredTemplate\",canvas.scene.templates.filter(t => t.flags?.dnd5e?.origin === origin.uuid).map(t=>t.id));"}}}}],"ownership":{"default":0,"npmYF618vZgxA5SD":3},"_stats":{"systemId":"dnd5e","systemVersion":"2.1.5","coreVersion":"10.291","createdTime":1678251329585,"modifiedTime":1678300270227,"lastModifiedBy":"npmYF618vZgxA5SD"},"folder":null,"sort":0,"_id":"QBj0QvHBRgUZG3Dj"}
{"type":"spell","system":{"description":{"value":"<p>You call forth a shadowy spirit. It manifests in an unoccupied space that you can see within range. This corporeal form uses the Shadow Spirit stat block. When you cast the spell, choose an emotion: Fury, Despair, or Fear. The creature resembles a misshapen biped marked by the chosen emotion, which determines certain traits in its stat block. The creature disappears when it drops to 0 hit points or when the spell ends.</p>\n<p>The creature is an ally to you and your companions. In combat, the creature shares your initiative count, but it takes its turn immediately after yours. It obeys your verbal commands (no action required by you). If you don’t issue any, it takes the Dodge action and uses its move to avoid danger.</p>\n<p><em><strong>At Higher Levels.</strong></em> When you cast this spell using a spell slot of 4th level or higher, use the higher level wherever the spell’s level appears in the stat block.</p>\n<div class=\"Basic-Text-Frame stat-block-finder stat-block-background\">\n<p class=\"Stat-Block-Styles_Stat-Block-Title\">Shadow Spirit</p>\n<p class=\"Stat-Block-Styles_Stat-Block-Metadata\">Medium monstrosity</p>\n<p class=\"Stat-Block-Styles_Stat-Block-Data\"><strong>Armor Class</strong> 11 + the level of the spell (natural armor)</p>\n<p class=\"Stat-Block-Styles_Stat-Block-Data\"><strong>Hit Points</strong> 35 + 15 for each spell level above 3rd</p>\n<p class=\"Stat-Block-Styles_Stat-Block-Data\"><strong>Speed</strong> 40 ft.</p>\n<div class=\"stat-block-ability-scores\">\n<div class=\"stat-block-ability-scores-stat\">\n<div class=\"stat-block-ability-scores-heading\">STR</div>\n<div class=\"stat-block-ability-scores-data\"><span class=\"stat-block-ability-scores-score\">13</span> <span class=\"stat-block-ability-scores-modifier\">(+1)</span></div>\n</div>\n<div class=\"stat-block-ability-scores-stat\">\n<div class=\"stat-block-ability-scores-heading\">DEX</div>\n<div class=\"stat-block-ability-scores-data\"><span class=\"stat-block-ability-scores-score\">16</span> <span class=\"stat-block-ability-scores-modifier\">(+3)</span></div>\n</div>\n<div class=\"stat-block-ability-scores-stat\">\n<div class=\"stat-block-ability-scores-heading\">CON</div>\n<div class=\"stat-block-ability-scores-data\"><span class=\"stat-block-ability-scores-score\">15</span> <span class=\"stat-block-ability-scores-modifier\">(+2)</span></div>\n</div>\n<div class=\"stat-block-ability-scores-stat\">\n<div class=\"stat-block-ability-scores-heading\">INT</div>\n<div class=\"stat-block-ability-scores-data\"><span class=\"stat-block-ability-scores-score\">4</span> <span class=\"stat-block-ability-scores-modifier\">(−3)</span></div>\n</div>\n<div class=\"stat-block-ability-scores-stat\">\n<div class=\"stat-block-ability-scores-heading\">WIS</div>\n<div class=\"stat-block-ability-scores-data\"><span class=\"stat-block-ability-scores-score\">10</span> <span class=\"stat-block-ability-scores-modifier\">(+0)</span></div>\n</div>\n<div class=\"stat-block-ability-scores-stat\">\n<div class=\"stat-block-ability-scores-heading\">CHA</div>\n<div class=\"stat-block-ability-scores-data\"><span class=\"stat-block-ability-scores-score\">16</span> <span class=\"stat-block-ability-scores-modifier\">(+3)</span></div>\n</div>\n</div>\n<p class=\"Stat-Block-Styles_Stat-Block-Data\"><strong>Damage Resistances </strong>necrotic</p>\n<p class=\"Stat-Block-Styles_Stat-Block-Data\"><strong>Condition Immunities </strong>@Compendium[dnd5e.rules.w7eitkpD7QQTB6j0]{frightened}</p>\n<p class=\"Stat-Block-Styles_Stat-Block-Data\"><strong>Senses </strong>@Compendium[dnd5e.rules.eVtpEGXjA2tamEIJ]{darkvision} 120 ft., passive @Compendium[dnd5e.rules.0AGfrwZRzSG0vNKb]{Perception} 10</p>\n<p class=\"Stat-Block-Styles_Stat-Block-Data\"><strong>Languages </strong>understands the languages you speak</p>\n<p class=\"Stat-Block-Styles_Stat-Block-Data-Last\"><strong>Challenge</strong> — <strong>Proficiency Bonus</strong> equals your bonus</p>\n<p class=\"Stat-Block-Styles_Stat-Block-Body\"><em><strong>Terror Frenzy (Fury Only).</strong></em> The spirit has advantage on attack rolls against @Compendium[dnd5e.rules.w7eitkpD7QQTB6j0]{frightened} creatures.</p>\n<p class=\"Stat-Block-Styles_Stat-Block-Body\"><em><strong>Weight of Sorrow (Despair Only).</strong></em> Any creature, other than you, that starts its turn within 5 feet of the spirit has its speed reduced by 20 feet until the start of that creature’s next turn.</p>\n<p class=\"Stat-Block-Styles_Stat-Block-Heading\">Actions</p>\n<p class=\"Stat-Block-Styles_Stat-Block-Body\"><em><strong>Multiattack.</strong></em> The spirit makes a number of attacks equal to half this spell’s level (rounded down).</p>\n<p class=\"Stat-Block-Styles_Stat-Block-Body\"><em><strong>Chilling Rend.</strong></em> <em>Melee Weapon Attack:</em> your spell attack modifier to hit, reach 5 ft., one target. <em>Hit:</em> 1d12 + 3 + the spell’s level cold damage.</p>\n<p class=\"Stat-Block-Styles_Stat-Block-Body\"><em><strong>Dreadful Scream (1/Day).</strong></em> The spirit screams. Each creature within 30 feet of it must succeed on a Wisdom saving throw against your spell save DC or be @Compendium[dnd5e.rules.w7eitkpD7QQTB6j0]{frightened} of the spirit for 1 minute. The @Compendium[dnd5e.rules.w7eitkpD7QQTB6j0]{frightened} creature can repeat the saving throw at the end of each of its turns, ending the effect on itself on a success.</p>\n<p class=\"Stat-Block-Styles_Stat-Block-Heading\">Bonus Actions</p>\n<p class=\"Stat-Block-Styles_Stat-Block-Body\"><em><strong>Shadow @Compendium[dnd5e.rules.0AGfrwZRzSG0vNKb]{Stealth} (Fear Only).</strong></em> While in dim light or darkness, the spirit takes the Hide action.</p>\n</div>","chat":"","unidentified":""},"source":"Tasha’s Cauldron of Everything pg 113","activation":{"type":"action","cost":1,"condition":""},"duration":{"value":"1","units":"hour"},"cover":null,"target":{"value":null,"width":null,"units":"","type":""},"range":{"value":90,"long":null,"units":"ft"},"uses":{"value":null,"max":"","per":"","recovery":""},"consume":{"type":"","target":"","amount":null},"ability":"","actionType":"other","attackBonus":"","chatFlavor":"","critical":{"threshold":null,"damage":""},"damage":{"parts":[],"versatile":""},"formula":"","save":{"ability":"","dc":null,"scaling":"spell"},"level":3,"school":"con","components":{"vocal":true,"somatic":true,"material":true,"ritual":false,"concentration":true},"materials":{"value":"tears inside a gem worth at least 300 gp","consumed":false,"cost":300,"supply":0},"preparation":{"mode":"prepared","prepared":false},"scaling":{"mode":"none","formula":""}},"name":"Summon Shadowspawn","flags":{"ddbimporter":{"id":5843244,"definitionId":719948,"entityTypeId":435869154,"dndbeyond":{"lookup":"classSpell","class":"Wizard","level":20,"characterClassId":128250765,"spellLevel":3,"ability":"int","mod":5,"dc":19,"cantripBoost":false,"overrideDC":false,"id":5843244,"entityTypeId":435869154,"healingBoost":0,"usesSpellSlot":true},"originalName":"Summon Shadowspawn","sources":[{"sourceId":67,"pageNumber":113,"sourceType":1}],"tags":["Summoning"],"version":"3.3.16","importId":"2SMktUT3UBtnkWqF"},"midiProperties":{"magicdam":true,"magiceffect":true},"spell-class-filter-for-5e":{"parentClass":"wizard"},"itemacro":{"macro":{"name":"Summon Shadowspawn","type":"script","scope":"global","command":"/**\n * Item-Macro Macro Summon Construct\n * \n * https://www.dndbeyond.com/spells/summon-shadowspawn\n */\n\nconst macroLabel = item.name;\nconst textureFury = \"modules/Tablerules/icons/magic/summons/shadowSpiritFury.png\";\nconst textureDespair = \"modules/Tablerules/icons/magic/summons/shadowSpiritDespair.png\";\nconst textureFear = \"modules/Tablerules/icons/magic/summons/shadowSpiritFear.png\";\n\nconst formFury = \"Shadowspawn Fury\";\nconst formDespair = \"Shadowspawn Despair\";\nconst formFear = \"Shadowspawn Fear\";\n\nconst scaleFury = 1;\nconst scaleDespair = 1;\nconst scaleFear = 1;\n\n\nconst summonerDc = actor.system.attributes.spelldc;\nconst summonerAttack = summonerDc - 8;\nconst level = await warpgate.dnd5e.rollItem(item);\nif (!level > 0) {\n    return;\n}\n\n\n/* Prompt the user for which type of spirit to summon */\nconst buttonData = {\n    buttons: [{\n        label: formFury,\n        value: {\n            token: { name: formFury },\n            actor: { name: formFury },\n            embedded: {\n                Item: {\n                    \"Weight of Sorrow\": warpgate.CONST.DELETE,\n                    \"Shadow Stealth\": warpgate.CONST.DELETE\n                }\n            }\n        }\n    }, {\n        label: formDespair,\n        value: {\n            actor: { name: formDespair },\n            token: { name: formDespair },\n            embedded: {\n                Item: {\n                    \"Terror Frenzy\": warpgate.CONST.DELETE,\n                    \"Shadow Stealth\": warpgate.CONST.DELETE\n                }\n            }\n        }\n    }, {\n        label: formFear,\n        value: {\n            actor: { name: formFear },\n            token: { name: formFear },\n            embedded: {\n                Item: {\n                    \"Weight of Sorrow\": warpgate.CONST.DELETE,\n                    \"Terror Frenzy\": warpgate.CONST.DELETE\n                }\n            }\n        }\n    }\n    ], title: \"Which version?\"\n};\n\nlet spirit = await warpgate.buttonDialog(buttonData);\n\n/* Craft the updates that are common to all spirits */\nlet updates = {\n    token: {\n        \"displayName\": CONST.TOKEN_DISPLAY_MODES.HOVER,\n        \"flags.Tablerules.spellLevel\": level\n    },\n    actor: {\n        'system.attributes.ac.flat': 11 + level,\n        'system.attributes.hp': { value: 35 + 15 * (level - 3), max: 35 + 15 * (level - 3) },\n        \"system.details.cr\": actor.system.attributes.prof,\n        \"flags.world.summoned.item\": item.uuid,\n        \"flags.world.summoned.actor\": actor.uuid\n    },\n    embedded: {\n        Item: {\n            \"Multiattack\": { name: `Multiattack (${Math.floor(level / 2)} attacks)` },\n            \"Chilling Rend\": {\n                'system.damage.parts': [[`1d12 + 3 + ${level}`, \"cold\"]],\n                'system.attackBonus': `- @mod - @prof + ${summonerAttack}`,\n            },\n            \"Dreadful Scream\": {\n                'system.save.dc': summonerDc\n            }\n        }\n    }\n}\n\n/* update variants */\nif (spirit.actor.name === formFury) {\n    updates[\"actor.img\"] = textureFury;\n    updates[\"token.texture.src\"] = textureFury;\n    updates[\"token.texture.scaleX\"] = scaleFury;\n    updates[\"token.texture.scaleY\"] = scaleFury;\n}\n\nif (spirit.actor.name === formDespair) {\n    updates[\"actor.img\"] = textureDespair;\n    updates[\"token.texture.src\"] = textureDespair;\n    updates[\"token.texture.scaleX\"] = scaleDespair;\n    updates[\"token.texture.scaleY\"] = scaleDespair;\n}\n\nif (spirit.actor.name === formFear) {\n    updates[\"actor.img\"] = textureFear;\n    updates[\"token.texture.src\"] = textureFear;\n    updates[\"token.texture.scaleX\"] = scaleFear;\n    updates[\"token.texture.scaleY\"] = scaleFear;\n}\n\n/* Combine the general and specific updates */\nupdates = mergeObject(updates, spirit);\n\nconst spawnIds = await warpgate.spawn(\"Shadow Spirit\", updates);\n//const spawn = canvas.tokens.get(spawnIds[0]); // or canvas.scene.tokens.get(id) to get the document immediately\n\nif (spirit.actor.name === formDespair) {\n    const token = canvas.tokens.get(spawnIds[0]);\n    // create and attach MeasuredTemplate\n    const data = {\n        distance: 7.5,\n        borderColor: \"#52004b\",\n        fillColor: \"#940088\",\n        x: token.center.x,\n        y: token.center.y\n    };\n    foundry.utils.setProperty(data, \"flags.dnd5e.origin\", item.uuid);\n    await canvas.scene.createEmbeddedDocuments(\"MeasuredTemplate\", [data]);\n\n    const template = canvas.scene.templates.find(t => t.flags?.dnd5e?.origin === item.uuid);\n    await tokenAttacher.attachElementsToToken([template], token);\n}","author":"YCF2Heb7DMHDaF2f","_id":null,"img":"icons/svg/dice-target.svg","folder":null,"sort":0,"ownership":{"default":0},"flags":{},"_stats":{"systemId":null,"systemVersion":null,"coreVersion":null,"createdTime":null,"modifiedTime":null,"lastModifiedBy":null}}},"core":{"sourceId":"Actor.Q7hqVwhDhhZq8QEa.Item.QpsZaRvouek8Nh2N"}},"img":"icons/creatures/unholy/demons-horned-glowing-pink.webp","effects":[],"ownership":{"default":0,"YCF2Heb7DMHDaF2f":3},"_stats":{"systemId":"dnd5e","systemVersion":"2.1.5","coreVersion":"10.291","createdTime":1678464911489,"modifiedTime":1678716545528,"lastModifiedBy":"YCF2Heb7DMHDaF2f"},"folder":null,"sort":0,"_id":"QCDcQEK6ApLHSkkK"}
{"type":"spell","system":{"description":{"value":"<p>The next time you hit a creature with a melee weapon attack during the spell’s duration, your weapon flares with white-hot intensity, and the attack deals an extra 1d6 fire damage to the target and causes the target to ignite in flames. At the start of each of its turns until the spell ends, the target must make a Constitution saving throw. On a failed save, it takes 1d6 fire damage. On a successful save, the spell ends. If the target or a creature within 5 feet of it uses an action to put out the flames, or if some other effect douses the flames (such as the target being submerged in water), the spell ends.</p>\n<p><strong>At Higher Levels.</strong> When you cast this spell using a spell slot of 2nd level or higher, the initial extra damage dealt by the attack increases by 1d6 for each slot.</p>","chat":"","unidentified":""},"source":"Player's Handbook pg 274","activation":{"type":"bonus","cost":1,"condition":""},"duration":{"value":1,"units":"minute"},"target":{"value":null,"width":null,"units":"","type":"creature"},"range":{"value":null,"long":null,"units":"self"},"uses":{"value":null,"max":"","per":"","recovery":""},"consume":{"type":"","target":"","amount":null},"ability":"","actionType":"save","attackBonus":0,"chatFlavor":"","critical":{"threshold":null,"damage":""},"damage":{"parts":[["1d6[fire - Initial Damage]","fire"]],"versatile":""},"formula":"1d6[fire - At the start of each of the target's turns until the spell ends]","save":{"ability":"con","dc":null,"scaling":"spell"},"level":1,"school":"evo","components":{"value":"","vocal":true,"somatic":false,"material":false,"ritual":false,"concentration":true},"materials":{"value":"","consumed":false,"cost":0,"supply":0},"preparation":{"mode":"prepared","prepared":false},"scaling":{"mode":"level","formula":"1d6"}},"name":"Searing Smite","flags":{"ddbimporter":{"id":138679,"definitionId":2319,"entityTypeId":435869154,"dndbeyond":{"lookup":"classSpell","class":"Paladin","level":2,"characterClassId":118222921,"spellLevel":1,"ability":"cha","mod":3,"dc":13,"cantripBoost":false,"overrideDC":false,"id":138679,"entityTypeId":435869154,"healingBoost":0,"usesSpellSlot":true},"originalName":"Searing Smite","sources":[{"sourceId":2,"pageNumber":274,"sourceType":1}],"tags":["Damage"],"version":"3.2.4","importId":"nr2pP3wJUbGAzZXf"},"spell-class-filter-for-5e":{"parentClass":"paladin"},"midi-qol":{"effectActivation":false},"midiProperties":{"nodam":false,"fulldam":false,"halfdam":false,"rollOther":false,"critOther":false,"magicdam":false,"magiceffect":false,"concentration":false,"toggleEffect":false,"ignoreTotalCover":false},"core":{"sourceId":"Actor.NpZ7SoVLhrnuRzQX.Item.XvbPvuxm9uFSVCo5"}},"img":"icons/magic/fire/dagger-rune-enchant-flame-orange.webp","effects":[{"label":"Searing Smite","icon":"icons/magic/fire/dagger-rune-enchant-flame-orange.webp","origin":"Actor.99cEYTlhTD08gmgQ.Item.XvbPvuxm9uFSVCo5","duration":{"seconds":60,"startTime":null,"combat":null,"rounds":null,"turns":null,"startRound":null,"startTurn":null},"disabled":false,"_id":"qWUgYzZSpUYf2IOL","changes":[],"tint":null,"transfer":false,"flags":{"effectmacro":{"onCreate":{"script":"let params =\n[{\n    filterType: \"fire\",\n    filterId: \"SearingSmite\",\n    intensity: 1,\n    color: 0xFFFFFF,\n    amplitude: 1,\n    time: 0,\n    blend: 2,\n    fireBlend : 1,\n    animated :\n    {\n      time : \n      { \n        active: true, \n        speed: -0.0024, \n        animType: \"move\" \n      },\n      intensity:\n      {\n        active:true,\n        loopDuration: 15000,\n        val1: 0.8,\n        val2: 2,\n        animType: \"syncCosOscillation\"\n      },\n      amplitude:\n      {\n        active:true,\n        loopDuration: 4400,\n        val1: 1,\n        val2: 1.4,\n        animType: \"syncCosOscillation\"\n      }\n      \n    }\n}];\n\nawait TokenMagic.addUpdateFilters(token, params);"},"onDelete":{"script":"await TokenMagic.deleteFilters(token, \"SearingSmite\");"}},"effective-transferral":{"transferBlock":{"button":false,"chat":false,"displayCard":false}},"dae":{"selfTarget":false,"selfTargetAlways":false,"stackable":"none","durationExpression":"","macroRepeat":"none","specialDuration":[]},"core":{"statusId":""}}}],"_stats":{"systemId":"dnd5e","systemVersion":"2.0.3","coreVersion":"10.291","createdTime":1669692144776,"modifiedTime":1671041506216,"lastModifiedBy":"npmYF618vZgxA5SD"},"ownership":{"default":0,"npmYF618vZgxA5SD":3},"folder":null,"sort":0,"_id":"QFcyjacV53RG8Tcy"}
{"type":"spell","system":{"description":{"value":"<p>For the duration, you sense the presence of magic within 30 feet of you. If you sense magic in this way, you can use your action to see a faint aura around any visible creature or object in the area that bears magic, and you learn its school of magic, if any.</p>\n<p>The spell can penetrate most barriers, but it is blocked by 1 foot of stone, 1 inch of common metal, a thin sheet of lead, or 3 feet of wood or dirt.</p>","chat":"","unidentified":""},"source":"Basic Rules, Player's Handbook pg 231","activation":{"type":"action","cost":1,"condition":""},"duration":{"value":10,"units":"minute"},"target":{"value":30,"width":null,"units":"ft","type":"sphere"},"range":{"value":null,"long":null,"units":"self"},"uses":{"value":null,"max":"","per":"","recovery":""},"consume":{"type":"","target":"","amount":null},"ability":"","actionType":"other","attackBonus":0,"chatFlavor":"","critical":{"threshold":null,"damage":""},"damage":{"parts":[],"versatile":""},"formula":"","save":{"ability":"","dc":null,"scaling":"spell"},"level":1,"school":"div","components":{"value":"","vocal":true,"somatic":true,"material":false,"ritual":true,"concentration":true},"materials":{"value":"","consumed":false,"cost":0,"supply":0},"preparation":{"mode":"prepared","prepared":false},"scaling":{"mode":"none","formula":""}},"name":"Detect Magic","flags":{"ddbimporter":{"id":136567,"definitionId":2065,"entityTypeId":435869154,"dndbeyond":{"lookup":"classSpell","class":"Wizard","level":1,"characterClassId":108474208,"spellLevel":1,"ability":"int","mod":3,"dc":13,"cantripBoost":false,"overrideDC":false,"id":136567,"entityTypeId":435869154,"healingBoost":0,"usesSpellSlot":true},"originalName":"Detect Magic","sources":[{"sourceId":1,"pageNumber":null,"sourceType":2},{"sourceId":2,"pageNumber":231,"sourceType":1}],"tags":["Detection"],"version":"3.2.4","importId":"EgKCIFc1BkVC5JrI"},"spell-class-filter-for-5e":{"parentClass":"wizard"},"midi-qol":{"effectActivation":false},"midiProperties":{"nodam":false,"fulldam":false,"halfdam":false,"rollOther":false,"critOther":false,"magicdam":false,"magiceffect":false,"concentration":false,"toggleEffect":false,"ignoreTotalCover":false},"core":{"sourceId":"Actor.ZhhF2ZWDPIY2g3KI.Item.C2MFK8tsznV4ryvc"}},"img":"icons/magic/light/explosion-star-blue.webp","effects":[],"_stats":{"systemId":"dnd5e","systemVersion":"2.0.3","coreVersion":"10.291","createdTime":1669500366062,"modifiedTime":1671041494354,"lastModifiedBy":"npmYF618vZgxA5SD"},"ownership":{"default":0,"npmYF618vZgxA5SD":3},"folder":null,"sort":0,"_id":"SjenB4LwmEUHx8q2"}
{"type":"spell","system":{"description":{"value":"<p>A creature you touch becomes @Compendium[dnd5e.rules.w7eitkpD7QQTB6j0]{invisible} until the spell ends. Anything the target is wearing or carrying is @Compendium[dnd5e.rules.w7eitkpD7QQTB6j0]{invisible} as long as it is on the target's person. The spell ends for a target that attacks or casts a spell.</p>\n<p><strong>At Higher Levels.</strong> When you cast this spell using a spell slot of 3rd level or higher, you can target one additional creature for each slot level above 2nd.</p>","chat":"","unidentified":""},"source":"Basic Rules, Player's Handbook pg 254","activation":{"type":"action","cost":1,"condition":""},"duration":{"value":"1","units":"hour"},"cover":null,"target":{"value":null,"width":null,"units":"","type":"creature"},"range":{"value":null,"long":null,"units":"touch"},"uses":{"value":null,"max":"","per":"","recovery":""},"consume":{"type":"","target":"","amount":null},"ability":"","actionType":"util","attackBonus":"","chatFlavor":"","critical":{"threshold":null,"damage":""},"damage":{"parts":[],"versatile":""},"formula":"","save":{"ability":"","dc":null,"scaling":"spell"},"level":2,"school":"ill","components":{"vocal":true,"somatic":true,"material":true,"ritual":false,"concentration":true},"materials":{"value":"an eyelash encased in gum arabic","consumed":false,"cost":0,"supply":0},"preparation":{"mode":"always","prepared":false},"scaling":{"mode":"none","formula":""}},"name":"Invisibility","flags":{"ddbimporter":{"id":138362,"definitionId":2159,"entityTypeId":435869154,"dndbeyond":{"lookup":"classSpell","class":"Bard","level":3,"characterClassId":125417645,"spellLevel":2,"ability":"cha","mod":3,"dc":13,"cantripBoost":false,"overrideDC":false,"id":138362,"entityTypeId":435869154,"healingBoost":0,"usesSpellSlot":true},"originalName":"Invisibility","sources":[{"sourceId":1,"pageNumber":null,"sourceType":2},{"sourceId":2,"pageNumber":254,"sourceType":1}],"tags":["Buff"],"version":"3.3.14","importId":"oylano4snTIL8lbm"},"midiProperties":{"magicdam":true,"magiceffect":true},"spell-class-filter-for-5e":{"parentClass":"bard"},"core":{"sourceId":"Actor.Nv3mEVKCixzI4yXI.Item.3BwLstpomzv40PXj"}},"img":"icons/magic/air/fog-gas-smoke-dense-gray.webp","effects":[{"label":"Invisibility","icon":"icons/magic/air/fog-gas-smoke-dense-gray.webp","origin":"Actor.kjhBrs3htMDQcsr5.Item.HB8GxQ5w44HG2n95","duration":{"seconds":3600,"startTime":null,"combat":null,"rounds":null,"turns":null,"startRound":null,"startTurn":null},"disabled":false,"_id":"7gAV4djfLhi26WJf","changes":[],"tint":null,"transfer":false,"flags":{"dfreds-convenient-effects":{"description":""},"effective-transferral":{"transferBlock":{"button":false,"chat":false,"displayCard":false},"transferrable":{"self":true,"target":true}},"dae":{"selfTarget":false,"selfTargetAlways":false,"stackable":"none","durationExpression":"","macroRepeat":"none","specialDuration":[]},"core":{"statusId":""},"effectmacro":{"onCreate":{"script":"let params =\n[{\n    filterType: \"adjustment\",\n    filterId: \"myAdjust\",\n    saturation: 1,\n    brightness: 1,\n    contrast: 1,\n    gamma: 1,\n    red: 0.2,\n    green: 0.2,\n    blue: 0.2,\n    alpha: 1,\n    animated:\n    {\n        alpha: \n        { \n           active: true, \n           loopDuration: 2000, \n           animType: \"syncCosOscillation\",\n           val1: 0.35,\n           val2: 0.75 }\n    }\n}];\n\nawait TokenMagic.addUpdateFiltersOnSelected(params);"},"onDelete":{"script":"await TokenMagic.deleteFilters(token, \"myAdjust\");"}}}}],"ownership":{"default":0,"YCF2Heb7DMHDaF2f":3},"_stats":{"systemId":"dnd5e","systemVersion":"2.1.5","coreVersion":"10.291","createdTime":1677791717815,"modifiedTime":1678559253718,"lastModifiedBy":"YCF2Heb7DMHDaF2f"},"folder":null,"sort":0,"_id":"WETFzkWPaYcIRON8"}
{"type":"spell","system":{"description":{"value":"<p>You call forth the spirit of a construct. It manifests in an unoccupied space that you can see within range. This corporeal form uses the Construct Spirit stat block. When you cast the spell, choose a material: Clay, Metal, or Stone. The creature resembles a golem or a modron (your choice) made of the chosen material, which determines certain traits in its stat block. The creature disappears when it drops to 0 hit points or when the spell ends.</p>\n<p>The creature is an ally to you and your companions. In combat, the creature shares your initiative count, but it takes its turn immediately after yours. It obeys your verbal commands (no action required by you). If you don’t issue any, it takes the Dodge action and uses its move to avoid danger.</p>\n<p><em><strong>At Higher Levels.</strong></em> When you cast this spell using a spell slot of 4th level or higher, use the higher level wherever the spell’s level appears in the stat block.</p>\n<div class=\"Basic-Text-Frame stat-block-finder\">\n<p class=\"Stat-Block-Styles_Stat-Block-Title\">CONSTRUCT Spirit</p>\n<p class=\"Stat-Block-Styles_Stat-Block-Metadata\">Medium construct</p>\n<p class=\"Stat-Block-Styles_Stat-Block-Data\"><strong>Armor Class</strong> 13 + the level of the spell (natural armor)</p>\n<p class=\"Stat-Block-Styles_Stat-Block-Data\"><strong>Hit Points</strong> 40 + 15 for each spell level above 4th</p>\n<p class=\"Stat-Block-Styles_Stat-Block-Data\"><strong>Speed</strong> 30 ft.</p>\n<div class=\"stat-block-ability-scores\">\n<div class=\"stat-block-ability-scores-stat\">\n<div class=\"stat-block-ability-scores-heading\">STR</div>\n<div class=\"stat-block-ability-scores-data\"><span class=\"stat-block-ability-scores-score\">18</span> <span class=\"stat-block-ability-scores-modifier\">(+4)</span></div>\n</div>\n<div class=\"stat-block-ability-scores-stat\">\n<div class=\"stat-block-ability-scores-heading\">DEX</div>\n<div class=\"stat-block-ability-scores-data\"><span class=\"stat-block-ability-scores-score\">10</span> <span class=\"stat-block-ability-scores-modifier\">(+0)</span></div>\n</div>\n<div class=\"stat-block-ability-scores-stat\">\n<div class=\"stat-block-ability-scores-heading\">CON</div>\n<div class=\"stat-block-ability-scores-data\"><span class=\"stat-block-ability-scores-score\">18</span> <span class=\"stat-block-ability-scores-modifier\">(+4)</span></div>\n</div>\n<div class=\"stat-block-ability-scores-stat\">\n<div class=\"stat-block-ability-scores-heading\">INT</div>\n<div class=\"stat-block-ability-scores-data\"><span class=\"stat-block-ability-scores-score\">14</span> <span class=\"stat-block-ability-scores-modifier\">(+2)</span></div>\n</div>\n<div class=\"stat-block-ability-scores-stat\">\n<div class=\"stat-block-ability-scores-heading\">WIS</div>\n<div class=\"stat-block-ability-scores-data\"><span class=\"stat-block-ability-scores-score\">11</span> <span class=\"stat-block-ability-scores-modifier\">(+0)</span></div>\n</div>\n<div class=\"stat-block-ability-scores-stat\">\n<div class=\"stat-block-ability-scores-heading\">CHA</div>\n<div class=\"stat-block-ability-scores-data\">5 <span class=\"stat-block-ability-scores-modifier\">(-3)</span></div>\n</div>\n</div>\n<p class=\"Stat-Block-Styles_Stat-Block-Data\"><strong>Damage Resistances</strong> poison</p>\n<p class=\"Stat-Block-Styles_Stat-Block-Data\"><strong>Condition Immunities</strong> charmed, exhaustion, frightened, @Compendium[dnd5e.rules.w7eitkpD7QQTB6j0]{incapacitated}, @Compendium[dnd5e.rules.w7eitkpD7QQTB6j0]{paralyzed}, @Compendium[dnd5e.rules.w7eitkpD7QQTB6j0]{petrified}, @Compendium[dnd5e.rules.w7eitkpD7QQTB6j0]{poisoned}</p>\n<p class=\"Stat-Block-Styles_Stat-Block-Data\"><strong>Senses</strong> @Compendium[dnd5e.rules.eVtpEGXjA2tamEIJ]{darkvision} 60 ft., passive @Compendium[dnd5e.rules.0AGfrwZRzSG0vNKb]{Perception} 10</p>\n<p class=\"Stat-Block-Styles_Stat-Block-Data\"><strong>Languages</strong> understands the languages you speak</p>\n<p class=\"Stat-Block-Styles_Stat-Block-Data-Last\"><strong>Challenge</strong> — <strong>Proficiency Bonus</strong> equals your bonus</p>\n<p><em><strong>Heated Body (Metal Only).</strong></em> A creature that touches the construct or hits it with a melee attack while within 5 feet of it takes 1d10 fire damage.</p>\n<p><em><strong>Stony Lethargy (Stone Only).</strong></em> When a creature the construct can see starts its turn within 10 feet of the construct, the construct can force it to make a Wisdom saving throw against your spell save DC. On a failed save, the target can’t use reactions and its speed is halved until the start of its next turn.</p>\n<p class=\"Stat-Block-Styles_Stat-Block-Heading\">Actions</p>\n<p class=\"Stat-Block-Styles_Stat-Block-Body\"><em><strong>Multiattack.</strong></em> The construct makes a number of attacks equal to half this spell’s level (rounded down).</p>\n<p class=\"Stat-Block-Styles_Stat-Block-Body\"><em><strong>Slam.</strong> Melee Weapon Attack:</em> your spell attack modifier to hit, reach 5 ft., one target. <em>Hit:</em> 1d8 + 4 + the spell’s level bludgeoning damage.</p>\n<p class=\"Stat-Block-Styles_Stat-Block-Heading\">Reactions</p>\n<p class=\"Stat-Block-Styles_Stat-Block-Body\"><em><strong>Berserk Lashing (Clay Only).</strong></em> When the construct takes damage, it makes a slam attack against a random creature within 5 feet of it. If no creature is within reach, the construct moves up to half its speed toward an enemy it can see, without provoking opportunity attacks.</p>\n</div>","chat":"","unidentified":""},"source":"Tasha’s Cauldron of Everything pg 111","activation":{"type":"action","cost":1,"condition":""},"duration":{"value":"1","units":"hour"},"cover":null,"target":{"value":null,"width":null,"units":"","type":""},"range":{"value":90,"long":null,"units":"ft"},"uses":{"value":null,"max":"","per":"","recovery":""},"consume":{"type":"","target":"","amount":null},"ability":"","actionType":"other","attackBonus":"","chatFlavor":"","critical":{"threshold":null,"damage":""},"damage":{"parts":[],"versatile":""},"formula":"","save":{"ability":"","dc":null,"scaling":"spell"},"level":4,"school":"con","components":{"vocal":true,"somatic":true,"material":true,"ritual":false,"concentration":true},"materials":{"value":"an ornate stone and metal lockbox worth at least 400 gp","consumed":false,"cost":400,"supply":0},"preparation":{"mode":"prepared","prepared":true},"scaling":{"mode":"none","formula":""}},"name":"Summon Construct","flags":{"ddbimporter":{"id":5854968,"definitionId":721195,"entityTypeId":435869154,"dndbeyond":{"lookup":"generic","lookupName":"generic","level":null,"castAtLevel":null},"originalName":"Summon Construct","sources":[{"sourceId":67,"pageNumber":111,"sourceType":1}],"tags":["Summoning"],"version":"3.1.22"},"core":{"sourceId":"Compendium.world.ddb-spelljammer-spells.bDfXnfrb0C4nWu9p"},"itemacro":{"macro":{"name":"Summon Construct","type":"script","scope":"global","command":"/**\n * Item-Macro Macro Summon Construct\n * \n * https://www.dndbeyond.com/spells/summon-construct\n */\n\nconst macroLabel = item.name;\nconst textureClay = \"modules/Tablerules/icons/magic/summons/constructSpiritClay.png\";\nconst textureMetal = \"modules/Tablerules/icons/magic/summons/constructSpiritMetal.png\";\nconst textureStone = \"modules/Tablerules/icons/magic/summons/constructSpiritStone.png\";\n\nconst formClay = \"Clay Construct\";\nconst formMetal = \"Metal Construct\";\nconst formStone = \"Stone Construct\";\n\nconst scaleClay = 1;\nconst scaleMetal = 1;\nconst scaleStone = 1;\n\n\nconst summonerDc = actor.system.attributes.spelldc;\nconst summonerAttack = summonerDc - 8;\nconst level = await warpgate.dnd5e.rollItem(item);\nif (!level > 0) {\n    return;\n}\n\n\n/* Prompt the user for which type of spirit to summon */\nconst buttonData = {\n    buttons: [{\n        label: formClay,\n        value: {\n            token: { name: formClay },\n            actor: { name: formClay },\n            embedded: {\n                Item: {\n                    \"Heated Body\": warpgate.CONST.DELETE,\n                    \"Stone Lethargy\": warpgate.CONST.DELETE\n                }\n            }\n        }\n    }, {\n        label: formMetal,\n        value: {\n            actor: { name: formMetal },\n            token: { name: formMetal },\n            embedded: {\n                Item: {\n                    \"Stone Lethargy\": warpgate.CONST.DELETE,\n                    \"Berserk Lashing\": warpgate.CONST.DELETE\n                }\n            }\n        }\n    }, {\n        label: formStone,\n        value: {\n            actor: { name: formStone },\n            token: { name: formStone },\n            embedded: {\n                Item: {\n                    \"Heated Body\": warpgate.CONST.DELETE,\n                    \"Berserk Lashing\": warpgate.CONST.DELETE\n                }\n            }\n        }\n    }\n    ], title: \"Which version?\"\n};\n\nlet spirit = await warpgate.buttonDialog(buttonData);\n\n/* Craft the updates that are common to all spirits */\nlet updates = {\n    token: {\n        \"displayName\": CONST.TOKEN_DISPLAY_MODES.HOVER,\n        \"flags.Tablerules.spellLevel\": level\n    },\n    actor: {\n        'system.attributes.ac.flat': 13 + level,\n        'system.attributes.hp': { value: 40 + 15 * (level - 4), max: 40 + 15 * (level - 4) },\n        \"system.details.cr\": actor.system.attributes.prof,\n        \"system.attributes.prof\": actor.system.attributes.prof,\n        \"flags.world.summoned.item\": item.uuid,\n        \"flags.world.summoned.actor\": actor.uuid\n    },\n    embedded: {\n        Item: {\n            \"Multiattack\": { name: `Multiattack (${Math.floor(level / 2)} attacks)` },\n            \"Slam\": {\n                'system.damage.parts': [[`1d8 + 4 + ${level}`, \"bludgeoning\"]],\n                'system.attackBonus': `- @mod - @prof + ${summonerAttack}`,\n            },\n            \"Stone Lethargy\": {\n                'system.save.dc': summonerDc\n            }\n        }\n    }\n}\n\n/* update variants */\nif (spirit.actor.name === formClay) {\n    updates[\"actor.img\"] = textureClay;\n    updates[\"token.texture.src\"] = textureClay;\n    updates[\"token.texture.scaleX\"] = scaleClay;\n    updates[\"token.texture.scaleY\"] = scaleClay;\n}\n\nif (spirit.actor.name === formMetal) {\n    updates[\"actor.img\"] = textureMetal;\n    updates[\"token.texture.src\"] = textureMetal;\n    updates[\"token.texture.scaleX\"] = scaleMetal;\n    updates[\"token.texture.scaleY\"] = scaleMetal;\n}\n\nif (spirit.actor.name === formStone) {\n    updates[\"actor.img\"] = textureStone;\n    updates[\"token.texture.src\"] = textureStone;\n    updates[\"token.texture.scaleX\"] = scaleStone;\n    updates[\"token.texture.scaleY\"] = scaleStone;\n}\n\n/* Combine the general and specific updates */\nupdates = mergeObject(updates, spirit);\n\nconst spawnIds = await warpgate.spawn(\"Construct Spirit\", updates);\n//const spawn = canvas.tokens.get(spawnIds[0]); // or canvas.scene.tokens.get(id) to get the document immediately\n\nif (spirit.actor.name === formStone) {\n    const token = canvas.tokens.get(spawnIds[0]);\n    // create and attach MeasuredTemplate\n    const data = {\n        distance: 12.5,\n        borderColor: \"#52004b\",\n        fillColor: \"#940088\",\n        x: token.center.x,\n        y: token.center.y\n    };\n    foundry.utils.setProperty(data, \"flags.dnd5e.origin\", item.uuid);\n    await canvas.scene.createEmbeddedDocuments(\"MeasuredTemplate\", [data]);\n\n    const template = canvas.scene.templates.find(t => t.flags?.dnd5e?.origin === item.uuid);\n    await tokenAttacher.attachElementsToToken([template], token);\n}","author":"YCF2Heb7DMHDaF2f","_id":null,"img":"icons/svg/dice-target.svg","folder":null,"sort":0,"ownership":{"default":0},"flags":{},"_stats":{"systemId":null,"systemVersion":null,"coreVersion":null,"createdTime":null,"modifiedTime":null,"lastModifiedBy":null}}}},"img":"icons/environment/creatures/golem-stone-purple.webp","effects":[],"_stats":{"systemId":"dnd5e","systemVersion":"2.1.5","coreVersion":"10.291","createdTime":1667686349780,"modifiedTime":1678716551485,"lastModifiedBy":"YCF2Heb7DMHDaF2f"},"ownership":{"default":0,"npmYF618vZgxA5SD":3,"YCF2Heb7DMHDaF2f":3},"folder":null,"sort":0,"_id":"XcZhPluefXQytcUq"}
{"type":"spell","system":{"description":{"value":"<p>You bless up to three creatures of your choice within range. Whenever a target makes an attack roll or a saving throw before the spell ends, the target can roll a d4 and add the number rolled to the attack roll or saving throw.</p>\n<p><strong>At Higher Levels.</strong> When you cast this spell using a spell slot of 2nd level or higher, you can target one additional creature for each slot level above 1st.</p>","chat":"","unidentified":""},"source":"Basic Rules, Player's Handbook pg 219","activation":{"type":"action","cost":1,"condition":""},"duration":{"value":1,"units":"minute"},"target":{"value":3,"width":null,"units":"","type":"creature"},"range":{"value":30,"long":null,"units":"ft"},"uses":{"value":null,"max":"","per":"","recovery":""},"consume":{"type":"","target":"","amount":null},"ability":"","actionType":"util","attackBonus":0,"chatFlavor":"","critical":{"threshold":null,"damage":""},"damage":{"parts":[],"versatile":""},"formula":"","save":{"ability":"","dc":null,"scaling":"spell"},"level":1,"school":"enc","components":{"value":"a sprinkling of holy water","vocal":true,"somatic":true,"material":true,"ritual":false,"concentration":true},"materials":{"value":"a sprinkling of holy water","consumed":false,"cost":0,"supply":0},"preparation":{"mode":"always","prepared":true},"scaling":{"mode":"none","formula":""}},"name":"Bless","flags":{"ddbimporter":{"id":136126,"definitionId":2016,"entityTypeId":435869154,"dndbeyond":{"lookup":"classSpell","class":"Cleric","level":10,"characterClassId":116804531,"spellLevel":1,"ability":"wis","mod":3,"dc":15,"cantripBoost":false,"overrideDC":false,"id":136126,"entityTypeId":435869154,"healingBoost":0,"usesSpellSlot":true},"originalName":"Bless","sources":[{"sourceId":1,"pageNumber":null,"sourceType":2},{"sourceId":2,"pageNumber":219,"sourceType":1}],"tags":["Buff"],"version":"3.2.4","importId":"HK5s4atPMmweQr7v"},"spell-class-filter-for-5e":{"parentClass":"cleric"},"midi-qol":{"effectActivation":false,"forceCEOn":false},"midiProperties":{"nodam":false,"fulldam":false,"halfdam":false,"rollOther":false,"critOther":false,"magicdam":false,"magiceffect":false,"concentration":false,"toggleEffect":false,"ignoreTotalCover":false},"core":{"sourceId":"Actor.eRdyUWBs84M14oVO.Item.NWATHmrIMp4A5gBK"}},"img":"icons/magic/life/cross-worn-green.webp","effects":[{"label":"Bless","icon":"icons/magic/life/cross-worn-green.webp","origin":"Actor.eRdyUWBs84M14oVO.Item.NWATHmrIMp4A5gBK","duration":{"seconds":60,"startTime":null,"combat":null,"rounds":null,"turns":null,"startRound":null,"startTurn":null},"disabled":false,"_id":"oh2s8CE7ILvwiCJs","changes":[{"key":"system.bonuses.abilities.save","mode":2,"value":"+1d4","priority":20},{"key":"system.bonuses.All-Attacks","mode":2,"value":"+1d4","priority":20}],"tint":null,"transfer":false,"flags":{"effective-transferral":{"transferBlock":{"button":false,"chat":false,"displayCard":false}},"dae":{"selfTarget":false,"selfTargetAlways":false,"stackable":"none","durationExpression":"","macroRepeat":"none","specialDuration":[]},"core":{"statusId":""}}}],"ownership":{"default":0,"npmYF618vZgxA5SD":3},"_stats":{"systemId":"dnd5e","systemVersion":"2.0.3","coreVersion":"10.291","createdTime":1669815040080,"modifiedTime":1671041577079,"lastModifiedBy":"npmYF618vZgxA5SD"},"folder":null,"sort":0,"_id":"ZyTTysGFWVOLfhD2"}
{"type":"spell","system":{"description":{"value":"<p>A shimmering field appears and surrounds a creature of your choice within range, granting it a +2 bonus to AC for the duration.</p>","chat":"","unidentified":""},"source":"Basic Rules, Player's Handbook pg 275","activation":{"type":"bonus","cost":1,"condition":""},"duration":{"value":10,"units":"minute"},"target":{"value":1,"width":null,"units":"","type":"creature"},"range":{"value":60,"long":null,"units":"ft"},"uses":{"value":null,"max":"","per":"","recovery":""},"consume":{"type":"","target":"","amount":null},"ability":"wis","actionType":"util","attackBonus":0,"chatFlavor":"","critical":{"threshold":null,"damage":""},"damage":{"parts":[],"versatile":""},"formula":"","save":{"ability":"","dc":null,"scaling":"spell"},"level":1,"school":"abj","components":{"value":"a small parchment with a bit of holy text written on it","vocal":true,"somatic":true,"material":true,"ritual":false,"concentration":true},"materials":{"value":"a small parchment with a bit of holy text written on it","consumed":false,"cost":0,"supply":0},"preparation":{"mode":"prepared","prepared":true},"scaling":{"mode":"none","formula":""}},"name":"Shield of Faith","flags":{"ddbimporter":{"id":138705,"definitionId":2248,"entityTypeId":435869154,"dndbeyond":{"lookup":"classSpell","class":"Cleric","level":1,"characterClassId":118182112,"spellLevel":1,"ability":"wis","mod":2,"dc":12,"cantripBoost":false,"overrideDC":false,"id":138705,"entityTypeId":435869154,"healingBoost":2,"usesSpellSlot":true},"originalName":"Shield of Faith","sources":[{"sourceId":1,"pageNumber":null,"sourceType":2},{"sourceId":2,"pageNumber":275,"sourceType":1}],"tags":["Buff","Warding"],"version":"3.2.4","importId":"XpwygIbTgqS9zbhX"},"spell-class-filter-for-5e":{"parentClass":"cleric"},"midi-qol":{"effectActivation":false,"forceCEOn":false},"midiProperties":{"nodam":false,"fulldam":false,"halfdam":false,"rollOther":false,"critOther":false,"magicdam":false,"magiceffect":false,"concentration":false,"toggleEffect":false,"ignoreTotalCover":false,"autoFailFriendly":false,"offHandWeapon":false},"core":{"sourceId":"Actor.jItLUReNSJ6NAwL3.Item.uOwpX3Orz3RHnhKB"}},"img":"icons/magic/defensive/shield-barrier-flaming-diamond-blue-yellow.webp","effects":[{"label":"Shield of Faith","icon":"icons/magic/defensive/shield-barrier-flaming-diamond-blue-yellow.webp","origin":"Actor.3IDJAqCn3WKSy8xf.Item.uOwpX3Orz3RHnhKB","duration":{"seconds":600,"startTime":null,"combat":null,"rounds":null,"turns":null,"startRound":null,"startTurn":null},"disabled":false,"_id":"3mEM10uASGd484fH","changes":[{"key":"system.attributes.ac.bonus","mode":2,"value":"+2","priority":20}],"tint":null,"transfer":false,"flags":{"effectmacro":{"onCreate":{"script":"let params =\n[{\n    filterType: \"glow\",\n    filterId: \"ShieldOfFaith\",\n    outerStrength: 4,\n    innerStrength: 0,\n    color: 0x5099DD,\n    quality: 0.5,\n    padding: 10,\n    animated:\n    {\n        color: \n        {\n           active: true, \n           loopDuration: 3000, \n           animType: \"colorOscillation\", \n           val1:0xfff24f, \n           val2:0xfffabc\n        }\n    }\n}];\n\nawait TokenMagic.addUpdateFilters(token, params);"},"onDelete":{"script":"await TokenMagic.deleteFilters(token, \"ShieldOfFaith\");"}},"effective-transferral":{"transferBlock":{"button":false,"chat":false,"displayCard":false}},"dae":{"selfTarget":false,"selfTargetAlways":false,"stackable":"none","durationExpression":"","macroRepeat":"none","specialDuration":[]},"core":{"statusId":""}}}],"_stats":{"systemId":"dnd5e","systemVersion":"2.0.3","coreVersion":"10.291","createdTime":1669694313364,"modifiedTime":1671041511188,"lastModifiedBy":"npmYF618vZgxA5SD"},"ownership":{"default":0,"npmYF618vZgxA5SD":3},"folder":null,"sort":0,"_id":"aBCrWIv0N7jegL70"}
{"type":"spell","system":{"description":{"value":"<p>An @Compendium[dnd5e.rules.w7eitkpD7QQTB6j0]{invisible} barrier of magical force appears and protects you. Until the start of your next turn, you have a +5 bonus to AC, including against the triggering attack, and you take no damage from <strong>magic missile</strong>.</p>","chat":"","unidentified":""},"source":"Basic Rules, Player's Handbook pg 275","activation":{"type":"reaction","cost":1,"condition":"which you take when you are hit by an attack or targeted by the magic missile spell"},"duration":{"value":"1","units":"round"},"cover":null,"target":{"value":null,"width":null,"units":"","type":"self"},"range":{"value":null,"long":null,"units":"self"},"uses":{"value":null,"max":"","per":"","recovery":""},"consume":{"type":"","target":"","amount":null},"ability":"","actionType":"other","attackBonus":"","chatFlavor":"","critical":{"threshold":null,"damage":""},"damage":{"parts":[],"versatile":""},"formula":"","save":{"ability":"","dc":null,"scaling":"spell"},"level":1,"school":"abj","components":{"vocal":true,"somatic":true,"material":false,"ritual":false,"concentration":false},"materials":{"value":"","consumed":false,"cost":0,"supply":0},"preparation":{"mode":"prepared","prepared":true},"scaling":{"mode":"none","formula":""}},"name":"Shield","flags":{"ddbimporter":{"id":138703,"definitionId":2247,"entityTypeId":435869154,"dndbeyond":{"lookup":"classSpell","class":"Wizard","level":1,"characterClassId":108474208,"spellLevel":1,"ability":"int","mod":3,"dc":13,"cantripBoost":false,"overrideDC":false,"id":138703,"entityTypeId":435869154,"healingBoost":0,"usesSpellSlot":true},"originalName":"Shield","sources":[{"sourceId":1,"pageNumber":null,"sourceType":2},{"sourceId":2,"pageNumber":275,"sourceType":1}],"tags":["Warding"],"version":"3.2.4","importId":"EgKCIFc1BkVC5JrI"},"spell-class-filter-for-5e":{"parentClass":"wizard"},"midi-qol":{"effectActivation":false,"forceCEOn":false},"midiProperties":{"nodam":false,"fulldam":false,"halfdam":false,"rollOther":false,"critOther":false,"magicdam":false,"magiceffect":false,"concentration":false,"toggleEffect":false,"ignoreTotalCover":false,"autoFailFriendly":false,"offHandWeapon":false},"core":{"sourceId":"Actor.ZhhF2ZWDPIY2g3KI.Item.zNiQsoM34KovpPu5"}},"img":"icons/magic/defensive/shield-barrier-glowing-triangle-magenta.webp","effects":[{"label":"Shield","icon":"icons/magic/defensive/shield-barrier-glowing-triangle-magenta.webp","origin":"Actor.6jtmp2Joatnf8PuB.Item.zNiQsoM34KovpPu5","duration":{"rounds":null,"startTime":null,"seconds":null,"combat":null,"turns":null,"startRound":null,"startTurn":null},"disabled":false,"_id":"WRPIITgsqjAgKcpl","changes":[{"key":"system.attributes.ac.bonus","mode":2,"value":"+5","priority":20}],"tint":null,"transfer":false,"flags":{"effective-transferral":{"transferBlock":{"button":false,"chat":false,"displayCard":false},"transferrable":{"self":true,"target":true,"always":false}},"dae":{"selfTarget":false,"selfTargetAlways":false,"stackable":"none","durationExpression":"","macroRepeat":"none","specialDuration":["turnStart"]},"core":{"statusId":""},"effectmacro":{"onCreate":{"script":"let params =\n[{\n    filterType: \"glow\",\n    filterId: \"Shield\",\n    outerStrength: 4,\n    innerStrength: 0,\n    color: 0x5099DD,\n    quality: 0.5,\n    padding: 10,\n    animated:\n    {\n        color: \n        {\n           active: true, \n           loopDuration: 3000, \n           animType: \"colorOscillation\", \n           val1:0x5099DD, \n           val2:0x90EEFF\n        }\n    }\n}];\n\nawait TokenMagic.addUpdateFiltersOnSelected(params);"},"onDelete":{"script":"await TokenMagic.deleteFilters(token, \"Shield\");"}},"dfreds-convenient-effects":{"description":""}}}],"_stats":{"systemId":"dnd5e","systemVersion":"2.1.5","coreVersion":"10.291","createdTime":1669500366056,"modifiedTime":1678951827026,"lastModifiedBy":"YCF2Heb7DMHDaF2f"},"ownership":{"default":0,"npmYF618vZgxA5SD":3,"YCF2Heb7DMHDaF2f":3},"folder":null,"sort":0,"_id":"j47pi9jeEO2BK3Pf"}
{"type":"spell","system":{"description":{"value":"<p>Healing energy radiates from you in an aura with a 30-foot radius. Until the spell ends, the aura moves with you, centered on you. You can use a bonus action to cause one creature in the aura (including you) to regain 2d6 hit points.</p>","chat":"","unidentified":""},"source":"Player's Handbook pg 216","activation":{"type":"action","cost":1,"condition":""},"duration":{"value":"1","units":"minute"},"cover":null,"target":{"value":30,"width":null,"units":"ft","type":"sphere"},"range":{"value":null,"long":null,"units":"self"},"uses":{"value":null,"max":"","per":"","recovery":""},"consume":{"type":"","target":"","amount":null},"ability":"","actionType":"heal","attackBonus":"","chatFlavor":"","critical":{"threshold":null,"damage":""},"damage":{"parts":[["2d6[healing - You can use a bonus action to target one creature in the aura (including you)]","healing"]],"versatile":""},"formula":"","save":{"ability":"","dc":null,"scaling":"spell"},"level":3,"school":"evo","components":{"vocal":true,"somatic":false,"material":false,"ritual":false,"concentration":true},"materials":{"value":"","consumed":false,"cost":0,"supply":0},"preparation":{"mode":"prepared","prepared":true},"scaling":{"mode":"none","formula":""}},"name":"Aura of Vitality","flags":{"ddbimporter":{"id":114228,"definitionId":2333,"entityTypeId":341470558,"dndbeyond":{"lookup":"classSpell","class":"Cleric","level":10,"characterClassId":124598396,"spellLevel":3,"ability":"wis","mod":3,"dc":15,"cantripBoost":false,"overrideDC":false,"id":114228,"entityTypeId":341470558,"healingBoost":0,"usesSpellSlot":true},"originalName":"Aura of Vitality","sources":[{"sourceId":2,"pageNumber":216,"sourceType":1}],"tags":["Healing"],"version":"3.3.8","importId":"HuXnFYz1RK9PZoO1"},"spell-class-filter-for-5e":{"parentClass":"cleric"},"itemacro":{"macro":{"name":"Aura of Vitality","type":"script","scope":"global","command":"/**\n * Item-Macro (planned) for Aura of Vitality Item (Spell)\n * \n * https://www.dndbeyond.com/spells/aura-of-vitality\n * \n * Aura of Vitality Issue #31\n */\n\nconst macroLabel = \"Aura of Vitality\";\nconst icon = item.img; // \"icons/magic/air/air-burst-spiral-pink.webp\";\nconst flagKey = \"flags.world.auraOfVitality\";\nconst checkRange = false;\nconst useDistance3D = true;\nconst useMouseHover = false;\n\nlet templates = canvas.scene.templates.filter(t => t.flags.dnd5e !== undefined).filter(t => t.flags.dnd5e.origin === item.uuid);\nlet template = templates[0];\n\nlet target = null;\n\n// check if the \"aura\" is up (if there is the MeasuringTemplate with our flag)\nif (typeof template !== \"undefined\") {\n\n    if (useMouseHover) {\n        // check for hovered and try to heal if valid\n        target = canvas.tokens.hover;\n        if (canvas.tokens.hover === null) {\n            ui.notifications.warn(`${macroLabel}, Actor hovered ${actor?.name} invalid target (no Actor found).`);\n            return;\n        }\n    } else {\n        target = game.user.targets.first();\n    }\n\n    // check range and abort if to far, for corner-cases roll in dice tray or temporarily move one of the tokens.\n    const tokenSource = token;\n    const tokenTarget = target;\n\n    if (checkRange) {\n        const distance = Math.round(canvas.grid.measureDistance(tokenSource, tokenTarget, { gridSpaces: true }));\n        const distance3D = Math.round(Math.sqrt(distance * distance + (tokenSource.document.elevation - tokenTarget.document.elevation) * (tokenSource.document.elevation - tokenTarget.document.elevation)));\n\n        if ((useDistance3D ? distance3D : distance) > 30) {\n            ui.notifications.warn(\n                `Distance between ${token.actor.name} and ${target.actor.name} is ${(useDistance3D ? distance3D : distance)}. Expected distance<=30.`,\n                { permanent: true }\n            );\n\n            return;\n        }\n    }\n\n    const effect = actor.effects.find(e => e.flags?.world?.origin === item.uuid);\n    const spellLevel = effect.flags.world.spellLevel;\n\n    const isDiscipleOfLife = actor.classes?.cleric?.subclass?.identifier === \"life-domain\";\n    let bonusHealing = 0;\n    if (isDiscipleOfLife) {\n        bonusHealing += spellLevel + 2;\n    }\n\n    const bonusHealingString = bonusHealing !== 0 ? `+${bonusHealing}` : \"\";\n\n    const dice = target.actor.items.filter(i => i.name === (\"Eldritch Invocations: Gift of the Ever-Living Ones\")).length > 0 ? \"12\" : \"2d6\";\n    const roll = await new Roll(`${dice}${bonusHealing !== 0 ? bonusHealingString : \"\"}`, actor.getRollData()).evaluate({ async: true });\n    const hpHealed = roll.total;\n    roll.toMessage({\n        speaker: ChatMessage.getSpeaker({ actor: token.actor }),\n        flavor: `${macroLabel}, healing ${target.name} for ${hpHealed}hp.`\n    });\n    const requestorData = [{ uuid: target.document.uuid, healing: hpHealed }];\n\n    // request healing\n    await Requestor.request({\n        title: `${macroLabel}`,\n        description: `healing ${target.name} for ${hpHealed}hp, ${effect.flags.world.charges} charges left.`,\n        img: icon,\n        whisper: [game.users.getName(\"Gamemaster\").id],\n        buttonData: [{\n            label: `${target.name.substr(0, 6)} +${hpHealed}[heal], ${effect.flags.world.charges} charges`,\n            limit: Requestor.LIMIT.ONCE,\n            permission: Requestor.PERMISSION.GM,\n            action: async () => {\n                for (let i = 0; i < this.requestorData.length; i++) {\n                    await canvas.tokens.placeables.find(t => t.document.uuid === this.requestorData[i].uuid).actor.applyDamage(-this.requestorData[i].healing)\n                }\n            },\n            requestorData: requestorData // what is here gets into this.<something>\n        }]\n    });\n\n\n    const charges = 10;\n    const effectData = { icon, label: `${macroLabel} (${charges})` };\n    foundry.utils.setProperty(effectData, \"flags.world.spellLevel\", spellLevel);\n    foundry.utils.setProperty(effectData, \"flags.world.charges\", 10);\n    foundry.utils.setProperty(effectData, \"flags.world.origin\", item.uuid);\n\n    await effect.update({\n        label: `${macroLabel} (${effect.flags.world.charges - 1})`,\n        \"flags.world.charges\": effect.flags.world.charges - 1\n    });\n\n    return;\n}\n\n// use the item (takes care of resources, ChatMessage), if returning null (i believe) return\nconst use = await item.use();\nif (!use) {\n    return;\n}\n\nconst DIV = document.createElement(\"DIV\");\nDIV.innerHTML = use.content;\nconst spellLevel = Number(DIV.firstChild.dataset.spellLevel);\n\n\n// select the MeasuringTemplate created by the Item.Spell use() and modify\ntemplate = canvas.scene.templates.filter(t => t.flags.dnd5e !== undefined).filter(t => t.flags.dnd5e.origin === item.uuid)[0];\n\nconst templateData = {\n    borderColor: \"#00800f\",\n    fillColor: \"#022400\",\n    x: token.center.x,\n    y: token.center.y\n};\nawait template.update(templateData);\nawait tokenAttacher.attachElementsToToken([template], token);\n\nconst charges = 10;\nconst effectData = { icon, label: `${macroLabel} (${charges})` };\nfoundry.utils.setProperty(effectData, \"flags.world.spellLevel\", spellLevel);\nfoundry.utils.setProperty(effectData, \"flags.world.charges\", 10);\nfoundry.utils.setProperty(effectData, \"flags.world.origin\", item.uuid);\nawait actor.createEmbeddedDocuments(\"ActiveEffect\", [effectData]);","author":"YCF2Heb7DMHDaF2f","_id":null,"img":"icons/svg/dice-target.svg","folder":null,"sort":0,"ownership":{"default":0},"flags":{},"_stats":{"systemId":null,"systemVersion":null,"coreVersion":null,"createdTime":null,"modifiedTime":null,"lastModifiedBy":null}}},"core":{"sourceId":"Actor.QLc7cJv6mcLw7ixj.Item.Rqf1728uAtt9fglH"}},"img":"icons/magic/life/cross-area-circle-green-white.webp","effects":[{"label":"Aura of Vitality","icon":"icons/magic/life/cross-area-circle-green-white.webp","origin":"Actor.QLc7cJv6mcLw7ixj.Item.Rqf1728uAtt9fglH","duration":{"seconds":60,"startTime":null,"combat":null,"rounds":null,"turns":null,"startRound":null,"startTurn":null},"disabled":false,"_id":"DudGC8XWDVNDAwkk","changes":[],"tint":null,"transfer":false,"flags":{}}],"ownership":{"default":0,"YCF2Heb7DMHDaF2f":3},"_stats":{"systemId":"dnd5e","systemVersion":"2.1.4","coreVersion":"10.291","createdTime":1676130280082,"modifiedTime":1676871652879,"lastModifiedBy":"YCF2Heb7DMHDaF2f"},"folder":null,"sort":0,"_id":"o765P2hrQacbcTvT"}
{"type":"spell","system":{"description":{"value":"<p>An @Compendium[dnd5e.rules.w7eitkpD7QQTB6j0]{invisible} barrier of magical force appears and protects you. Until the start of your next turn, you have a +5 bonus to AC, including against the triggering attack, and you take no damage from <strong>magic missile</strong>.</p>","chat":"","unidentified":""},"source":"Basic Rules, Player's Handbook pg 275","activation":{"type":"reaction","cost":1,"condition":"which you take when you are hit by an attack or targeted by the magic missile spell"},"duration":{"value":"1","units":"round"},"cover":null,"target":{"value":null,"width":null,"units":"","type":"self"},"range":{"value":null,"long":null,"units":"self"},"uses":{"value":null,"max":"","per":"","recovery":""},"consume":{"type":"","target":"","amount":null},"ability":"","actionType":"other","attackBonus":"","chatFlavor":"","critical":{"threshold":null,"damage":""},"damage":{"parts":[],"versatile":""},"formula":"","save":{"ability":"","dc":null,"scaling":"spell"},"level":1,"school":"abj","components":{"vocal":true,"somatic":true,"material":false,"ritual":false,"concentration":false},"materials":{"value":"","consumed":false,"cost":0,"supply":0},"preparation":{"mode":"prepared","prepared":false},"scaling":{"mode":"none","formula":""}},"name":"Shield","flags":{"ddbimporter":{"id":138703,"definitionId":2247,"entityTypeId":435869154,"dndbeyond":{"lookup":"classSpell","class":"Wizard","level":2,"characterClassId":124817896,"spellLevel":1,"ability":"int","mod":3,"dc":13,"cantripBoost":false,"overrideDC":false,"id":138703,"entityTypeId":435869154,"healingBoost":0,"usesSpellSlot":true},"originalName":"Shield","sources":[{"sourceId":1,"pageNumber":null,"sourceType":2},{"sourceId":2,"pageNumber":275,"sourceType":1}],"tags":["Warding"],"version":"3.3.8","importId":"hCa0W5gTxkWEg7lw"},"spell-class-filter-for-5e":{"parentClass":"wizard"},"core":{"sourceId":"Actor.pvWHemzJIHEPighO.Item.8svFBLGjOt9ETVQ1"}},"img":"icons/equipment/shield/kite-wooden-oak-glow.webp","effects":[{"label":"Shield","icon":"icons/equipment/shield/kite-wooden-oak-glow.webp","origin":"Actor.pvWHemzJIHEPighO.Item.8svFBLGjOt9ETVQ1","duration":{"rounds":null,"startTime":null,"seconds":null,"combat":null,"turns":null,"startRound":null,"startTurn":null},"disabled":false,"_id":"TRE7zREJuLxoZI3y","changes":[{"key":"system.attributes.ac.bonus","mode":2,"value":"+5","priority":20}],"tint":null,"transfer":false,"flags":{"effective-transferral":{"transferBlock":{"button":false,"chat":false,"displayCard":false},"transferrable":{"self":true,"target":true,"always":false}},"dae":{"selfTarget":false,"selfTargetAlways":false,"stackable":"none","durationExpression":"","macroRepeat":"none","specialDuration":["turnStart"]},"core":{"statusId":""},"effectmacro":{"onCreate":{"script":"let params =\n[{\n    filterType: \"field\",\n    filterId: \"shield\",\n    shieldType: 6,\n    gridPadding: 1.2,\n    color: 0x7090AA,\n    time: 0,\n    blend: 1,\n    intensity: 1,\n    lightAlpha: 1,\n    lightSize: 0.7,\n    scale: 1,\n    radius: 1,\n    chromatic: false,\n    zOrder: 512,\n    animated :\n    {\n      time : \n      { \n        active: true, \n        speed: 0.0015, \n        animType: \"move\" \n      }\n    }\n}];\n\nawait TokenMagic.addUpdateFiltersOnSelected(params);"},"onDelete":{"script":"await TokenMagic.deleteFilters(token, \"shield\");"}},"dfreds-convenient-effects":{"description":""}}}],"ownership":{"default":0,"npmYF618vZgxA5SD":3,"YCF2Heb7DMHDaF2f":3},"_stats":{"systemId":"dnd5e","systemVersion":"2.1.5","coreVersion":"10.291","createdTime":1676044486986,"modifiedTime":1678951877927,"lastModifiedBy":"YCF2Heb7DMHDaF2f"},"folder":null,"sort":0,"_id":"oTDZarYE1kMg0TYI"}
{"type":"spell","system":{"description":{"value":"<p>A flash of light streaks toward a creature of your choice within range. Make a ranged spell attack against the target. On a hit, the target takes 4d6 radiant damage, and the next attack roll made against this target before the end of your next turn has advantage, thanks to the mystical dim light glittering on the target until then.</p>\n<p><strong>At Higher Levels.</strong> When you cast this spell using a spell slot of 2nd level or higher, the damage increases by 1d6 for each slot level above 1st.</p>","chat":"","unidentified":""},"source":"Basic Rules, Player's Handbook pg 248","activation":{"type":"action","cost":1,"condition":""},"duration":{"value":1,"units":"round"},"target":{"value":1,"width":null,"units":"","type":"creature"},"range":{"value":120,"long":null,"units":"ft"},"uses":{"value":null,"max":"","per":"","recovery":""},"consume":{"type":"","target":"","amount":null},"ability":"","actionType":"rsak","attackBonus":"0","chatFlavor":"","critical":{"threshold":null,"damage":""},"damage":{"parts":[["4d6[radiant]","radiant"]],"versatile":""},"formula":"","save":{"ability":"","dc":null,"scaling":"spell"},"level":1,"school":"evo","components":{"value":"","vocal":true,"somatic":true,"material":false,"ritual":false,"concentration":false},"materials":{"value":"","consumed":false,"cost":0,"supply":0},"preparation":{"mode":"prepared","prepared":false},"scaling":{"mode":"level","formula":"1d6"}},"name":"Guiding Bolt","flags":{"ddbimporter":{"id":138023,"definitionId":2133,"entityTypeId":435869154,"dndbeyond":{"lookup":"classSpell","class":"Cleric","level":10,"characterClassId":116804531,"spellLevel":1,"ability":"wis","mod":3,"dc":15,"cantripBoost":false,"overrideDC":false,"id":138023,"entityTypeId":435869154,"healingBoost":0,"usesSpellSlot":true},"originalName":"Guiding Bolt","sources":[{"sourceId":1,"pageNumber":null,"sourceType":2},{"sourceId":2,"pageNumber":248,"sourceType":1}],"tags":["Damage","Buff"],"version":"3.2.4","importId":"HK5s4atPMmweQr7v"},"spell-class-filter-for-5e":{"parentClass":"cleric"},"midi-qol":{"fumbleThreshold":null,"effectActivation":false,"forceCEOn":false},"midiProperties":{"nodam":false,"fulldam":false,"halfdam":false,"rollOther":false,"critOther":false,"magicdam":false,"magiceffect":false,"concentration":false,"toggleEffect":false,"ignoreTotalCover":false},"core":{"sourceId":"Actor.eRdyUWBs84M14oVO.Item.uR59ZwbfhzSyhVep"}},"img":"icons/magic/fire/flame-burning-hand-purple.webp","effects":[{"label":"Guiding Bolt","icon":"icons/magic/fire/flame-burning-hand-purple.webp","origin":"Actor.eRdyUWBs84M14oVO.Item.uR59ZwbfhzSyhVep","duration":{"rounds":1,"startTime":null,"seconds":null,"combat":null,"turns":null,"startRound":null,"startTurn":null},"disabled":false,"_id":"8sNF4rAEjrzqPS6C","changes":[],"tint":null,"transfer":false,"flags":{"effectmacro":{"onCreate":{"script":"let params =\n[{\n    filterType: \"glow\",\n    filterId: \"GuidingBolt\",\n    outerStrength: 4,\n    innerStrength: 0,\n    color: 0x5099DD,\n    quality: 0.5,\n    padding: 10,\n    animated:\n    {\n        color: \n        {\n           active: true, \n           loopDuration: 3000, \n           animType: \"colorOscillation\", \n           val1:0xfff24f, \n           val2:0xfffabc\n        }\n    }\n}];\n\nawait TokenMagic.addFilters(token, params);"},"onDelete":{"script":"await TokenMagic.deleteFilters(token, \"GuidingBolt\");"}},"effective-transferral":{"transferBlock":{"button":false,"chat":false,"displayCard":false}},"dae":{"selfTarget":false,"selfTargetAlways":false,"stackable":"none","durationExpression":"","macroRepeat":"none","specialDuration":[]},"core":{"statusId":""}}}],"ownership":{"default":0,"npmYF618vZgxA5SD":3},"_stats":{"systemId":"dnd5e","systemVersion":"2.0.3","coreVersion":"10.291","createdTime":1669815040088,"modifiedTime":1671041582788,"lastModifiedBy":"npmYF618vZgxA5SD"},"folder":null,"sort":0,"_id":"rByvD0KaB3KuDsva"}
{"type":"spell","system":{"description":{"value":"<p>You create a floating, spectral weapon within range that lasts for the duration or until you cast this spell again. When you cast the spell, you can make a melee spell attack against a creature within 5 feet of the weapon. On a hit, the target takes force damage equal to 1d8 + your spellcasting ability modifier.</p>\n<p>As a bonus action on your turn, you can move the weapon up to 20 feet and repeat the attack against a creature within 5 feet of it.</p>\n<p>The weapon can take whatever form you choose. Clerics of deities who are associated with a particular weapon (as St. Cuthbert is known for his mace and Thor for his hammer) make this spell's effect resemble that weapon.</p>\n<p><strong>At Higher Levels.</strong> When you cast this spell using a spell slot of 3rd level or higher, the damage increases by 1d8 for every two slot levels above 2nd.</p>","chat":"","unidentified":""},"source":"Basic Rules, Player's Handbook pg 278","activation":{"type":"bonus","cost":1,"condition":""},"duration":{"value":"1","units":"minute"},"cover":null,"target":{"value":null,"width":null,"units":"","type":""},"range":{"value":60,"long":null,"units":"ft"},"uses":{"value":null,"max":"","per":"","recovery":""},"consume":{"type":"","target":"","amount":null},"ability":"","actionType":"rsak","attackBonus":"","chatFlavor":"","critical":{"threshold":null,"damage":""},"damage":{"parts":[["floor((@item.level)/2)d8","force"]],"versatile":""},"formula":"","save":{"ability":"","dc":null,"scaling":"spell"},"level":2,"school":"evo","components":{"vocal":true,"somatic":true,"material":false,"ritual":false,"concentration":false},"materials":{"value":"","consumed":false,"cost":0,"supply":0},"preparation":{"mode":"always","prepared":true},"scaling":{"mode":"none","formula":""}},"name":"Spiritual Weapon","flags":{"ddbimporter":{"id":138788,"definitionId":2263,"entityTypeId":435869154,"dndbeyond":{"lookup":"classSpell","class":"Cleric","level":3,"characterClassId":119747063,"spellLevel":2,"ability":"wis","mod":3,"dc":13,"cantripBoost":false,"overrideDC":false,"id":138788,"entityTypeId":435869154,"healingBoost":0,"usesSpellSlot":true},"originalName":"Spiritual Weapon","sources":[{"sourceId":1,"pageNumber":null,"sourceType":2},{"sourceId":2,"pageNumber":278,"sourceType":1}],"tags":["Damage"],"version":"3.3.16","importId":"4vIhj8w0ONHizmWc"},"midiProperties":{"magicdam":true,"magiceffect":true},"spell-class-filter-for-5e":{"parentClass":"cleric"},"core":{"sourceId":"Actor.7YkumVViRlXYhNtM.Item.cJ5DJiVaewztNpI0"}},"img":"icons/magic/fire/dagger-rune-enchant-flame-purple-orange.webp","effects":[{"label":"Spiritual Weapon","icon":"icons/magic/fire/dagger-rune-enchant-flame-purple-orange.webp","origin":"Actor.25uya6OX8BbpJcRj.Item.klNJ2pRYrNNpwsnl","duration":{"seconds":60,"startTime":null,"combat":null,"rounds":null,"turns":null,"startRound":null,"startTurn":null},"disabled":false,"_id":"jQA99WGQjluW6gEk","changes":[],"tint":null,"transfer":false,"flags":{}}],"ownership":{"default":0,"YCF2Heb7DMHDaF2f":3},"_stats":{"systemId":"dnd5e","systemVersion":"2.1.5","coreVersion":"10.291","createdTime":1678310174319,"modifiedTime":1678310510157,"lastModifiedBy":"YCF2Heb7DMHDaF2f"},"folder":null,"sort":0,"_id":"u97h2DDw1aUm7nSz"}
{"type":"spell","system":{"description":{"value":"<p>You call forth a bestial spirit. It manifests in an unoccupied space that you can see within range. This corporeal form uses the Bestial Spirit stat block. When you cast the spell, choose an environment: Air, Land, or Water. The creature resembles an animal of your choice that is native to the chosen environment, which determines certain traits in its stat block. The creature disappears when it drops to 0 hit points or when the spell ends.</p>\n<p>The creature is an ally to you and your companions. In combat, the creature shares your initiative count, but it takes its turn immediately after yours. It obeys your verbal commands (no action required by you). If you don’t issue any, it takes the Dodge action and uses its move to avoid danger.</p>\n<p><em><strong>At Higher Levels.</strong></em> When you cast this spell using a spell slot of 3rd level or higher, use the higher level wherever the spell’s level appears in the stat block.</p>\n<div class=\"Basic-Text-Frame stat-block-finder\">\n<p class=\"Stat-Block-Styles_Stat-Block-Title\">Bestial Spirit</p>\n<p class=\"Stat-Block-Styles_Stat-Block-Metadata\">Small beast</p>\n<p class=\"Stat-Block-Styles_Stat-Block-Data\"><strong>Armor Class</strong> 11 + the level of the spell (natural armor)</p>\n<p class=\"Stat-Block-Styles_Stat-Block-Data\"><strong>Hit Points</strong> 20 (Air only) or 30 (Land and Water only) + 5 for each spell level above 2nd</p>\n<p class=\"Stat-Block-Styles_Stat-Block-Data\"><strong>Speed</strong> 30 ft.; climb 30 ft. (Land only); fly 60 ft. (Air only); swim 30 ft. (Water only)</p>\n<div class=\"stat-block-ability-scores\">\n<div class=\"stat-block-ability-scores-stat\">\n<div class=\"stat-block-ability-scores-heading\">STR</div>\n<div class=\"stat-block-ability-scores-data\"><span class=\"stat-block-ability-scores-score\">18</span> <span class=\"stat-block-ability-scores-modifier\">(+4)</span></div>\n</div>\n<div class=\"stat-block-ability-scores-stat\">\n<div class=\"stat-block-ability-scores-heading\">DEX</div>\n<div class=\"stat-block-ability-scores-data\"><span class=\"stat-block-ability-scores-score\">11</span> <span class=\"stat-block-ability-scores-modifier\">(+0)</span></div>\n</div>\n<div class=\"stat-block-ability-scores-stat\">\n<div class=\"stat-block-ability-scores-heading\">CON</div>\n<div class=\"stat-block-ability-scores-data\"><span class=\"stat-block-ability-scores-score\">16</span> <span class=\"stat-block-ability-scores-modifier\">(+3)</span></div>\n</div>\n<div class=\"stat-block-ability-scores-stat\">\n<div class=\"stat-block-ability-scores-heading\">INT</div>\n<div class=\"stat-block-ability-scores-data\"><span class=\"stat-block-ability-scores-score\">4</span> <span class=\"stat-block-ability-scores-modifier\">(−3)</span></div>\n</div>\n<div class=\"stat-block-ability-scores-stat\">\n<div class=\"stat-block-ability-scores-heading\">WIS</div>\n<div class=\"stat-block-ability-scores-data\"><span class=\"stat-block-ability-scores-score\">14</span> <span class=\"stat-block-ability-scores-modifier\">(+2)</span></div>\n</div>\n<div class=\"stat-block-ability-scores-stat\">\n<div class=\"stat-block-ability-scores-heading\">CHA</div>\n<div class=\"stat-block-ability-scores-data\"><span class=\"stat-block-ability-scores-score\">5</span> <span class=\"stat-block-ability-scores-modifier\">(−3)</span></div>\n</div>\n</div>\n<p class=\"Stat-Block-Styles_Stat-Block-Data\"><strong>Senses</strong> @Compendium[dnd5e.rules.eVtpEGXjA2tamEIJ]{darkvision} 60 ft., passive @Compendium[dnd5e.rules.0AGfrwZRzSG0vNKb]{Perception} 12</p>\n<p class=\"Stat-Block-Styles_Stat-Block-Data\"><strong>Languages</strong> understands the languages you speak</p>\n<p class=\"Stat-Block-Styles_Stat-Block-Data-Last\"><strong>Challenge</strong> — <strong>Proficiency Bonus</strong> equals your bonus</p>\n<p class=\"Stat-Block-Styles_Stat-Block-Body\"><em><strong>Flyby (Air Only).</strong></em> The beast doesn’t provoke opportunity attacks when it flies out of an enemy’s reach.</p>\n<p class=\"Stat-Block-Styles_Stat-Block-Body\"><em><strong>Pack Tactics (Land and Water Only).</strong></em> The beast has advantage on an attack roll against a creature if at least one of the beast’s allies is within 5 feet of the creature and the ally isn’t @Compendium[dnd5e.rules.w7eitkpD7QQTB6j0]{incapacitated}.</p>\n<p class=\"Stat-Block-Styles_Stat-Block-Body\"><em><strong>Water Breathing (Water Only).</strong></em> The beast can breathe only underwater.</p>\n<p class=\"Stat-Block-Styles_Stat-Block-Heading\">Actions</p>\n<p class=\"Stat-Block-Styles_Stat-Block-Body\"><em><strong>Multiattack.</strong></em> The beast makes a number of attacks equal to half this spell’s level (rounded down).</p>\n<p class=\"Stat-Block-Styles_Stat-Block-Body\"><em><strong>Maul.</strong> Melee Weapon Attack:</em> your spell attack modifier to hit, reach 5 ft., one target. <em>Hit:</em> 1d8 + 4 + the spell’s level piercing damage.</p>\n</div>","chat":"","unidentified":""},"source":"Tasha’s Cauldron of Everything pg 109","activation":{"type":"action","cost":1,"condition":""},"duration":{"value":"1","units":"hour"},"cover":null,"target":{"value":null,"width":null,"units":"","type":""},"range":{"value":90,"long":null,"units":"ft"},"uses":{"value":null,"max":"","per":"","recovery":""},"consume":{"type":"","target":"","amount":null},"ability":"","actionType":"other","attackBonus":"","chatFlavor":"","critical":{"threshold":null,"damage":""},"damage":{"parts":[],"versatile":""},"formula":"","save":{"ability":"","dc":null,"scaling":"spell"},"level":2,"school":"con","components":{"vocal":true,"somatic":true,"material":true,"ritual":false,"concentration":true},"materials":{"value":"a feather, tuft of fur, and fish tail inside a gilded acorn worth at least 200 gp","consumed":false,"cost":200,"supply":0},"preparation":{"mode":"prepared","prepared":true},"scaling":{"mode":"none","formula":""}},"name":"Summon Beast","flags":{"ddbimporter":{"id":5854852,"definitionId":721187,"entityTypeId":435869154,"dndbeyond":{"lookup":"classSpell","class":"Druid","level":6,"characterClassId":103206845,"spellLevel":2,"ability":"wis","mod":3,"dc":14,"cantripBoost":false,"overrideDC":false,"id":5854852,"entityTypeId":435869154,"healingBoost":0,"usesSpellSlot":true},"originalName":"Summon Beast","sources":[{"sourceId":67,"pageNumber":109,"sourceType":1}],"tags":["Summoning"],"version":"3.2.2","importId":"CD1IaXD1fjvLJfwV"},"spell-class-filter-for-5e":{"parentClass":"druid"},"itemacro":{"macro":{"name":"Summon Beast","type":"script","scope":"global","command":"/**\n * Item-Macro Macro onCreation for the Summon Beast Spell, until now only tested from Control Bar.\n * \n * https://www.dndbeyond.com/spells/summon-beast\n * \n * TODO: clean up logging (pretty much remove, or put all to Tablerules logging with .debug() )\n */\n\nconst macroLabel = \"Summon Beast\";\nconst textureLand = \"modules/Tablerules/icons/magic/summons/beastialSpiritLand.webp\";\nconst textureAir = \"modules/Tablerules/icons/magic/summons/beastialSpiritAir.webp\";\nconst textureWater = \"modules/Tablerules/icons/magic/summons/beastialSpiritWater.webp\";\n\nconst addGlow = true;\nconst addBlur = true;\n\n//  from context (Item-Macro), drag Item in Control Bar for Control Bar use with selecting. Use next line for Control Bar without Selection providing the name (ID would be better)\n//actor = game.actors.getName(\"Jorrick\");\n\n// TODO: get from context\nconst item = actor.items.getName(\"Summon Beast\"); // why do we do it this way, is tha macro a the control bar instead of using an item with Item-Macro?\nconst level = await warpgate.dnd5e.rollItem(item);\n\nif (!level > 0) {\n    return;\n}\n\nconst summonerDc = actor.system.attributes.spelldc;\nconst summonerAttack = summonerDc - 8;\n\n/* Prompt the user for which type of spirit to summon */\nconst buttonData = {\n    buttons: [{\n        label: \"Bestial Spirit Land\",\n        value: {\n            token: { name: \"Bestial Spirit Land\" },\n            actor: { name: \"Bestial Spirit Land\" },\n            embedded: {\n                Item: {\n                    \"Flyby\": warpgate.CONST.DELETE,\n                    \"Water Breathing\": warpgate.CONST.DELETE\n                }\n            }\n        }\n    }, {\n        label: \"Bestial Spirit Air\",\n        value: {\n            actor: { name: \"Bestial Spirit Air\" },\n            token: { name: \"Bestial Spirit Air\" },\n            embedded: {\n                Item: {\n                    \"Pack Tactics\": warpgate.CONST.DELETE,\n                    \"Water Breathing\": warpgate.CONST.DELETE\n                }\n            }\n        }\n    }, {\n        label: \"Bestial Spirit Water\",\n        value: {\n            actor: { name: \"Bestial Spirit Water\" },\n            token: { name: \"Bestial Spirit Water\" },\n            embedded: {\n                Item: {\n                    \"Flyby\": warpgate.CONST.DELETE,\n                    \"Pack Tactics\": warpgate.CONST.DELETE\n                }\n            }\n        }\n    }\n    ], title: \"Which version?\"\n};\n\nlet spirit = await warpgate.buttonDialog(buttonData);\nconsole.log({ message: macroLabel, spirit: spirit });\n\n/* Craft the updates that are common to all spirits */\nlet updates = {\n    token: {\n        \"displayName\": CONST.TOKEN_DISPLAY_MODES.HOVER,\n        \"flags.Tablerules.spellLevel\": level\n    },\n    actor: {\n        'system.attributes.ac.flat': 11 + level,\n        'system.attributes.hp': { value: 30 + 5 * (level - 2), max: 30 + 5 * (level - 2) },\n        \"system.details.cr\": actor.system.attributes.prof,\n        \"system.attributes.prof\": actor.system.attributes.prof,\n        \"flags.world.summoned.item\": item.uuid,\n        \"flags.world.summoned.actor\": actor.uuid\n    },\n    embedded: {\n        Item: {\n            \"Multiattack\": { name: `Multiattack (${Math.floor(level / 2)} attacks)` },\n            \"Maul\": {\n                'system.damage.parts': [[`1d8 + 4 + ${level}`, \"piercing\"]],\n                'system.attackBonus': `- @mod - @prof + ${summonerAttack}`,\n            }\n        }\n    }\n}\n\n/* update variants */\nif (spirit.actor.name === \"Bestial Spirit Land\") {\n    updates[\"actor.img\"] = textureLand;\n    updates[\"token.texture.src\"] = textureLand;\n    updates[\"actor.system.attributes.movement.climb\"] = 30;\n}\n\nif (spirit.actor.name === \"Bestial Spirit Air\") {\n    updates['actor.system.attributes.hp'] = { value: 20 + 5 * (level - 2), max: 20 + 5 * (level - 2) };\n    updates[\"actor.img\"] = textureAir;\n    updates[\"token.texture.src\"] = textureAir;\n    updates[\"actor.system.attributes.movement.fly\"] = 60;\n}\n\nif (spirit.actor.name === \"Bestial Spirit Water\") {\n    updates[\"actor.img\"] = textureWater;\n    updates[\"token.texture.src\"] = textureWater;\n    updates[\"actor.system.attributes.movement.swim\"] = 30;\n}\n\n/* Combine the general and specific updates */\nupdates = mergeObject(updates, spirit);\n\nconst spawnIds = await warpgate.spawn(\"Bestial Spirit\", updates);\n\nconst spawn = canvas.tokens.get(spawnIds[0]); // or canvas.scene.tokens.get(id) to get the document immediately\n\nfor (let i = 0; i < spawnIds.length; i++) {\n    s = canvas.tokens.get(spawnIds[i]);\n}","author":"YCF2Heb7DMHDaF2f","_id":null,"img":"icons/svg/dice-target.svg","folder":null,"sort":0,"ownership":{"default":0},"flags":{},"_stats":{"systemId":null,"systemVersion":null,"coreVersion":null,"createdTime":null,"modifiedTime":null,"lastModifiedBy":null}}},"midi-qol":{"effectActivation":false},"midiProperties":{"nodam":false,"fulldam":false,"halfdam":false,"rollOther":false,"critOther":false,"magicdam":false,"magiceffect":false,"concentration":false,"toggleEffect":false,"ignoreTotalCover":false},"core":{"sourceId":"Actor.PG4shx9GXNLPo6dx.Item.jBRTbuFT4z8CFM8G"}},"img":"icons/commodities/claws/claw-bear-brown-grey.webp","effects":[],"ownership":{"default":0,"npmYF618vZgxA5SD":3,"YCF2Heb7DMHDaF2f":3},"_stats":{"systemId":"dnd5e","systemVersion":"2.1.5","coreVersion":"10.291","createdTime":1669495980778,"modifiedTime":1678716955177,"lastModifiedBy":"YCF2Heb7DMHDaF2f"},"folder":null,"sort":0,"_id":"vlW1ZVCmNPB2mDRC"}
{"type":"spell","system":{"description":{"value":"<p>You call forth spirits of the dead, which flit around you for the spell’s duration. The spirits are intangible and invulnerable.</p>\n<p>Until the spell ends, any attack you make deals 1d8 extra damage when you hit a creature within 10 feet of you. This damage is radiant, necrotic, or cold (your choice when you cast the spell). Any creature that takes this damage can’t regain hit points until the start of your next turn.</p>\n<p>In addition, any creature of your choice that you can see that starts its turn within 10 feet of you has its speed reduced by 10 feet until the start of your next turn.</p>\n<p><em><strong>At Higher Levels.</strong></em> When you cast this spell using a spell slot of 4th level or higher, the damage increases by 1d8 for every two slot levels above 3rd.</p>","chat":"","unidentified":""},"source":"Tasha’s Cauldron of Everything pg 108","activation":{"type":"bonus","cost":1,"condition":""},"duration":{"value":"1","units":"minute"},"cover":null,"target":{"value":10,"width":null,"units":"ft","type":"radius"},"range":{"value":null,"long":null,"units":"self"},"uses":{"value":null,"max":"","per":"","recovery":""},"consume":{"type":"","target":"","amount":null},"ability":"","actionType":"msak","attackBonus":"","chatFlavor":"","critical":{"threshold":null,"damage":""},"damage":{"parts":[["1d8",""]],"versatile":""},"formula":"","save":{"ability":"","dc":null,"scaling":"spell"},"level":3,"school":"nec","components":{"vocal":true,"somatic":true,"material":false,"ritual":false,"concentration":true},"materials":{"value":"","consumed":false,"cost":0,"supply":0},"preparation":{"mode":"pact","prepared":false},"scaling":{"mode":"level","formula":"1d8"}},"name":"Spirit Shroud","flags":{"ddbimporter":{"id":5833698,"definitionId":718581,"entityTypeId":435869154,"dndbeyond":{"lookup":"classSpell","class":"Warlock","level":5,"characterClassId":127047339,"spellLevel":3,"ability":"cha","mod":3,"dc":14,"cantripBoost":false,"overrideDC":false,"id":5833698,"entityTypeId":435869154,"healingBoost":0,"usesSpellSlot":true},"originalName":"Spirit Shroud","sources":[{"sourceId":67,"pageNumber":108,"sourceType":1}],"tags":["Damage","Debuff"],"version":"3.3.14","importId":"5SeIP7JfKAzcIHqr"},"midiProperties":{"magicdam":true,"magiceffect":true},"spell-class-filter-for-5e":{"parentClass":"warlock"},"itemacro":{"macro":{"name":"Spirit Shroud","type":"script","scope":"global","command":"/**\n * Item-Macro for the Spell Item for Spirit Shroud\n * https://www.dndbeyond.com/spells/spirit-shroud\n * \n */\n\nconst macroLabel = item.name;\n\nconsole.log({ message: `${macroLabel}, start.`, arguments: arguments });\n\nconst icon = item.img;\nconst flags = {\n    scope: \"world\", key: {\n        \"Spirit Shroud\": {\n            damageType: \"damageType\",\n            damageOrigin: \"damageOrigin\"\n        }\n    }\n};\n\nlet templates = canvas.scene.templates.filter(t => t.flags.dnd5e !== undefined).filter(t => t.flags.dnd5e.origin === item.uuid);\nlet template = templates[0];\n\n\nconst use = await item.use();\nif (!use) {\n    return;\n}\n\n// select the MeasuringTemplate created by the Item.Spell use() and modify\ntemplate = canvas.scene.templates.filter(t => t.flags.dnd5e !== undefined).filter(t => t.flags.dnd5e.origin === item.uuid)[0];\n\nconst templateData = {\n    borderColor: \"#d500d2\",\n    fillColor: \"#81007f\",\n    x: token.center.x,\n    y: token.center.y\n};\nawait template.update(templateData);\nawait tokenAttacher.attachElementsToToken([template], token);","author":"npmYF618vZgxA5SD","_id":null,"img":"icons/svg/dice-target.svg","folder":null,"sort":0,"ownership":{"default":0},"flags":{},"_stats":{"systemId":null,"systemVersion":null,"coreVersion":null,"createdTime":null,"modifiedTime":null,"lastModifiedBy":null}}},"core":{"sourceId":"Actor.4Np7hvQdX3ExvOcx.Item.mAitynl4zM9tcc2i"}},"img":"icons/magic/death/projectile-skull-fire-purple.webp","effects":[{"label":"Spirit Shroud","icon":"icons/magic/death/projectile-skull-fire-purple.webp","origin":"Actor.4Np7hvQdX3ExvOcx.Item.mAitynl4zM9tcc2i","duration":{"seconds":60,"startTime":null,"combat":null,"rounds":null,"turns":null,"startRound":null,"startTurn":null},"disabled":false,"_id":"8FL8ifv8DxGlJBum","changes":[],"tint":null,"transfer":false,"flags":{"dfreds-convenient-effects":{"description":"test"},"effective-transferral":{"transferBlock":{"button":false,"chat":false,"displayCard":false},"transferrable":{"self":true,"target":true}},"dae":{"selfTarget":false,"selfTargetAlways":false,"stackable":"none","durationExpression":"","macroRepeat":"none","specialDuration":[]},"core":{"statusId":""},"effectmacro":{"onDelete":{"script":"await canvas.scene.deleteEmbeddedDocuments(\"MeasuredTemplate\",canvas.scene.templates.filter(t => t.flags?.dnd5e?.origin === origin.uuid).map(t=>t.id));"}}}}],"ownership":{"default":0,"npmYF618vZgxA5SD":3},"_stats":{"systemId":"dnd5e","systemVersion":"2.1.5","coreVersion":"10.291","createdTime":1677770517697,"modifiedTime":1677776188931,"lastModifiedBy":"npmYF618vZgxA5SD"},"folder":null,"sort":0,"_id":"yRd5OULqMyjZ1kuN"}
{"type":"spell","system":{"description":{"value":"<p>This spell sends creatures into a magical slumber. Roll 5d8; the total is how many hit points of creatures this spell can affect. Creatures within 20 feet of a point you choose within range are affected in ascending order of their current hit points (ignoring @Compendium[dnd5e.rules.w7eitkpD7QQTB6j0]{unconscious} creatures).</p>\n<p>Starting with the creature that has the lowest current hit points, each creature affected by this spell falls @Compendium[dnd5e.rules.w7eitkpD7QQTB6j0]{unconscious} until the spell ends, the sleeper takes damage, or someone uses an action to shake or slap the sleeper awake. Subtract each creature’s hit points from the total before moving on to the creature with the next lowest hit points. A creature’s hit points must be equal to or less than the remaining total for that creature to be affected.</p>\n<p>Undead and creatures immune to being @Compendium[dnd5e.rules.w7eitkpD7QQTB6j0]{charmed} aren’t affected by this spell.</p>\n<p><em><strong>At Higher Levels.</strong></em> When you cast this spell using a spell slot of 2nd level or higher, roll an additional 2d8 for each slot level above 1st.</p>","chat":"","unidentified":""},"source":"Basic Rules, Player's Handbook pg 276","activation":{"type":"action","cost":1,"condition":""},"duration":{"value":1,"units":"minute"},"target":{"value":20,"width":null,"units":"ft","type":"sphere"},"range":{"value":90,"long":null,"units":"ft"},"uses":{"value":null,"max":"","per":"","recovery":""},"consume":{"type":"","target":"","amount":null},"ability":"","actionType":"other","attackBonus":0,"chatFlavor":"","critical":{"threshold":null,"damage":""},"damage":{"parts":[["5d8",""]],"versatile":"","value":""},"formula":"","save":{"ability":"","dc":null,"scaling":"spell"},"level":1,"school":"enc","components":{"value":"a pinch of fine sand, rose petals, or a cricket","vocal":true,"somatic":true,"material":true,"ritual":false,"concentration":false},"materials":{"value":"a pinch of fine sand, rose petals, or a cricket","consumed":false,"cost":0,"supply":0},"preparation":{"mode":"prepared","prepared":true},"scaling":{"mode":"level","formula":"2d8"}},"name":"Sleep","flags":{"ddbimporter":{"id":138731,"definitionId":2254,"entityTypeId":435869154,"dndbeyond":{"lookup":"classSpell","class":"Wizard","level":1,"characterClassId":108474208,"spellLevel":1,"ability":"int","mod":3,"dc":13,"cantripBoost":false,"overrideDC":false,"id":138731,"entityTypeId":435869154,"healingBoost":0,"usesSpellSlot":true},"originalName":"Sleep","sources":[{"sourceId":1,"pageNumber":null,"sourceType":2},{"sourceId":2,"pageNumber":276,"sourceType":1}],"tags":["Control"],"version":"3.2.4","importId":"EgKCIFc1BkVC5JrI"},"spell-class-filter-for-5e":{"parentClass":"wizard"},"midi-qol":{"effectActivation":false},"midiProperties":{"nodam":false,"fulldam":false,"halfdam":false,"rollOther":false,"critOther":false,"magicdam":false,"magiceffect":false,"concentration":false,"toggleEffect":false,"ignoreTotalCover":false},"core":{"sourceId":"Actor.ZhhF2ZWDPIY2g3KI.Item.8jZVoHpCEtzKfreQ"}},"img":"icons/magic/light/explosion-star-small-pink.webp","effects":[{"label":"Sleep","icon":"icons/magic/light/explosion-star-small-pink.webp","origin":"Actor.6jtmp2Joatnf8PuB.Item.8jZVoHpCEtzKfreQ","duration":{"seconds":60,"startTime":null,"combat":null,"rounds":null,"turns":null,"startRound":null,"startTurn":null},"disabled":false,"_id":"KfLMB8ddvzbNsweK","changes":[],"tint":null,"transfer":false,"flags":{}}],"_stats":{"systemId":"dnd5e","systemVersion":"2.0.3","coreVersion":"10.291","createdTime":1669500366054,"modifiedTime":1671041513060,"lastModifiedBy":"npmYF618vZgxA5SD"},"ownership":{"default":0,"npmYF618vZgxA5SD":3},"folder":null,"sort":0,"_id":"ydiJQ9SSVlelEM2s"}
{"type":"spell","system":{"description":{"value":"<p>You touch a willing creature who isn't wearing armor, and a protective magical force surrounds it until the spell ends. The target's base AC becomes 13 + its Dexterity modifier. The spell ends if the target dons armor or if you dismiss the spell as an action.</p>","chat":"","unidentified":""},"source":"Basic Rules, Player's Handbook pg 256","activation":{"type":"action","cost":1,"condition":""},"duration":{"value":"8","units":"hour"},"cover":null,"target":{"value":null,"width":null,"units":"","type":""},"range":{"value":null,"long":null,"units":"touch"},"uses":{"value":null,"max":"","per":"","recovery":""},"consume":{"type":"","target":"","amount":null},"ability":"","actionType":"util","attackBonus":"","chatFlavor":"","critical":{"threshold":null,"damage":""},"damage":{"parts":[],"versatile":""},"formula":"","save":{"ability":"","dc":null,"scaling":"spell"},"level":1,"school":"abj","components":{"vocal":true,"somatic":true,"material":true,"ritual":false,"concentration":false},"materials":{"value":"a piece of cured leather","consumed":false,"cost":0,"supply":0},"preparation":{"mode":"prepared","prepared":false},"scaling":{"mode":"none","formula":""}},"name":"Mage Armor","flags":{"ddbimporter":{"id":138432,"definitionId":2172,"entityTypeId":435869154,"dndbeyond":{"lookup":"classSpell","class":"Wizard","level":2,"characterClassId":124817896,"spellLevel":1,"ability":"int","mod":3,"dc":13,"cantripBoost":false,"overrideDC":false,"id":138432,"entityTypeId":435869154,"healingBoost":0,"usesSpellSlot":true},"originalName":"Mage Armor","sources":[{"sourceId":1,"pageNumber":null,"sourceType":2},{"sourceId":2,"pageNumber":256,"sourceType":1}],"tags":["Buff","Warding"],"version":"3.3.8","importId":"hCa0W5gTxkWEg7lw"},"spell-class-filter-for-5e":{"parentClass":"wizard"},"core":{"sourceId":"Actor.pvWHemzJIHEPighO.Item.EDY5dOTjrIxODRU0"}},"img":"icons/magic/defensive/shield-barrier-glowing-triangle-blue.webp","effects":[{"label":"Mage Armor","icon":"icons/magic/defensive/shield-barrier-glowing-triangle-blue.webp","origin":"Actor.pvWHemzJIHEPighO.Item.EDY5dOTjrIxODRU0","duration":{"seconds":28800,"startTime":null,"combat":null,"rounds":null,"turns":null,"startRound":null,"startTurn":null},"disabled":false,"_id":"i38IHHxA7a1yKtq6","changes":[{"key":"system.attributes.ac.calc","mode":5,"value":"mage","priority":20}],"tint":null,"transfer":false,"flags":{"effective-transferral":{"transferBlock":{"button":false,"chat":false,"displayCard":false},"transferrable":{"self":true,"target":true}},"dae":{"selfTarget":false,"selfTargetAlways":false,"stackable":"none","durationExpression":"","macroRepeat":"none","specialDuration":[]},"core":{"statusId":""},"effectmacro":{"onCreate":{"script":"const default1 = 0x5099DD;\nconst default2 = 0x90EEFF;\nconst white1 = 0xFFFFFF;\nconst white2 = 0xDDDDFF;\nconst red1 = 0xFF0000;\nconst red2 = 0xFF3300;\nconst black1 = 0x4B0082;\nconst black2 = 0x2B0062;\n\nlet params =\n[{\n    filterType: \"glow\",\n    filterId: \"mageArmor\",\n    outerStrength: 4,\n    innerStrength: 0,\n    color: red1,\n    quality: 0.5,\n    padding: 10,\n    animated:\n    {\n        color: \n        {\n           active: true, \n           loopDuration: 3000, \n           animType: \"colorOscillation\", \n           val1:red1, \n           val2:red2\n        }\n    }\n}];\n\nawait TokenMagic.addUpdateFiltersOnSelected(params);"},"onDelete":{"script":"await TokenMagic.deleteFilters(token, \"mageArmor\");"}}}}],"ownership":{"default":0,"npmYF618vZgxA5SD":3,"YCF2Heb7DMHDaF2f":3},"_stats":{"systemId":"dnd5e","systemVersion":"2.1.4","coreVersion":"10.291","createdTime":1676044486985,"modifiedTime":1676305189448,"lastModifiedBy":"YCF2Heb7DMHDaF2f"},"folder":null,"sort":0,"_id":"z4d6zPC4bgTUOtpv"}
{"type":"spell","system":{"description":{"value":"<p>You bless up to three creatures of your choice within range. Whenever a target makes an attack roll or a saving throw before the spell ends, the target can roll a d4 and add the number rolled to the attack roll or saving throw.</p>\n<p><strong>At Higher Levels.</strong> When you cast this spell using a spell slot of 2nd level or higher, you can target one additional creature for each slot level above 1st.</p>","chat":"","unidentified":""},"source":"Basic Rules, Player's Handbook pg 219","activation":{"type":"action","cost":1,"condition":""},"duration":{"value":1,"units":"minute"},"target":{"value":3,"width":null,"units":"","type":"creature"},"range":{"value":30,"long":null,"units":"ft"},"uses":{"value":null,"max":"","per":"","recovery":""},"consume":{"type":"","target":"","amount":null},"ability":"wis","actionType":"util","attackBonus":0,"chatFlavor":"","critical":{"threshold":null,"damage":""},"damage":{"parts":[],"versatile":""},"formula":"","save":{"ability":"","dc":null,"scaling":"spell"},"level":1,"school":"enc","components":{"value":"a sprinkling of holy water","vocal":true,"somatic":true,"material":true,"ritual":false,"concentration":true},"materials":{"value":"a sprinkling of holy water","consumed":false,"cost":0,"supply":0},"preparation":{"mode":"always","prepared":true},"scaling":{"mode":"none","formula":""}},"name":"Bless","flags":{"ddbimporter":{"id":136126,"definitionId":2016,"entityTypeId":435869154,"dndbeyond":{"lookup":"classSpell","class":"Cleric","level":1,"characterClassId":118182112,"spellLevel":1,"ability":"wis","mod":2,"dc":12,"cantripBoost":false,"overrideDC":false,"id":136126,"entityTypeId":435869154,"healingBoost":2,"usesSpellSlot":true},"originalName":"Bless","sources":[{"sourceId":1,"pageNumber":null,"sourceType":2},{"sourceId":2,"pageNumber":219,"sourceType":1}],"tags":["Buff"],"version":"3.2.4","importId":"XpwygIbTgqS9zbhX"},"spell-class-filter-for-5e":{"parentClass":"cleric"},"midi-qol":{"effectActivation":false,"forceCEOn":false},"midiProperties":{"nodam":false,"fulldam":false,"halfdam":false,"rollOther":false,"critOther":false,"magicdam":false,"magiceffect":false,"concentration":false,"toggleEffect":false,"ignoreTotalCover":false},"core":{"sourceId":"Actor.jItLUReNSJ6NAwL3.Item.gahURDXkpl94Jnst"}},"img":"icons/magic/control/buff-flight-wings-blue.webp","effects":[{"label":"Bless","icon":"icons/magic/control/buff-flight-wings-blue.webp","origin":"Actor.3IDJAqCn3WKSy8xf.Item.gahURDXkpl94Jnst","duration":{"seconds":60,"startTime":null,"combat":null,"rounds":null,"turns":null,"startRound":null,"startTurn":null},"disabled":false,"_id":"W7v9DB5pR2EpodVe","changes":[{"key":"system.bonuses.All-Attacks","mode":2,"value":"+1d4","priority":20},{"key":"system.bonuses.abilities.save","mode":2,"value":"+1d4","priority":20}],"tint":null,"transfer":false,"flags":{"effective-transferral":{"transferBlock":{"button":false,"chat":false,"displayCard":false}},"dae":{"selfTarget":false,"selfTargetAlways":false,"stackable":"none","durationExpression":"","macroRepeat":"none","specialDuration":[]},"core":{"statusId":""}}}],"_stats":{"systemId":"dnd5e","systemVersion":"2.0.3","coreVersion":"10.291","createdTime":1669694313366,"modifiedTime":1671041492354,"lastModifiedBy":"npmYF618vZgxA5SD"},"ownership":{"default":0,"npmYF618vZgxA5SD":3},"folder":null,"sort":0,"_id":"zLqb912CTOFMMahB"}
{"type":"spell","system":{"description":{"value":"<p>Your body becomes blurred, shifting and wavering to all who can see you. For the duration, any creature has disadvantage on attack rolls against you. An attacker is immune to this effect if it doesn't rely on sight, as with @Compendium[dnd5e.rules.eVtpEGXjA2tamEIJ]{blindsight}, or can see through illusions, as with @Compendium[dnd5e.rules.eVtpEGXjA2tamEIJ]{truesight}.</p>","chat":"","unidentified":""},"source":"Basic Rules, Player's Handbook pg 219","activation":{"type":"action","cost":1,"condition":""},"duration":{"value":"1","units":"minute"},"cover":null,"target":{"value":null,"width":null,"units":"","type":"self"},"range":{"value":null,"long":null,"units":"self"},"uses":{"value":null,"max":"","per":"","recovery":""},"consume":{"type":"","target":"","amount":null},"ability":"","actionType":"other","attackBonus":"","chatFlavor":"","critical":{"threshold":null,"damage":""},"damage":{"parts":[],"versatile":""},"formula":"","save":{"ability":"","dc":null,"scaling":"spell"},"level":2,"school":"ill","components":{"vocal":true,"somatic":false,"material":false,"ritual":false,"concentration":true},"materials":{"value":"","consumed":false,"cost":0,"supply":0},"preparation":{"mode":"prepared","prepared":true},"scaling":{"mode":"none","formula":""}},"name":"Blur","flags":{"ddbimporter":{"id":136164,"definitionId":2020,"entityTypeId":435869154,"dndbeyond":{"lookup":"classSpell","class":"Wizard","level":3,"characterClassId":124817896,"spellLevel":2,"ability":"int","mod":3,"dc":13,"cantripBoost":false,"overrideDC":false,"id":136164,"entityTypeId":435869154,"healingBoost":0,"usesSpellSlot":true},"originalName":"Blur","sources":[{"sourceId":1,"pageNumber":null,"sourceType":2},{"sourceId":2,"pageNumber":219,"sourceType":1}],"tags":["Deception","Warding"],"version":"3.3.14","importId":"XCXbL7ySi9pk8Ffk"},"midiProperties":{"magicdam":true,"magiceffect":true},"spell-class-filter-for-5e":{"parentClass":"wizard"},"core":{"sourceId":"Actor.mx3X7WTxqwuqNVNY.Item.zZ31LsDAyUnSo2qN"}},"img":"icons/magic/air/air-burst-spiral-blue-gray.webp","effects":[{"label":"Blur","icon":"icons/magic/air/air-burst-spiral-blue-gray.webp","origin":"Actor.XhAex7eipJsxMahD.Item.66wXOJy1pxWdDft1","duration":{"seconds":60,"startTime":null,"combat":null,"rounds":null,"turns":null,"startRound":null,"startTurn":null},"disabled":false,"_id":"CRbUkWTFLLvtQ5Qs","changes":[],"tint":null,"transfer":false,"flags":{"dfreds-convenient-effects":{"description":""},"effective-transferral":{"transferBlock":{"button":false,"chat":false,"displayCard":false},"transferrable":{"self":true,"target":true}},"dae":{"selfTarget":false,"selfTargetAlways":false,"stackable":"none","durationExpression":"","macroRepeat":"none","specialDuration":[]},"core":{"statusId":""},"effectmacro":{"onCreate":{"script":"let params =\n[{\n    filterType: \"blur\",\n    filterId: \"myBlur\",\n    padding: 10,\n    quality: 4.0,\n    blur: 0,\n    blurX: 0,\n    blurY: 0,\n    animated:\n    {\n        blurX: \n        { \n           active: true, \n           animType: \"syncCosOscillation\", \n           loopDuration: 1500, \n           val1: 0, \n           val2: 6\n        },\n        blurY: \n        { \n           active: true, \n           animType: \"syncCosOscillation\", \n           loopDuration: 1750, \n           val1: 0, \n           val2: 6}\n    }\n}];\n\nawait TokenMagic.addUpdateFiltersOnSelected(params);"},"onDelete":{"script":"await TokenMagic.deleteFilters(token, \"myBlur\");"}}}}],"ownership":{"default":0,"YCF2Heb7DMHDaF2f":3},"_stats":{"systemId":"dnd5e","systemVersion":"2.1.5","coreVersion":"10.291","createdTime":1677791830261,"modifiedTime":1678953098952,"lastModifiedBy":"YCF2Heb7DMHDaF2f"},"folder":null,"sort":0,"_id":"qCMKnAM78JmwYhti"}
